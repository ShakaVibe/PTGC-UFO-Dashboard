<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PTGC UFO Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Rajdhani',sans-serif;background:#0a0a0a;min-height:100vh}
    .font-orbitron{font-family:'Orbitron',monospace}
    ::-webkit-scrollbar{width:8px}
    ::-webkit-scrollbar-track{background:#1a1a1a}
    ::-webkit-scrollbar-thumb{background:#333;border-radius:4px}
    @keyframes fire{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
    .animate-fire{animation:fire 0.5s ease-in-out infinite}
    .animate-pulse-slow{animation:pulse 1.5s ease-in-out infinite}
    .token-card{transition:all 0.3s ease}
    .token-card:hover{transform:scale(1.02)}
    .token-card-gold:hover{box-shadow:0 0 50px rgba(217,202,93,0.5)}
    .token-card-green:hover{box-shadow:0 0 50px rgba(124,252,0,0.5)}
    .modal-overlay{backdrop-filter:blur(8px)}
    .clickable:hover{transform:scale(1.02);cursor:pointer}
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const {useState,useEffect,useMemo}=React;
    
    const TOKENS={
      PTGC:{name:'PTGC',address:'0x94534EeEe131840b1c0F61847c572228bdfDDE93',logo:'06_PTGC_V1_transparent_bg.png',color:'gold',colorHex:'#D9CA5D',decimals:18,mainPair:'0xf5A89A6487D62df5308CDDA89c566C5B5ef94C11',pulseScanUrl:'https://scan.pulsechain.com/token/0x94534EeEe131840b1c0F61847c572228bdfDDE93',totalSupply:333333333333,taxRate:0.05,hasDAO:true,
        daoContract:'0x305ACfAb82103c2b82B19543919d1c93b44E55DB',
        daoTreasury:'0xeeac1da7f930078ab757ad8a64cf7c5e17b931e1',
        stakingContract:'0xC71f597a2AC39E47F07102E849d18489C96f39EF',
        taxBreakdown:[{name:'DAO',pct:2,emoji:'\u{1F3DB}\u{FE0F}'},{name:'Stakers',pct:1,emoji:'\u{1F48E}'},{name:'Holders+Stakers',pct:1,emoji:'\u{1F48E}\u{1F48E}'},{name:'Buy & Burn',pct:0.5,emoji:'\u{1F525}'},{name:'Add LP',pct:0.5,emoji:'\u{1F4A7}'}]
      },
      UFO:{name:'UFO',address:'0x456548A9B56eFBbD89Ca0309edd17a9E20b04018',logo:'07_Ufo_transparent.png',color:'green',colorHex:'#7CFC00',decimals:18,mainPair:'0xbeA0e55b82Eb975280041F3b49C4D0bD937b72d5',pulseScanUrl:'https://scan.pulsechain.com/token/0x456548A9B56eFBbD89Ca0309edd17a9E20b04018',totalSupply:999999999051,taxRate:0.06,hasDAO:false,
        taxBreakdown:[{name:'LP Providers',pct:3,emoji:'\u{1F4A7}'},{name:'Holders',pct:1,emoji:'\u{1F48E}'},{name:'Burn UFO',pct:1,emoji:'\u{1F525}'},{name:'Burn PTGC',pct:1,emoji:'\u{1F525}'}]
      }
    };
    
    const LP_ADDRESSES=['0xf5a89a6487d62df5308cdda89c566c5b5ef94c11','0xbea0e55b82eb975280041f3b49c4d0bd937b72d5'];
    const BURN_ADDRESS='0x0000000000000000000000000000000000000369';
    const COMBINED_LOGO='07_Combined_PTGC_UFO_Transparent.png';
    const RPC='https://rpc.pulsechain.com';
    const MIN_LIQ=1000;
    
    // Simple RPC fetch with timeout
    const rpcFetch=async(body,timeout=8000)=>{
      try{
        const controller=new AbortController();
        const timeoutId=setTimeout(()=>controller.abort(),timeout);
        const res=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body),signal:controller.signal});
        clearTimeout(timeoutId);
        return await res.json();
      }catch(e){
        console.error('RPC error:',e.message);
        return{result:null};
      }
    };
    
    const HOLDER_TIERS_DISPLAY=[
      {n:'Poseidon',e:'\u{1F531}',p:10},
      {n:'Whale',e:'\u{1F40B}',p:1},
      {n:'Shark',e:'\u{1F988}',p:0.1},
      {n:'Dolphin',e:'\u{1F42C}',p:0.01},
      {n:'Squid',e:'\u{1F991}',p:0.001},
      {n:'Turtle & Below',e:'\u{1F422}',p:0}
    ];
    
    const HOLDER_TIERS=[
      {n:'Poseidon',p:10},{n:'Whale',p:1},{n:'Shark',p:0.1},{n:'Dolphin',p:0.01},{n:'Squid',p:0.001},{n:'Turtle',p:0.0001},{n:'Shrimp',p:0.00001},{n:'Shell',p:0}
    ];
    
    const BURN_C=[{n:'Poseidon',e:'\u{1F531}',p:10},{n:'Whale',e:'\u{1F40B}',p:1},{n:'Shark',e:'\u{1F988}',p:0.1},{n:'Dolphin',e:'\u{1F42C}',p:0.01},{n:'Squid',e:'\u{1F991}',p:0.001},{n:'Turtle',e:'\u{1F422}',p:0.0001},{n:'Shrimp',e:'\u{1F990}',p:0.00001},{n:'Shell',e:'\u{1F41A}',p:0}];
    
    const fmt=n=>n==null||isNaN(n)?'\u2014':Math.floor(Number(n)).toLocaleString('en-US');
    const fmtUSD=n=>n==null||isNaN(n)?'\u2014':'$'+Math.floor(Number(n)).toLocaleString('en-US');
    const fmtAbbr=n=>{if(n==null||isNaN(n))return'\u2014';const num=Number(n);if(num>=1e12)return(num/1e12).toFixed(2)+'T';if(num>=1e9)return(num/1e9).toFixed(2)+'B';if(num>=1e6)return(num/1e6).toFixed(2)+'M';if(num>=1e3)return(num/1e3).toFixed(2)+'K';return Math.floor(num).toLocaleString('en-US')};
    const fmtPrice=p=>{if(!p||isNaN(p)||p===0)return'\u2014';if(p>=1)return'$'+p.toFixed(2);if(p>=0.0001)return'$'+p.toFixed(6);const s=p.toExponential(4),[m,e]=s.split('e'),exp=Math.abs(parseInt(e));return{pre:'$0.0',z:exp-1,d:parseFloat(m).toFixed(4).replace('.','').slice(0,4)}};
    const Price=({p,c=''})=>{const f=fmtPrice(p);return typeof f==='string'?<span className={c}>{f}</span>:<span className={c}>{f.pre}<sub className="text-[0.6em] opacity-70">{f.z}</sub>{f.d}</span>};
    const getLogo=a=>a?`https://dd.dexscreener.com/ds-data/tokens/pulsechain/${a.toLowerCase()}.png`:null;
    const getBurnC=(pct,min='Shell')=>{const r=[];let rem=pct;const minI=BURN_C.findIndex(c=>c.n===min);for(let i=0;i<BURN_C.length;i++){if(minI>=0&&i>minI)continue;const c=BURN_C[i];if(c.p>0&&rem>=c.p){const cnt=Math.floor(rem/c.p);if(cnt>0){r.push({...c,cnt});rem-=cnt*c.p}}}return r};
    const getSingleC=pct=>{for(const c of BURN_C)if(pct>=c.p)return c;return BURN_C[BURN_C.length-1]};
    // Get highest tier creature with count for period burns
    const getHighestCreatureWithCount=pct=>{
      for(const c of BURN_C){
        if(pct>=c.p){
          const cnt=c.p>0?Math.floor(pct/c.p):1;
          return{...c,cnt:Math.max(1,cnt)};
        }
      }
      return{...BURN_C[BURN_C.length-1],cnt:0};
    };
    const getWhaleProgress=pct=>({whales:Math.floor(pct),progress:(pct-Math.floor(pct))*100});
    const getHolderTier=(holdingPct)=>{for(const tier of HOLDER_TIERS){if(holdingPct>=tier.p)return tier.n}return'Shell'};
    
    const fetchDex=async(addr,mainPair)=>{try{let mp=null;if(mainPair){const r=await fetch(`https://api.dexscreener.com/latest/dex/pairs/pulsechain/${mainPair}`);const d=await r.json();if(d.pair)mp=d.pair}const res=await fetch(`https://api.dexscreener.com/latest/dex/tokens/${addr}`);const data=await res.json();if(data.pairs&&data.pairs.length>0){const pairs=data.pairs.map(p=>({...p,liq:p.liquidity?.usd||0,vol:p.volume?.h24||0})).sort((a,b)=>b.liq-a.liq);const pp=mp||pairs[0];let totalTokensInLP=0;pairs.forEach(p=>{const isBase=p.baseToken?.address?.toLowerCase()===addr.toLowerCase();if(isBase&&p.liquidity?.base)totalTokensInLP+=p.liquidity.base;else if(!isBase&&p.liquidity?.quote)totalTokensInLP+=p.liquidity.quote});return{price:parseFloat(pp.priceUsd)||0,change:pp.priceChange?.h24||0,mcap:pp.marketCap||pp.fdv||0,liq:pairs.reduce((s,p)=>s+p.liq,0),vol:pairs.reduce((s,p)=>s+p.vol,0),buys:pairs.reduce((s,p)=>s+(p.txns?.h24?.buys||0),0),sells:pairs.reduce((s,p)=>s+(p.txns?.h24?.sells||0),0),tokensInLP:totalTokensInLP,pairs}}return null}catch(e){console.error(e);return null}};
    const fetchHolders=async addr=>{
      const token=addr.toLowerCase()===TOKENS.PTGC.address.toLowerCase()?'PTGC':'UFO';
      const key=token.toLowerCase();
      
      // First try burn history cache (Moralis data)
      if(burnHistoryCache&&burnHistoryCache[token]?.holders>0){
        return burnHistoryCache[token].holders;
      }
      
      // Then try holder history cache (most recent month)
      if(holderHistoryCache&&holderHistoryCache.data?.length>0){
        const lastEntry=holderHistoryCache.data[holderHistoryCache.data.length-1];
        if(lastEntry[key]>0)return lastEntry[key];
      }
      
      // Fallback to PulseScan
      try{
        const r=await fetch(`https://api.scan.pulsechain.com/api/v2/tokens/${addr}/counters`);
        const data=await r.json();
        return parseInt(data.token_holders_count)||0;
      }catch{return 0}
    };
    const fetchBurn=async(addr,dec)=>{try{const bRes=await rpcFetch({jsonrpc:'2.0',method:'eth_call',params:[{to:addr,data:'0x70a08231000000000000000000000000'+BURN_ADDRESS.slice(2)},'latest'],id:1});const burned=Number(BigInt(bRes.result||'0x0'))/Math.pow(10,dec);const sRes=await rpcFetch({jsonrpc:'2.0',method:'eth_call',params:[{to:addr,data:'0x18160ddd'},'latest'],id:2});const supply=Number(BigInt(sRes.result||'0x0'))/Math.pow(10,dec);return{total:burned,pct:supply>0?(burned/supply)*100:0,supply}}catch(e){console.error('fetchBurn error:',e);return{total:0,pct:0,supply:0}}};
    
    // Burn history cache - loaded from pre-generated JSON file
    let burnHistoryCache=null;
    const BURN_HISTORY_URL='https://raw.githubusercontent.com/shakavibe/PTGC-UFO-Dashboard/main/data/burn-summary.json';
    const HOLDER_HISTORY_URL='https://raw.githubusercontent.com/shakavibe/PTGC-UFO-Dashboard/main/holder-history.json';
    
    // Holder history cache
    let holderHistoryCache=null;
    const fetchHolderHistory=async()=>{
      if(holderHistoryCache)return holderHistoryCache;
      try{
        // Add cache buster to avoid stale data
        const r=await fetch(HOLDER_HISTORY_URL+'?t='+Date.now());
        holderHistoryCache=await r.json();
        console.log('Holder history loaded');
        return holderHistoryCache;
      }catch(e){
        console.error('Failed to load holder history:',e);
        return null;
      }
    };
    
    // Get holder change vs yesterday (24hr) from burn summary snapshots
    const getHolderChange=(token,currentHolders)=>{
      // Try burn summary snapshots first (daily data)
      if(burnHistoryCache&&burnHistoryCache[token]?.snapshots?.length>=2){
        const snapshots=burnHistoryCache[token].snapshots;
        const today=snapshots[0];
        const yesterday=snapshots[1];
        if(today&&yesterday&&yesterday.holders>0){
          const todayHolders=currentHolders||today.holders||0;
          return todayHolders-yesterday.holders;
        }
      }
      
      // Fallback to holder history (monthly data)
      if(!holderHistoryCache||!holderHistoryCache.data||holderHistoryCache.data.length<2)return null;
      const key=token.toLowerCase();
      const data=holderHistoryCache.data;
      const lastMonth=data[data.length-1];
      const prevMonth=data[data.length-2];
      if(!lastMonth||!prevMonth)return null;
      const lastVal=currentHolders||lastMonth[key]||0;
      const prevVal=prevMonth[key]||0;
      return lastVal-prevVal;
    };
    
    const fetchBurnHistory=async()=>{
      if(burnHistoryCache)return burnHistoryCache;
      try{
        const r=await fetch(BURN_HISTORY_URL);
        burnHistoryCache=await r.json();
        console.log('Burn history loaded, last updated:',burnHistoryCache.lastUpdated);
        return burnHistoryCache;
      }catch(e){
        console.error('Failed to load burn history:',e);
        return null;
      }
    };
    
    // Get burn periods from cache for a token
    const getBurnPeriods=(token)=>{
      if(!burnHistoryCache||!burnHistoryCache[token])return{h12:0,h24:0,d7:0,d30:0,d90:0};
      const p=burnHistoryCache[token].periods;
      return{
        h12:p.h12?.amount||0,
        h24:p.h24?.amount||0,
        d7:p.d7?.amount||0,
        d30:p.d30?.amount||0,
        d90:p.d90?.amount||0
      };
    };
    const fetchPLS=async()=>{try{const r=await fetch('https://api.dexscreener.com/latest/dex/pairs/pulsechain/0xe56043671df55de5cdf8459710433c10324de0ae');return parseFloat((await r.json()).pair?.priceUsd)||0.00005}catch{return 0.00005}};
    
    const fetchPLSBalance=async(addr)=>{try{const r=await rpcFetch({jsonrpc:'2.0',method:'eth_getBalance',params:[addr,'latest'],id:1});return Number(BigInt(r.result||'0x0'))/1e18}catch{return 0}};
    
    const fetchTokenBalance=async(tokenAddr,walletAddr,decimals)=>{
      try{
        const data='0x70a08231000000000000000000000000'+walletAddr.slice(2).toLowerCase();
        const r=await rpcFetch({jsonrpc:'2.0',method:'eth_call',params:[{to:tokenAddr,data},'latest'],id:1});
        return Number(BigInt(r.result||'0x0'))/Math.pow(10,decimals);
      }catch{return 0}
    };
    
    // Fetch staking data - totalStaked() and totalLocked() from contract
    // Note: totalLocked is a SUBSET of totalStaked, not separate
    const fetchStakingData=async(stakingContract,tokenAddr,decimals,maxSupply)=>{
      try{
        let totalStakedTokens=0;
        let lockedTokens=0;
        
        // totalStaked() = 0x817b1cd2 - returns ALL tokens in staking (including locked)
        const stakedRes=await rpcFetch({jsonrpc:'2.0',method:'eth_call',params:[{to:stakingContract,data:'0x817b1cd2'},'latest'],id:1});
        console.log('totalStaked() raw:',stakedRes.result);
        if(stakedRes.result&&stakedRes.result!=='0x'&&stakedRes.result.length>2){
          totalStakedTokens=Number(BigInt(stakedRes.result))/Math.pow(10,decimals);
        }
        console.log('Total in staking contract:',totalStakedTokens);
        
        // totalLocked() = 0x56891412 - returns locked tokens (subset of totalStaked)
        const lockedRes=await rpcFetch({jsonrpc:'2.0',method:'eth_call',params:[{to:stakingContract,data:'0x56891412'},'latest'],id:2});
        console.log('totalLocked() raw:',lockedRes.result);
        if(lockedRes.result&&lockedRes.result!=='0x'&&lockedRes.result.length>2){
          lockedTokens=Number(BigInt(lockedRes.result))/Math.pow(10,decimals);
        }
        console.log('Locked tokens:',lockedTokens);
        
        // Staked (flexible) = totalStaked - totalLocked
        const stakedTokens=Math.max(0,totalStakedTokens-lockedTokens);
        console.log('Staked (flexible) tokens:',stakedTokens);
        
        // Calculate percentages using maxSupply (333,333,333,333)
        const stakedPct=maxSupply>0?(stakedTokens/maxSupply)*100:0;
        const lockedPct=maxSupply>0?(lockedTokens/maxSupply)*100:0;
        
        console.log('Staked %:',stakedPct.toFixed(4)+'%, Locked %:',lockedPct.toFixed(4)+'%');
        
        return{
          staked:stakedTokens,
          stakedPct,
          locked:lockedTokens,
          lockedPct
        };
      }catch(e){
        console.error('Error fetching staking data:',e);
        return{staked:0,stakedPct:0,locked:0,lockedPct:0};
      }
    };
    
    // Management wallet tokens with hardcoded prices (same as ProWeb)
    const MANAGEMENT_TOKENS = [
      { symbol: 'USDC', address: '0x15D38573d2feeb82e7ad5187aB8c1D52810B1f07', decimals: 6, price: 1 },
      { symbol: 'USDT', address: '0x0Cb6F5a34ad42ec934882A05265A7d5F59b51A2f', decimals: 6, price: 1 },
      { symbol: 'DAI', address: '0xefD766cCb38EaF1dfd701853BFCe31359239F305', decimals: 18, price: 1 },
      { symbol: 'PLSX', address: '0x95B303987A60C71504D99Aa1b13B4DA07b0790ab', decimals: 18, priceRatio: 0.00008 },
      { symbol: 'HEX', address: '0x2b591e99afE9f32eAA6214f7B7629768c40Eeb39', decimals: 8, price: 0.001 },
      { symbol: 'INC', address: '0x2fa878Ab3F87CC1C9737Fc071108F904c0B0C95d', decimals: 18, price: 0.20 },
      { symbol: 'WBTC', address: '0xb17D901469B9208B17d916112988A3FeD19b5cA1', decimals: 8, price: 97000 },
    ];
    
    // Fetch DAO data - matching ProWeb exactly
    const fetchDAOData=async(daoContract,managementWallet,plsPrice)=>{
      try{
        // 1. Get DAO contract PLS balance (eth_getBalance)
        const daoBalanceResult=await rpcFetch({jsonrpc:'2.0',method:'eth_getBalance',params:[daoContract,'latest'],id:1});
        const daoBalanceWei=BigInt(daoBalanceResult.result||'0x0');
        const daoBalancePLS=Number(daoBalanceWei)/1e18;
        console.log('DAO contract total:',daoBalancePLS,'PLS');
        
        // 2. Get lockedAmount() from DAO contract - selector 0x6ab28bc8
        let lockedAmountWei=0n;
        try{
          const lockResult=await rpcFetch({jsonrpc:'2.0',method:'eth_call',params:[{to:daoContract,data:'0x6ab28bc8'},'latest'],id:2});
          console.log('lockedAmount raw result:',lockResult.result);
          if(lockResult.result&&lockResult.result.length>2){
            lockedAmountWei=BigInt(lockResult.result);
          }
        }catch(e){console.error('lockedAmount error:',e)}
        const lockedAmountPLS=Number(lockedAmountWei)/1e18;
        console.log('Locked/pending amount:',lockedAmountPLS,'PLS');
        
        // 2b. Get proposal count and count active ones - proposalCount() selector 0xda35c664
        let pendingCount=0;
        try{
          const pcResult=await rpcFetch({jsonrpc:'2.0',method:'eth_call',params:[{to:daoContract,data:'0xda35c664'},'latest'],id:5});
          if(pcResult.result&&pcResult.result!=='0x'){
            const proposalCount=parseInt(pcResult.result,16);
            // Check state of recent proposals in parallel - state() selector 0x3e4f49e6
            const startId=Math.max(1,proposalCount-10);
            const statePromises=[];
            for(let i=proposalCount;i>=startId;i--){
              const idHex=i.toString(16).padStart(64,'0');
              statePromises.push(
                rpcFetch({jsonrpc:'2.0',method:'eth_call',params:[{to:daoContract,data:'0x3e4f49e6'+idHex},'latest'],id:6})
                  .then(r=>r.result?parseInt(r.result,16):-1)
                  .catch(()=>-1)
              );
            }
            const states=await Promise.all(statePromises);
            pendingCount=states.filter(s=>s===0||s===1).length;
          }
        }catch(e){console.error('proposalCount error:',e)}
        console.log('Active proposals:',pendingCount);
        
        // 3. Calculate available = total - locked (using BigInt for precision)
        const availableWei=daoBalanceWei>lockedAmountWei?daoBalanceWei-lockedAmountWei:0n;
        const availablePLS=Number(availableWei)/1e18;
        console.log('Available for new proposals:',availablePLS,'PLS');
        
        // 4. Get management wallet PLS balance
        const mgmtBalanceResult=await rpcFetch({jsonrpc:'2.0',method:'eth_getBalance',params:[managementWallet,'latest'],id:3});
        const mgmtPLSWei=BigInt(mgmtBalanceResult.result||'0x0');
        const mgmtPLS=Number(mgmtPLSWei)/1e18;
        console.log('Management wallet PLS:',mgmtPLS);
        
        // 5. Get management wallet token balances in parallel (same tokens as ProWeb)
        let managementTotalUSD=mgmtPLS*plsPrice;
        const managementTokens=[{symbol:'PLS',balance:mgmtPLS,usdValue:mgmtPLS*plsPrice}];
        
        const tokenPromises=MANAGEMENT_TOKENS.map(async(token)=>{
          try{
            const data='0x70a08231000000000000000000000000'+managementWallet.slice(2).toLowerCase();
            const tokenResult=await rpcFetch({jsonrpc:'2.0',method:'eth_call',params:[{to:token.address,data},'latest'],id:4});
            if(tokenResult.result&&tokenResult.result!=='0x'&&tokenResult.result!=='0x0'){
              const balanceWei=BigInt(tokenResult.result);
              const balance=Number(balanceWei)/Math.pow(10,token.decimals);
              if(balance>0.01){
                const price=token.price!==undefined?token.price:(token.priceRatio?plsPrice*token.priceRatio:0);
                const usdValue=balance*price;
                console.log(`Management ${token.symbol}: ${balance.toLocaleString()} ($${usdValue.toLocaleString()})`);
                return{symbol:token.symbol,balance,usdValue};
              }
            }
          }catch(e){console.error(`Error fetching ${token.symbol}:`,e)}
          return null;
        });
        
        const tokenResults=await Promise.all(tokenPromises);
        tokenResults.forEach(t=>{
          if(t&&t.usdValue>0){
            managementTokens.push(t);
            managementTotalUSD+=t.usdValue;
          }
        });
        console.log('Management wallet total USD:',managementTotalUSD);
        
        // 6. Calculate totals
        const availableUSD=availablePLS*plsPrice;
        const pendingUSD=lockedAmountPLS*plsPrice;
        const totalValue=availableUSD+pendingUSD+managementTotalUSD;
        
        console.log('Total DAO value:',totalValue);
        
        return{
          availablePLS,
          availableUSD,
          pendingPLS:lockedAmountPLS,
          pendingUSD,
          pendingCount,
          managementValue:managementTotalUSD,
          managementTokens,
          totalValue
        };
      }catch(e){
        console.error('Error fetching DAO data:',e);
        return null;
      }
    };
    
    // Fetch holders - stop after Dolphin tier, calculate rest as Squid & Below
    const fetchHolderTiers=async(addr,cfg,totalHolderCount,lpAddresses=[])=>{
      const counts={Poseidon:0,Whale:0,Shark:0,Dolphin:0};
      let nextPageParams=null;
      let totalFetched=0;
      const maxPages=10; // Reduced for faster loading
      let page=0;
      let countedHolders=0;
      
      // Combine static LP addresses with dynamic ones (exclude LP pools only)
      const allLPAddresses=[...LP_ADDRESSES,...lpAddresses].map(a=>a.toLowerCase());
      
      try{
        while(page<maxPages){
          const url=nextPageParams
            ?`https://api.scan.pulsechain.com/api/v2/tokens/${addr}/holders?${nextPageParams}`
            :`https://api.scan.pulsechain.com/api/v2/tokens/${addr}/holders?limit=50`;
          
          // Add timeout to prevent hanging
          const controller=new AbortController();
          const timeoutId=setTimeout(()=>controller.abort(),8000);
          
          try{
            const r=await fetch(url,{signal:controller.signal});
            clearTimeout(timeoutId);
            const data=await r.json();
            const items=data.items||[];
            
            if(items.length===0)break;
            
            let foundBelowDolphin=false;
            
            for(const holder of items){
              const holderAddr=holder.address?.hash?.toLowerCase();
              if(allLPAddresses.includes(holderAddr))continue;
              if(cfg.stakingContract&&holderAddr===cfg.stakingContract.toLowerCase())continue;
              
              const tokens=parseFloat(holder.value||0)/Math.pow(10,cfg.decimals);
              const pctOfSupply=(tokens/cfg.totalSupply)*100;
              
              // Stop at Dolphin threshold (0.01%)
              if(pctOfSupply<0.01){
                foundBelowDolphin=true;
                break;
              }
              
              if(pctOfSupply>=10)counts.Poseidon++;
              else if(pctOfSupply>=1)counts.Whale++;
              else if(pctOfSupply>=0.1)counts.Shark++;
              else if(pctOfSupply>=0.01)counts.Dolphin++;
              
              countedHolders++;
            }
            
            totalFetched+=items.length;
            
            if(foundBelowDolphin)break;
            
            if(data.next_page_params){
              const params=new URLSearchParams();
              Object.entries(data.next_page_params).forEach(([k,v])=>params.set(k,v));
              nextPageParams=params.toString();
            }else{
              break;
            }
            page++;
          }catch(fetchError){
            clearTimeout(timeoutId);
            if(fetchError.name==='AbortError'){
              console.log('Holder tier fetch timed out on page',page);
            }else{
              console.error('Error on page',page,':',fetchError);
            }
            break; // Stop on any error
          }
        }
      }catch(e){
        console.error('Error fetching holders:',e);
      }
      
      // Squid & Below = total holders - counted tiers - LP addresses - staking contract
      const excludedAddresses=allLPAddresses.length+(cfg.stakingContract?1:0);
      const squidAndBelow=Math.max(0,totalHolderCount-countedHolders-excludedAddresses);
      
      return{counts,countedHolders,squidAndBelow,total:totalFetched};
    };
    
    const DonutChart=({data,colors,size=120})=>{
      const total=data.reduce((s,d)=>s+d.value,0);
      if(total===0)return<svg width={size} height={size}><circle cx={size/2} cy={size/2} r={size/2-10} fill="none" stroke="#333" strokeWidth={size*0.17}/></svg>;
      let cumulative=0;
      const r=size/2;
      const strokeWidth=r*0.35;
      const radius=r-strokeWidth/2;
      const circumference=2*Math.PI*radius;
      
      return(
        <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
          {data.map((d,i)=>{
            const pct=total>0?(d.value/total)*100:0;
            const offset=circumference*(1-cumulative/100);
            const length=circumference*(pct/100);
            cumulative+=pct;
            return<circle key={i} cx={r} cy={r} r={radius} fill="none" stroke={colors[i%colors.length]} strokeWidth={strokeWidth} strokeDasharray={`${length} ${circumference-length}`} strokeDashoffset={offset} transform={`rotate(-90 ${r} ${r})`}/>;
          })}
          <circle cx={r} cy={r} r={radius-strokeWidth/2} fill="#0a0a0a"/>
        </svg>
      );
    };
    
    const AllocationModal=({open,close,token,cfg,theme,burn,tokensInLP,totalSupply,stakingData,totalHolderCount})=>{
      const[tierCounts,setTierCounts]=useState({Poseidon:0,Whale:0,Shark:0,Dolphin:0,Squid:0});
      const[turtleAndBelow,setTurtleAndBelow]=useState(0);
      const[loading,setLoading]=useState(true);
      const[progress,setProgress]=useState(0);
      
      useEffect(()=>{
        if(!open)return;
        setLoading(true);
        setProgress(0);
        setTierCounts({Poseidon:0,Whale:0,Shark:0,Dolphin:0,Squid:0});
        setTurtleAndBelow(0);
        
        fetchHolderTiers(cfg.address,cfg,totalHolderCount,(fetched,counts,counted)=>{
          setProgress(fetched);
          setTierCounts({...counts});
        }).then(({counts,turtleAndBelow})=>{
          setTierCounts(counts);
          setTurtleAndBelow(turtleAndBelow);
          setLoading(false);
        });
      },[open,cfg,totalHolderCount]);
      
      if(!open)return null;
      
      // Use cfg.totalSupply (hardcoded max supply: 333,333,333,333 for PTGC)
      const maxSupply=cfg.totalSupply;
      const burnedTokens=burn?.total||0;
      const burnedPct=maxSupply>0?burnedTokens/maxSupply*100:0;
      const lpPct=maxSupply>0?(tokensInLP/maxSupply)*100:0;
      const stakedTokens=stakingData?.staked||0;
      const lockedTokens=stakingData?.locked||0;
      const stakedPct=stakingData?.stakedPct||0;
      const lockedPct=stakingData?.lockedPct||0;
      // Held = Total Supply - Burned - In LP - Staked - Locked
      const heldTokens=Math.max(0,maxSupply-burnedTokens-tokensInLP-stakedTokens-lockedTokens);
      const heldPct=maxSupply>0?(heldTokens/maxSupply)*100:0;
      
      const isPTGC=token==='PTGC';
      const chartData=isPTGC?[
        {label:'Burned',value:burnedPct},
        {label:'In LP',value:lpPct},
        {label:'Staked',value:stakedPct},
        {label:'Staked/Locked',value:lockedPct},
        {label:'Held',value:heldPct}
      ]:[
        {label:'Burned',value:burnedPct},
        {label:'In LP',value:lpPct},
        {label:'Held',value:100-burnedPct-lpPct}
      ];
      
      const chartColors=isPTGC?['#f97316','#3b82f6','#a855f7','#ec4899',cfg.colorHex]:['#f97316','#3b82f6',cfg.colorHex];
      
      const displayCounts={
        Poseidon:tierCounts.Poseidon,
        Whale:tierCounts.Whale,
        Shark:tierCounts.Shark,
        Dolphin:tierCounts.Dolphin,
        Squid:tierCounts.Squid,
        'Turtle & Below':turtleAndBelow
      };
      const totalCountedHolders=Object.values(tierCounts).reduce((s,c)=>s+c,0)+turtleAndBelow;
      
      return(
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay bg-black/70" onClick={close}>
          <div className={`bg-[#111] border ${theme.border} rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto`} onClick={e=>e.stopPropagation()}>
            <div className="p-5">
              <div className="flex justify-between items-center mb-4">
                <h2 className={`text-xl font-bold ${theme.text}`}>{'\u{1F4CA}'} {token} Token Allocation</h2>
                <button onClick={close} className="text-white/60 hover:text-white text-2xl">{'\u00D7'}</button>
              </div>
              
              <div className="flex items-center justify-center gap-6 mb-4">
                <DonutChart data={chartData} colors={chartColors} size={140}/>
                <div className="space-y-1">
                  {chartData.map((d,i)=>(
                    <div key={i} className="flex items-center gap-2 text-sm">
                      <div className="w-3 h-3 rounded-full" style={{background:chartColors[i]}}></div>
                      <span className="text-white/70">{d.label}:</span>
                      <span className={`font-bold ${theme.text}`}>{d.value.toFixed(2)}%</span>
                    </div>
                  ))}
                </div>
              </div>
              
              <div className={`${theme.card} border ${theme.border} rounded-xl p-4`}>
                <div className="flex justify-between items-center mb-3">
                  <div className="text-white/60 text-xs uppercase">Holder Distribution by % of Supply</div>
                  {loading&&<div className="text-white/40 text-xs">Scanning...</div>}
                </div>
                
                <div className="grid grid-cols-3 gap-3">
                  {HOLDER_TIERS_DISPLAY.map(tier=>(
                    <div key={tier.n} className="text-center">
                      <div className="text-2xl mb-1">{tier.e}</div>
                      <div className={`text-lg font-bold ${theme.text}`}>{displayCounts[tier.n]||0}</div>
                      <div className="text-white/50 text-xs">{tier.n}</div>
                    </div>
                  ))}
                </div>
                
                {loading?(
                  <div className="flex items-center justify-center gap-2 mt-3">
                    <div className="w-4 h-4 border-2 border-t-transparent rounded-full animate-spin" style={{borderColor:`${cfg.colorHex} transparent transparent transparent`}}></div>
                    <span className="text-white/50 text-sm">Loading holders...</span>
                  </div>
                ):(
                  <div className="text-center text-white/40 text-xs mt-3">Total: {fmt(totalCountedHolders)} holders (excludes LPs & staking)</div>
                )}
                
                <div className="text-white/40 text-xs mt-3 pt-3 border-t border-white/10">
                  {'\u{1F531}'} 10%+ {'\u2022'} {'\u{1F40B}'} 1%+ {'\u2022'} {'\u{1F988}'} 0.1%+ {'\u2022'} {'\u{1F42C}'} 0.01%+ {'\u2022'} {'\u{1F991}'} 0.001%+ {'\u2022'} {'\u{1F422}'} Below
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    const ValueGenModal=({open,close,token,vol,cfg,theme})=>{
      const[period,setPeriod]=useState('24h');
      if(!open)return null;
      
      // 24h volume is always actual from DexScreener
      // 7d, 30d, 90d are estimates based on 24h
      const vol24h=vol;
      const vol7d=vol*7;
      const vol30d=vol*30;
      const vol90d=vol*90;
      
      const periodVols={'24h':vol24h,'7d':vol7d,'30d':vol30d,'90d':vol90d};
      const periodVol=periodVols[period];
      const total=periodVol*cfg.taxRate;
      const isEstimate=period!=='24h';
      
      return(
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay bg-black/70" onClick={close}>
          <div className={`bg-[#111] border ${theme.border} rounded-2xl max-w-md w-full`} onClick={e=>e.stopPropagation()}>
            <div className="p-4">
              <div className="flex justify-between items-center mb-3">
                <h2 className={`text-lg font-bold ${theme.text}`}>{'\u{1F4B0}'} {token} Value Generation</h2>
                <button onClick={close} className="text-white/60 hover:text-white text-xl">{'\u00D7'}</button>
              </div>
              
              <div className="flex gap-1 mb-4 bg-black/30 rounded-lg p-1">
                {['24h','7d','30d','90d'].map(p=>(
                  <button key={p} onClick={()=>setPeriod(p)} className={`flex-1 py-2 rounded-md text-sm font-medium transition ${period===p?`${theme.bg} text-black`:'text-white/60 hover:text-white'}`}>{p.toUpperCase()}{p!=='24h'&&<span className="text-xs opacity-60">*</span>}</button>
                ))}
              </div>
              
              <div className="text-center mb-4">
                <div className="text-white/50 text-sm flex items-center justify-center gap-2">
                  Volume ({period.toUpperCase()}): {fmtUSD(periodVol)}
                </div>
                <div className="text-4xl font-bold text-green-400 my-2">{fmtUSD(total)}</div>
                <div className="text-white/50 text-sm">{(cfg.taxRate*100)}% Tax Generated {isEstimate?'(est)':''}</div>
                {isEstimate&&<div className="text-white/40 text-xs mt-1">* Projected based on 24H actual volume</div>}
              </div>
              
              <div className="space-y-2">
                {cfg.taxBreakdown.map((item,i)=>(
                  <div key={i} className={`${theme.card} border ${theme.border} rounded-lg px-3 py-2 flex justify-between items-center`}>
                    <span className="text-white/70 text-sm"><span className="mr-2">{item.emoji}</span>{item.name}</span>
                    <span className={`font-bold ${theme.text}`}>{fmtUSD(periodVol*(item.pct/100))}</span>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    // Holder Growth Chart Modal using Chart.js
    const HolderChartModal=({open,close,token,currentHolders,theme,cfg})=>{
      const[chartData,setChartData]=useState([]);
      const[chartError,setChartError]=useState(null);
      const chartRef=React.useRef(null);
      const chartInstance=React.useRef(null);
      
      useEffect(()=>{
        if(!open)return;
        const loadData=async()=>{
          try{
            console.log('Loading holder history...');
            const hist=await fetchHolderHistory();
            console.log('Holder history loaded:',hist);
            if(hist&&hist.data){
              const key=token.toLowerCase();
              let data=hist.data.map(d=>({
                month:d.month,
                date:d.date,
                holders:d[key]||0
              }));
              // Add current holders as latest data point if different month
              const today=new Date().toISOString().slice(0,7);
              const lastMonth=data[data.length-1]?.month;
              if(today!==lastMonth&&currentHolders>0){
                data.push({month:today,date:new Date().toISOString().slice(0,10),holders:currentHolders});
              }
              // Only show last 12 months
              data=data.slice(-12);
              console.log('Chart data (last 12 months):',data);
              setChartData(data);
            }
          }catch(e){
            console.error('Error loading holder history:',e);
            setChartError(e.message);
          }
        };
        loadData();
      },[open,token,currentHolders]);
      
      useEffect(()=>{
        if(!open||!chartRef.current||chartData.length===0)return;
        
        console.log('Creating chart, Chart.js available:',!!window.Chart);
        
        if(!window.Chart){
          setChartError('Chart.js not loaded');
          return;
        }
        
        // Destroy existing chart
        if(chartInstance.current){
          chartInstance.current.destroy();
        }
        
        try{
          const ctx=chartRef.current.getContext('2d');
          const gradient=ctx.createLinearGradient(0,0,0,250);
          gradient.addColorStop(0,cfg.colorHex+'66');
          gradient.addColorStop(1,cfg.colorHex+'00');
          
          chartInstance.current=new window.Chart(ctx,{
            type:'line',
            data:{
              labels:chartData.map(d=>d.month.slice(5)),
              datasets:[{
                label:token+' Holders',
                data:chartData.map(d=>d.holders),
                borderColor:cfg.colorHex,
                backgroundColor:gradient,
                borderWidth:3,
                fill:true,
                tension:0.4,
                pointBackgroundColor:cfg.colorHex,
                pointBorderColor:'#111',
                pointBorderWidth:2,
                pointRadius:4,
                pointHoverRadius:6
              }]
            },
            options:{
              responsive:true,
              maintainAspectRatio:false,
              plugins:{
                legend:{display:false},
                tooltip:{
                  backgroundColor:'#1a1a1a',
                  borderColor:cfg.colorHex,
                  borderWidth:1,
                  titleColor:'#fff',
                  bodyColor:'#fff',
                  padding:12,
                  displayColors:false,
                  callbacks:{
                    label:(ctx)=>ctx.parsed.y.toLocaleString()+' holders'
                  }
                }
              },
              scales:{
                x:{
                  grid:{color:'#333',drawBorder:false},
                  ticks:{color:'#999'}
                },
                y:{
                  grid:{color:'#333',drawBorder:false},
                  ticks:{color:'#999',callback:v=>v>=1000?(v/1000).toFixed(0)+'K':v}
                }
              }
            }
          });
          console.log('Chart created successfully');
        }catch(e){
          console.error('Error creating chart:',e);
          setChartError(e.message);
        }
        
        return()=>{
          if(chartInstance.current){
            chartInstance.current.destroy();
          }
        };
      },[open,chartData,cfg.colorHex,token]);
      
      if(!open)return null;
      
      const firstHolders=chartData[0]?.holders||0;
      const lastHolders=chartData[chartData.length-1]?.holders||currentHolders||0;
      const growth=firstHolders>0?((lastHolders-firstHolders)/firstHolders*100):0;
      const totalGrowth=lastHolders-firstHolders;
      
      return(
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay bg-black/70" onClick={close}>
          <div className={`bg-[#111] border ${theme.border} rounded-2xl max-w-2xl w-full`} onClick={e=>e.stopPropagation()}>
            <div className="p-5">
              <div className="flex justify-between items-center mb-4">
                <div className="flex items-center gap-3">
                  <span className="text-3xl">{'\u{1F4C8}'}</span>
                  <div>
                    <h2 className={`text-xl font-bold ${theme.text}`}>{token} Holder Growth</h2>
                    <div className="text-white/40 text-sm">Historical holder count over time</div>
                  </div>
                </div>
                <button onClick={close} className="text-white/60 hover:text-white text-2xl">{'\u00D7'}</button>
              </div>
              
              <div className="grid grid-cols-3 gap-3 mb-4">
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3 text-center`}>
                  <div className="text-white/50 text-xs uppercase mb-1">Current</div>
                  <div className={`text-2xl font-bold ${theme.text}`}>{fmt(lastHolders)}</div>
                </div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3 text-center`}>
                  <div className="text-white/50 text-xs uppercase mb-1">Growth</div>
                  <div className={`text-2xl font-bold ${growth>=0?'text-green-400':'text-red-400'}`}>+{fmt(totalGrowth)}</div>
                </div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3 text-center`}>
                  <div className="text-white/50 text-xs uppercase mb-1">% Change</div>
                  <div className={`text-2xl font-bold ${growth>=0?'text-green-400':'text-red-400'}`}>{growth>=0?'+':''}{growth.toFixed(1)}%</div>
                </div>
              </div>
              
              <div className={`${theme.card} border ${theme.border} rounded-xl p-4 relative`} style={{height:'300px'}}>
                <canvas ref={chartRef} style={{width:'100%',height:'100%'}}></canvas>
                {chartData.length===0&&!chartError&&(
                  <div className="flex items-center justify-center h-full absolute inset-0">
                    <div className="text-white/50">Loading chart data...</div>
                  </div>
                )}
                {chartError&&(
                  <div className="flex items-center justify-center h-full absolute inset-0">
                    <div className="text-red-400">Error: {chartError}</div>
                  </div>
                )}
              </div>
              
              <div className="text-center text-white/40 text-xs mt-3">
                Data from {chartData[0]?.month||'...'} to {chartData[chartData.length-1]?.month||'now'}
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    const BurnModal=({open,close,token,burn,price,cfg})=>{
      const[hist,setHist]=useState({h12:null,h24:null,d7:null,d30:null});
      useEffect(()=>{
        if(!open)return;
        // Load from cache immediately
        const periods=getBurnPeriods(token);
        setHist({h12:periods.h12,h24:periods.h24,d7:periods.d7,d30:periods.d30});
      },[open,token]);
      if(!open)return null;
      const theme={text:cfg.color==='gold'?'text-[#D9CA5D]':'text-[#7CFC00]'};
      const creatures=getBurnC(burn?.pct||0,'Squid');
      const maxSupply=cfg.totalSupply;
      const getPct=a=>maxSupply>0?(a/maxSupply)*100:0;
      const whaleProgress=getWhaleProgress(burn?.pct||0);
      const boxes=[{l:'12H',v:hist.h12},{l:'24H',v:hist.h24},{l:'7D',v:hist.d7},{l:'30D',v:hist.d30}];
      return(
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay bg-black/70" onClick={close}>
          <div className="bg-[#111] border border-orange-500/30 rounded-2xl max-w-2xl w-full" onClick={e=>e.stopPropagation()}>
            <div className="p-5">
              <div className="flex justify-between mb-4">
                <div className="flex items-center gap-4"><img src={cfg.logo} alt={token} className="w-16 h-16 sm:w-20 sm:h-20"/><div><h2 className="text-2xl font-bold text-orange-400 font-orbitron">{token} Burn Stats</h2><div className="text-white/40 text-sm">{'\u{1F525}'} Total Supply Burned</div></div></div>
                <button onClick={close} className="text-white/60 hover:text-white text-2xl">{'\u00D7'}</button>
              </div>
              <div className="bg-gradient-to-r from-orange-500/15 to-orange-600/10 border border-orange-500/30 rounded-xl p-4 mb-4">
                <div className="grid grid-cols-3 gap-3 text-center mb-3">
                  <div><div className="text-orange-400/70 text-xs uppercase">Burned</div><div className={`text-2xl font-bold ${theme.text}`}>{fmt(burn?.total)}</div></div>
                  <div><div className="text-orange-400/70 text-xs uppercase">USD Value</div><div className="text-2xl font-bold text-green-400">{fmtUSD((burn?.total||0)*price)}</div></div>
                  <div><div className="text-orange-400/70 text-xs uppercase">% Supply</div><div className="text-2xl font-bold text-white">{(burn?.pct||0).toFixed(2)}%</div></div>
                </div>
                <div className="flex items-center gap-2 mb-3">
                  <div className="flex-1 h-3 bg-black/50 rounded-full overflow-hidden"><div className="h-full bg-gradient-to-r from-orange-500 to-orange-400 rounded-full" style={{width:`${whaleProgress.progress}%`}}></div></div>
                  <span className="text-xl">{'\u{1F40B}'}</span>
                  <span className="text-orange-400/70 text-sm">{whaleProgress.progress.toFixed(1)}%</span>
                </div>
                <div className="flex items-center justify-center gap-2 flex-wrap"><span className="text-3xl animate-fire">{'\u{1F525}'}</span>{creatures.map((c,i)=><span key={i} className="flex items-center gap-1"><span className="text-3xl">{c.e}</span><span className="text-white/80 text-lg font-bold">x{c.cnt}</span></span>)}</div>
              </div>
              <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
                {boxes.map(({l,v})=>{
                  const isLoading=v===null;
                  const pct=!isLoading?getPct(v):0;
                  const c=!isLoading&&v>0?getHighestCreatureWithCount(pct):{e:'\u{1F41A}',cnt:0};
                  return(
                  <div key={l} className="bg-[#1a1a1a] border border-orange-500/20 rounded-xl p-4">
                    <div className="flex justify-between mb-2">
                      <span className="text-white/60 text-base font-medium">{l}</span>
                      <div className="flex items-center gap-1">
                        <span className="text-3xl">{isLoading?'\u{23F3}':c.e}</span>
                        {!isLoading&&c.cnt>0&&<span className="text-white/70 text-base font-bold">x{c.cnt}</span>}
                      </div>
                    </div>
                    {isLoading?<div className="animate-pulse-slow text-orange-400/50 text-lg">Loading...</div>:<><div className="text-2xl font-bold text-orange-400">{fmt(v)}</div><div className="text-base text-green-400">{fmtUSD(v*price)}</div></>}
                  </div>
                )})}
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    const LPRow=({pair,theme,mainAddr})=>{
      const[logoErr,setLogoErr]=useState(false);
      const[det,setDet]=useState(false);
      const liq=pair.liq||0,vol=pair.vol||0;
      const ratio=liq>0?(vol/liq).toFixed(3):'0.000';
      const buys=pair.txns?.h24?.buys||0,sells=pair.txns?.h24?.sells||0;
      const chg=pair.priceChange?.h24||0,up=chg>=0;
      const isBase=pair.baseToken?.address?.toLowerCase()===mainAddr?.toLowerCase();
      const other=isBase?pair.quoteToken:pair.baseToken;
      const logo=getLogo(other?.address);
      const baseReserve=pair.liquidity?.base||0,quoteReserve=pair.liquidity?.quote||0;
      return(
        <div className={`${theme.card} border ${theme.border} rounded-lg p-3 sm:p-4 hover:border-opacity-60`}>
          <div className="hidden sm:grid grid-cols-12 gap-2 items-center">
            <div className="col-span-1 flex justify-center">{!logoErr&&logo?<img src={logo} className="w-10 h-10 rounded-full bg-black/50" onError={()=>setLogoErr(true)}/>:<div className="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center font-bold">{other?.symbol?.[0]}</div>}</div>
            <div className="col-span-2"><div className={`font-semibold ${theme.text}`}>{pair.baseToken?.symbol}/{pair.quoteToken?.symbol}</div><div className="text-gray-500 text-sm">PulseX V2</div></div>
            <div className="col-span-2 text-right"><div className="text-white text-xs">Volume</div><div className="text-white font-semibold">{fmtUSD(vol)}</div></div>
            <div className="col-span-2 text-right"><div className="text-white text-xs">Liquidity</div><div className="text-white">{fmtUSD(liq)}</div></div>
            <div className="col-span-1 text-center"><div className="text-white text-xs">24h</div><div className={up?'text-green-400':'text-red-400'}>{up?'\u25B2':'\u25BC'} {Math.abs(chg).toFixed(1)}%</div></div>
            <div className="col-span-1 text-center"><div className="text-white text-xs">Txns</div><div><span className="text-green-400">{buys}</span>/<span className="text-red-400">{sells}</span></div></div>
            <div className="col-span-1 text-right"><div className="text-white text-xs">Vol/Liq</div><div className="text-white">{ratio}</div></div>
            <div className="col-span-2 flex justify-end gap-2"><button onClick={()=>setDet(!det)} className="text-lg hover:scale-110">{'\u2139\uFE0F'}</button><a href={`https://dexscreener.com/pulsechain/${pair.pairAddress}`} target="_blank" className="text-lg hover:scale-110">{'\u{1F4C8}'}</a><a href={`https://www.dextools.io/app/en/pulse/pair-explorer/${pair.pairAddress}`} target="_blank" className="text-lg hover:scale-110">{'\u{1F4CA}'}</a></div>
          </div>
          <div className="sm:hidden">
            <div className="flex items-center gap-3 mb-2">{!logoErr&&logo?<img src={logo} className="w-8 h-8 rounded-full bg-black/50" onError={()=>setLogoErr(true)}/>:<div className="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-xs font-bold">{other?.symbol?.[0]}</div>}<div className="flex-1"><div className={`font-semibold ${theme.text} text-sm`}>{pair.baseToken?.symbol}/{pair.quoteToken?.symbol}</div></div><div className={`text-sm font-semibold ${up?'text-green-400':'text-red-400'}`}>{up?'\u25B2':'\u25BC'} {Math.abs(chg).toFixed(1)}%</div></div>
            <div className="grid grid-cols-4 gap-2 text-center text-xs"><div><div className="text-gray-400">Vol</div><div className="text-white">{fmtUSD(vol)}</div></div><div><div className="text-gray-400">Liq</div><div className="text-white">{fmtUSD(liq)}</div></div><div><div className="text-gray-400">Txns</div><div><span className="text-green-400">{buys}</span>/<span className="text-red-400">{sells}</span></div></div><div><div className="text-gray-400">V/L</div><div className="text-white">{ratio}</div></div></div>
          </div>
          {det&&(
            <div className="mt-3 pt-3 border-t border-white/10 grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm">
              <div><span className="text-gray-400">Pair:</span> <span className="text-white font-mono text-xs">{pair.pairAddress?.slice(0,10)}...</span></div>
              <div><span className="text-gray-400">Created:</span> <span className="text-white">{pair.pairCreatedAt?new Date(pair.pairCreatedAt).toLocaleDateString():'\u2014'}</span></div>
              <div><span className="text-gray-400">Price:</span> <Price p={parseFloat(pair.priceUsd)} c="text-white"/></div>
              <div><span className="text-gray-400">FDV:</span> <span className="text-white">{fmtUSD(pair.fdv)}</span></div>
              <div><span className="text-gray-400">{pair.baseToken?.symbol}:</span> <span className={theme.text}>{fmt(baseReserve)}</span></div>
              <div><span className="text-gray-400">{pair.quoteToken?.symbol}:</span> <span className="text-white">{fmt(quoteReserve)}</span></div>
            </div>
          )}
        </div>
      );
    };
    
    const Home=({onSelect})=>{
      const[data,setData]=useState({PTGC:null,UFO:null});
      const[loading,setLoading]=useState(true);
      useEffect(()=>{const load=async()=>{const[p,u]=await Promise.all([fetchDex(TOKENS.PTGC.address,TOKENS.PTGC.mainPair),fetchDex(TOKENS.UFO.address,TOKENS.UFO.mainPair)]);setData({PTGC:p,UFO:u});setLoading(false)};load()},[]);
      const Card=({token,d})=>{
        const cfg=TOKENS[token],isGold=cfg.color==='gold';
        const border=isGold?'border-[#D9CA5D]/50':'border-[#7CFC00]/50',text=isGold?'text-[#D9CA5D]':'text-[#7CFC00]';
        const bg=isGold?'bg-gradient-to-r from-[#D9CA5D]/20 via-[#1a1a1a] to-[#1a1a1a]':'bg-gradient-to-r from-[#7CFC00]/20 via-[#1a1a1a] to-[#1a1a1a]';
        const hover=isGold?'token-card-gold':'token-card-green',up=(d?.change||0)>=0;
        return(
          <div onClick={()=>onSelect(token)} className={`token-card ${hover} cursor-pointer rounded-2xl border-2 ${border} ${bg} p-4 sm:p-6 lg:p-8`}>
            <div className="flex flex-col sm:flex-row items-center gap-4 sm:gap-6">
              <img src={cfg.logo} alt={token} className="w-20 h-20 sm:w-24 sm:h-24 lg:w-32 lg:h-32 object-contain"/>
              <div className="text-center sm:text-left"><div className={`font-orbitron text-2xl sm:text-3xl lg:text-4xl font-bold ${text}`}>{token}</div><div className="text-white/40 text-xs font-mono mt-1">{cfg.address.slice(0,6)}...{cfg.address.slice(-4)}</div></div>
              <div className="flex-1 text-center sm:text-right"><Price p={d?.price} c="text-white font-bold text-xl sm:text-2xl lg:text-3xl"/><div className="text-white/50 text-sm sm:text-lg mt-1">MCap: {fmtUSD(d?.mcap)}</div><div className="text-white/50 text-sm sm:text-base">Vol: {fmtUSD(d?.vol)}</div></div>
              <div className="flex items-center gap-2 sm:gap-4"><svg viewBox="0 0 100 24" className="w-16 sm:w-20 h-6"><polyline points={up?"0,20 30,14 60,11 100,5":"0,5 30,10 60,12 100,18"} fill="none" stroke={up?'#22c55e':'#ef4444'} strokeWidth="2"/></svg><div className={`px-2 sm:px-3 py-1 rounded-lg text-sm sm:text-lg font-bold ${up?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`}>{up?'\u25B2':'\u25BC'} {Math.abs(d?.change||0).toFixed(2)}%</div></div>
            </div>
          </div>
        );
      };
      return(
        <div className="min-h-screen flex flex-col px-4">
          <header className="text-center pt-4"><img src={COMBINED_LOGO} alt="PTGC & UFO" className="h-48 sm:h-64 md:h-80 lg:h-96 mx-auto"/><h1 className="font-orbitron text-3xl sm:text-4xl lg:text-5xl font-bold mb-2 -mt-6 sm:-mt-10" style={{background:'linear-gradient(180deg,#FFF,#808080)',WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent'}}>DASHBOARD</h1><p className="text-white/50 text-sm sm:text-lg mb-6 sm:mb-10">A community tool built for The Grays Ecosystem</p></header>
          <div className="flex-1 flex justify-center pb-8"><div className="flex flex-col gap-4 sm:gap-6 max-w-4xl w-full">{loading?<><div className="animate-pulse bg-white/10 rounded-2xl h-32"></div><div className="animate-pulse bg-white/10 rounded-2xl h-32"></div></>:<><Card token="PTGC" d={data.PTGC}/><Card token="UFO" d={data.UFO}/></>}</div></div>
          <footer className="text-center py-4 border-t border-white/10"><p className="text-white/30 text-xs">Not financial advice. DYOR.</p></footer>
        </div>
      );
    };
    
    const Dashboard=({token,onBack,onSwitch})=>{
      const cfg=TOKENS[token],isGold=cfg.color==='gold';
      const theme={text:isGold?'text-[#D9CA5D]':'text-[#7CFC00]',border:isGold?'border-[#D9CA5D]/30':'border-[#7CFC00]/30',bg:isGold?'bg-[#D9CA5D]':'bg-[#7CFC00]',card:'bg-[#111]/80'};
      const[data,setData]=useState(null);
      const[burn,setBurn]=useState({total:0,pct:0,supply:0});
      const[holders,setHolders]=useState(0);
      const[pls,setPls]=useState(0.00005);
      const[loading,setLoading]=useState(true);
      const[sortBy,setSortBy]=useState('volume');
      const[sortDir,setSortDir]=useState('desc');
      const[lastUpdate,setLastUpdate]=useState(new Date());
      const[burnPeriods,setBurnPeriods]=useState({h12:0,h24:0,d7:0,d30:0,d90:0});
      const[valueGenPeriod,setValueGenPeriod]=useState('7d');
      const[daoData,setDaoData]=useState(null);
      const[daoLoading,setDaoLoading]=useState(true);
      const[showMgmtTokens,setShowMgmtTokens]=useState(false);
      const[stakingData,setStakingData]=useState({totalInContract:0,staked:0,stakedPct:0,locked:0,lockedPct:0});
      const[holderTiers,setHolderTiers]=useState({Poseidon:0,Whale:0,Shark:0,Dolphin:0,SquidAndBelow:0});
      const[copied,setCopied]=useState(false);
      const[ptgcPrice,setPtgcPrice]=useState(0);
      const[holderChange,setHolderChange]=useState(null);
      const[showKPI,setShowKPI]=useState(false);
      const copyAddress=()=>{navigator.clipboard.writeText(cfg.address);setCopied(true);setTimeout(()=>setCopied(false),2000)};
      
      useEffect(()=>{
        // Reset all state immediately when token changes
        setData(null);
        setBurn({total:0,pct:0,supply:0});
        setHolders(0);
        setLoading(true);
        setDaoData(null);
        setDaoLoading(true);
        setStakingData({totalInContract:0,staked:0,stakedPct:0,locked:0,lockedPct:0});
        setHolderTiers({Poseidon:0,Whale:0,Shark:0,Dolphin:0,SquidAndBelow:0});
        setPtgcPrice(0);
        setHolderChange(null);
        setBurnPeriods({h12:0,h24:0,d7:0,d30:0,d90:0});
        setValueGenPeriod('7d');
        
        const load=async()=>{
          // Load burn history cache first (needed for holders from Moralis)
          await fetchBurnHistory();
          // Load holder history cache (for holder chart and change indicator)
          await fetchHolderHistory();
          
          // Load burn periods from cache
          const periods=getBurnPeriods(token);
          setBurnPeriods(periods);
          
          const[d,h,b,p]=await Promise.all([fetchDex(cfg.address,cfg.mainPair),fetchHolders(cfg.address),fetchBurn(cfg.address,cfg.decimals),fetchPLS()]);
          setData(d);setHolders(h);setBurn(b);setPls(p);setLastUpdate(new Date());setLoading(false);
          
          // Update holder change with current holder count
          const hc=getHolderChange(token,h);
          if(hc!==null)setHolderChange(hc);
          
          // Start these in parallel after initial load
          if(cfg.stakingContract){
            fetchStakingData(cfg.stakingContract,cfg.address,cfg.decimals,cfg.totalSupply).then(staking=>setStakingData(staking));
          }
          
          // Fetch holder tiers for all tokens - pass LP pair addresses
          const lpPairAddresses=d?.pairs?.map(p=>p.pairAddress).filter(Boolean)||[];
          fetchHolderTiers(cfg.address,cfg,h,lpPairAddresses).then(result=>{
            setHolderTiers({
              Poseidon:result.counts.Poseidon||0,
              Whale:result.counts.Whale||0,
              Shark:result.counts.Shark||0,
              Dolphin:result.counts.Dolphin||0,
              SquidAndBelow:result.squidAndBelow||0
            });
          });
          
          if(cfg.hasDAO&&cfg.daoContract){
            setDaoLoading(true);
            fetchDAOData(cfg.daoContract,cfg.daoTreasury,p).then(dao=>{
              setDaoData(dao);
              setDaoLoading(false);
            });
          }
          
          // For UFO, fetch PTGC price to show burned PTGC value
          if(token==='UFO'){
            fetch('https://api.dexscreener.com/latest/dex/pairs/pulsechain/'+TOKENS.PTGC.mainPair)
              .then(r=>r.json())
              .then(d=>setPtgcPrice(parseFloat(d.pair?.priceUsd)||0))
              .catch(()=>{});
          }
        };
        load();
      },[token]);
      
      const sorted=useMemo(()=>{if(!data?.pairs)return[];return[...data.pairs].sort((a,b)=>{let av,bv;switch(sortBy){case'ratio':av=a.liq>0?a.vol/a.liq:0;bv=b.liq>0?b.vol/b.liq:0;break;case'volume':av=a.vol;bv=b.vol;break;case'liquidity':av=a.liq;bv=b.liq;break;case'change':av=a.priceChange?.h24||0;bv=b.priceChange?.h24||0;break;default:av=a.vol;bv=b.vol}return sortDir==='desc'?bv-av:av-bv})},[data?.pairs,sortBy,sortDir]);
      
      const high=sorted.filter(p=>p.liq>=MIN_LIQ),low=sorted.filter(p=>p.liq<MIN_LIQ);
      const[showLow,setShowLow]=useState(false);
      const creatures=getBurnC(burn?.pct||0,'Squid');
      const plsRatio=data?.price&&pls?(data.price/pls).toFixed(2):'\u2014';
      const priceUp=(data?.change||0)>=0;
      const liqMcapRatio=data?.mcap>0?((data.liq/data.mcap)*100).toFixed(2):'\u2014';
      const whaleProgress=getWhaleProgress(burn?.pct||0);
      const tokensInLP=data?.tokensInLP||0;
      const tokensInLPPct=cfg.totalSupply>0?((tokensInLP/cfg.totalSupply)*100).toFixed(2):'0';
      
      const burnedPct=cfg.totalSupply>0?(burn?.total||0)/cfg.totalSupply*100:0;
      const lpPct=cfg.totalSupply>0?(tokensInLP/cfg.totalSupply)*100:0;
      const stakedTokens=stakingData?.staked||0;
      const lockedTokens=stakingData?.locked||0;
      const stakedPct=stakingData?.stakedPct||0;
      const lockedPct=stakingData?.lockedPct||0;
      const heldTokens=Math.max(0,cfg.totalSupply-(burn?.total||0)-tokensInLP-stakedTokens-lockedTokens);
      const heldPct=cfg.totalSupply>0?(heldTokens/cfg.totalSupply)*100:0;
      
      console.log('Token Allocation:', {
        burned: (burn?.total||0).toLocaleString() + ' (' + burnedPct.toFixed(2) + '%)',
        lp: tokensInLP.toLocaleString() + ' (' + lpPct.toFixed(2) + '%)',
        staked: stakedTokens.toLocaleString() + ' (' + stakedPct.toFixed(2) + '%)',
        locked: lockedTokens.toLocaleString() + ' (' + lockedPct.toFixed(2) + '%)',
        held: heldTokens.toLocaleString() + ' (' + heldPct.toFixed(2) + '%)'
      });
      
      const chartColors=cfg.stakingContract?['#f97316','#3b82f6','#a855f7','#ec4899',cfg.colorHex]:['#f97316','#3b82f6',cfg.colorHex];
      const chartData=cfg.stakingContract?[
        {label:'Burned',value:burnedPct,tokens:burn?.total||0},
        {label:'In LP',value:lpPct,tokens:tokensInLP},
        {label:'Staked',value:stakedPct,tokens:stakedTokens},
        {label:'Locked & Staked',value:lockedPct,tokens:lockedTokens},
        {label:'Held',value:heldPct,tokens:heldTokens}
      ]:[
        {label:'Burned',value:burnedPct,tokens:burn?.total||0},
        {label:'In LP',value:lpPct,tokens:tokensInLP},
        {label:'Held',value:100-burnedPct-lpPct,tokens:cfg.totalSupply-(burn?.total||0)-tokensInLP}
      ];
      
      if(loading)return<div className="min-h-screen flex items-center justify-center"><div className="text-center"><div className={`w-16 h-16 mx-auto mb-4 rounded-full border-4 ${theme.border} border-t-transparent animate-spin`}></div><div className={`font-orbitron text-lg ${theme.text}`}>Loading {token}...</div></div></div>;
      
      return(
        <div className="min-h-screen">
          <header className="sticky top-0 z-50 bg-[#0a0a0a]/95 backdrop-blur border-b border-white/10">
            <div className="max-w-7xl mx-auto px-3 sm:px-6 py-4 sm:py-5">
              <div className="flex items-center justify-between flex-wrap gap-3">
                <div className="flex items-center gap-4 sm:gap-6">
                  <button onClick={onBack} className="text-white/60 hover:text-white text-lg">{'\u2190'} Home</button>
                  <img src={cfg.logo} alt={token} className="w-20 h-20 sm:w-24 sm:h-24"/>
                  <div>
                    <span className={`font-orbitron text-3xl sm:text-4xl lg:text-5xl font-bold ${theme.text}`}>{token}</span>
                    <div className="flex items-center gap-1">
                      <span className="text-white/40 text-xs font-mono">{cfg.address.slice(0,6)}...{cfg.address.slice(-4)}</span>
                      <button onClick={copyAddress} className="text-white/40 hover:text-white/70 text-xs">{copied?'\u2713':'\u{1F4CB}'}</button>
                    </div>
                  </div>
                  <div className={`${theme.card} border ${theme.border} rounded-xl px-5 py-3 flex items-center gap-3`}>
                    <Price p={data?.price} c={`text-3xl sm:text-4xl font-bold ${theme.text}`}/>
                    <span className={`text-xl font-bold ${priceUp?'text-green-400':'text-red-400'}`}>{priceUp?'\u25B2':'\u25BC'}{Math.abs(data?.change||0).toFixed(2)}%</span>
                  </div>
                  <div className={`${theme.card} border ${theme.border} rounded-xl px-5 py-3 flex items-center gap-2`}>
                    <div className="text-white/60 text-xs leading-tight">PLS<br/>Ratio</div>
                    <span className={`text-3xl sm:text-4xl font-bold ${theme.text}`}>{plsRatio}</span>
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  <button onClick={()=>onSwitch(token==='PTGC'?'UFO':'PTGC')} className={`flex items-center gap-2 px-4 py-2 rounded-xl border border-white/20 hover:border-white/40 hover:bg-white/5 transition-all`}>
                    <span className="text-white/50">{'\u21C4'}</span>
                    <img src={token==='PTGC'?TOKENS.UFO.logo:TOKENS.PTGC.logo} alt="Switch" className="w-8 h-8"/>
                    <span className="text-white/70 text-sm font-medium">Switch</span>
                  </button>
                  <a href={cfg.pulseScanUrl} target="_blank" className={`px-4 py-2 rounded-lg border ${theme.border} ${theme.text} font-medium hover:bg-white/5`}>Explorer</a>
                  <button onClick={()=>setShowKPI(true)} className={`px-4 py-2 rounded-lg ${theme.bg} text-black font-bold hover:opacity-90 transition-opacity`}>KPI Report</button>
                </div>
              </div>
            </div>
          </header>
          
          <div className="border-b border-white/10 mt-4">
            <div className="max-w-7xl mx-auto px-3 sm:px-6 py-5">
              <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-7 gap-3">
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">Market Cap</div><div className={`text-2xl font-bold ${theme.text}`}>{fmtUSD(data?.mcap)}</div><div className={`text-sm font-semibold ${priceUp?'text-green-400':'text-red-400'}`}>{priceUp?'\u25B2':'\u25BC'} {Math.abs(data?.change||0).toFixed(2)}%</div></div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">Volume 24H</div><div className={`text-2xl font-bold ${theme.text}`}>{fmtUSD(data?.vol)}</div>{(()=>{const burnPct=token==='PTGC'?0.005:0.01;const vol24h=data?.vol||0;const burn7d=burnPeriods.d7||0;const price=data?.price||0;if(vol24h>0&&burn7d>0&&price>0){const vol7dAvg=(burn7d*price)/(burnPct*7);const change=vol7dAvg>0?((vol24h-vol7dAvg)/vol7dAvg)*100:0;return<div className={`text-sm font-semibold ${change>=0?'text-green-400':'text-red-400'}`}>{change>=0?'\u25B2':'\u25BC'} {Math.abs(change).toFixed(1)}% vs 7d avg</div>}return null})()}</div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">Liquidity</div><div className={`text-2xl font-bold ${theme.text}`}>{fmtUSD(data?.liq)}</div>{(()=>{const lc=burnHistoryCache?.[token]?.changes?.liquidity;return lc!==undefined?<div className={`text-sm font-semibold ${lc>=0?'text-green-400':'text-red-400'}`}>{lc>=0?'\u25B2':'\u25BC'} {Math.abs(lc).toFixed(2)}%</div>:null})()}</div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">LIQ/MCAP Ratio</div><div className={`text-2xl font-bold ${theme.text}`}>{liqMcapRatio}%</div></div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">Holders</div><div className={`text-2xl font-bold ${theme.text}`}>{fmt(holders)}</div>{holderChange!==null&&holderChange!==0&&<div className={`text-sm font-semibold ${holderChange>=0?'text-green-400':'text-red-400'}`}>{holderChange>=0?'\u25B2':'\u25BC'} {holderChange>=0?'+':''}{fmt(holderChange)}</div>}</div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">Tokens in LP</div><div className={`text-2xl font-bold ${theme.text}`}>{fmtAbbr(tokensInLP)}</div>{(()=>{const tc=burnHistoryCache?.[token]?.changes?.tokensInLP;return tc!==undefined?<div className={`text-sm font-semibold ${tc>=0?'text-green-400':'text-red-400'}`}>{tc>=0?'\u25B2':'\u25BC'} {Math.abs(tc).toFixed(2)}%</div>:<div className="text-white/50 text-sm">{tokensInLPPct}%</div>})()}</div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">Txns 24H</div><div className="text-2xl font-bold"><span className="text-green-400">{data?.buys||0}</span><span className="text-white/50">/</span><span className="text-red-400">{data?.sells||0}</span></div></div>
              </div>
            </div>
          </div>
          
          <div className="max-w-7xl mx-auto px-3 sm:px-6 py-6">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
              <div className="bg-gradient-to-r from-orange-500/15 via-orange-600/10 to-orange-500/15 border border-orange-500/30 rounded-xl p-4">
                <div className="flex justify-between mb-1"><div className="text-lg font-bold text-orange-400 uppercase">{'\u{1F525}'} Total Supply Burned</div></div>
                <div className="flex items-center gap-3 mb-1 flex-wrap"><span className={`text-2xl font-bold ${theme.text}`}>{fmt(burn?.total)}</span><span className="text-lg font-bold text-green-400">{fmtUSD((burn?.total||0)*(data?.price||0))}</span><span className="text-white/50">{(burn?.pct||0).toFixed(2)}%</span></div>
                <div className="flex items-center gap-2 mb-1"><div className="flex-1 h-2 bg-black/50 rounded-full overflow-hidden"><div className="h-full bg-gradient-to-r from-orange-500 to-orange-400 rounded-full" style={{width:`${whaleProgress.progress}%`}}></div></div><span className="text-lg">{'\u{1F40B}'}</span><span className="text-orange-400/70 text-xs">{whaleProgress.progress.toFixed(1)}%</span></div>
                <div className="flex items-center gap-2 flex-wrap mb-4"><span className="text-xl animate-fire">{'\u{1F525}'}</span>{creatures.map((c,i)=><span key={i} className="flex items-center gap-2"><span className="text-xl">{c.e}</span><span className="text-white/70 text-sm font-bold">x{c.cnt}</span></span>)}</div>
                <div className="grid grid-cols-4 gap-2">
                  {[{l:'24H',v:burnPeriods.h24},{l:'7D',v:burnPeriods.d7},{l:'30D',v:burnPeriods.d30},{l:'90D',v:burnPeriods.d90}].map(({l,v})=>{
                    const pct=cfg.totalSupply>0?(v/cfg.totalSupply)*100:0;
                    const c=v>0?getHighestCreatureWithCount(pct):{e:'\u{1F41A}',cnt:0};
                    return(
                      <div key={l} className="bg-black/30 border border-orange-500/30 rounded-lg px-2 py-2">
                        <div className="text-white font-bold text-sm mb-1">{l}</div>
                        <div className="text-2xl text-center mb-1">{c.e}{c.cnt>1&&<span className="text-white/70 text-sm font-bold ml-1">x{c.cnt}</span>}</div>
                        <div className="text-green-400 font-bold text-lg text-center">{fmtUSD(v*(data?.price||0))}</div>
                      </div>
                    );
                  })}
                </div>
              </div>
              
              <div className={`bg-gradient-to-r from-emerald-500/15 via-emerald-600/10 to-emerald-500/15 border border-emerald-500/30 rounded-xl p-4`}>
                <div className="flex justify-between items-center mb-2">
                  <div className={`text-lg font-bold ${theme.text} uppercase`}>{'\u{1F4B0}'} Value Generated</div>
                  <div className="flex gap-1 bg-black/30 rounded-lg p-1">
                    {['24h','7d','30d','90d'].map(p=>(
                      <button key={p} onClick={()=>setValueGenPeriod(p)} className={`px-2 py-1 rounded text-xs font-medium transition ${valueGenPeriod===p?`${theme.bg} text-black`:'text-white/60 hover:text-white'}`}>{p.toUpperCase()}</button>
                    ))}
                  </div>
                </div>
                {(()=>{
                  // Reverse math: calculate volume from burn amount
                  // PTGC burns 0.5% of volume, UFO burns 1% of volume
                  const burnPct=token==='PTGC'?0.005:0.01;
                  
                  // Get burn amount for selected period
                  const burnAmounts={'24h':burnPeriods.h24,'7d':burnPeriods.d7,'30d':burnPeriods.d30,'90d':burnPeriods.d90};
                  const periodBurn=burnAmounts[valueGenPeriod]||0;
                  
                  // Calculate volume: volume = (burnAmount * price) / burnPct
                  const calculatedVol=burnPct>0?(periodBurn*(data?.price||0))/burnPct:0;
                  
                  // Total value generated from this volume
                  const totalGen=calculatedVol*cfg.taxRate;
                  
                  // Reorder items based on token
                  let orderedItems=[];
                  if(token==='PTGC'){
                    // Row 1: DAO, Add LP, Buy & Burn | Row 2: Stakers, Holders+Stakers, Total
                    const dao=cfg.taxBreakdown.find(t=>t.name==='DAO');
                    const addLP=cfg.taxBreakdown.find(t=>t.name==='Add LP');
                    const burn=cfg.taxBreakdown.find(t=>t.name==='Buy & Burn');
                    const stakers=cfg.taxBreakdown.find(t=>t.name==='Stakers');
                    const holdersStakers=cfg.taxBreakdown.find(t=>t.name==='Holders+Stakers');
                    orderedItems=[dao,addLP,burn,stakers,holdersStakers].filter(Boolean);
                    // Add total for holders & stakers
                    const holderTotal=(stakers?.pct||0)+(holdersStakers?.pct||0);
                    orderedItems.push({name:'Total H&S',pct:holderTotal,emoji:'\u{1F48E}\u{1F48E}\u{1F48E}',isTotal:true});
                  }else{
                    // UFO: Holders, LP Providers, Burn UFO, Burn PTGC
                    const holders=cfg.taxBreakdown.find(t=>t.name==='Holders');
                    const lp=cfg.taxBreakdown.find(t=>t.name==='LP Providers');
                    const burnUFO=cfg.taxBreakdown.find(t=>t.name==='Burn UFO');
                    const burnPTGC=cfg.taxBreakdown.find(t=>t.name==='Burn PTGC');
                    orderedItems=[holders,lp,burnUFO,burnPTGC].filter(Boolean);
                  }
                  
                  return(
                    <>
                      <div className="flex items-baseline gap-2 mb-3">
                        <span className="text-3xl font-bold text-green-400">{fmtUSD(totalGen)}</span>
                        <span className="text-white/50 text-sm">from {fmtUSD(calculatedVol)} vol</span>
                      </div>
                      <div className={`grid ${token==='PTGC'?'grid-cols-3':'grid-cols-2'} gap-2`}>
                        {orderedItems.map((item,i)=>(
                          <div key={i} className={`bg-black/20 border ${item.isTotal?'border-emerald-400/50':'border-emerald-500/30'} rounded-lg px-2 py-2`}>
                            <div className="flex items-center gap-1 mb-1">
                              <span className="text-xl">{item.emoji}</span>
                              <span className="text-white/70 text-sm">{item.name}</span>
                            </div>
                            <div className={`font-bold text-xl text-right ${item.isTotal?'text-emerald-400':theme.text}`}>{fmtUSD(calculatedVol*(item.pct/100))}</div>
                          </div>
                        ))}
                      </div>
                    </>
                  );
                })()}
              </div>
              
              <div className={`bg-gradient-to-r from-purple-500/15 via-purple-600/10 to-purple-500/15 border border-purple-500/30 rounded-xl p-4`}>
                <div className="flex justify-between mb-3"><div className={`text-lg font-bold ${theme.text} uppercase`}>{'\u{1F4CA}'} Token Allocation</div></div>
                <div className="flex items-center gap-4">
                  <DonutChart data={chartData} colors={chartColors} size={90}/>
                  <div className="space-y-1">
                    {chartData.map((d,i)=>(
                      <div key={i} className="flex items-center gap-2 text-lg">
                        <div className="w-3 h-3 rounded-full flex-shrink-0" style={{background:chartColors[i]}}></div>
                        <span className="text-white/60">{d.label}:</span>
                        <span className="text-white/80">{fmtAbbr(d.tokens)}</span>
                        <span className={`font-bold ${theme.text}`}>{d.value.toFixed(2)}%</span>
                      </div>
                    ))}
                  </div>
                  <div className="border-l border-white/10 pl-4 ml-auto">
                    {(holderTiers?.Poseidon===0&&holderTiers?.Whale===0&&holderTiers?.Shark===0&&holderTiers?.Dolphin===0&&holderTiers?.SquidAndBelow===0)?(
                      <div className="flex items-center gap-2 px-4">
                        <div className="w-5 h-5 border-2 border-t-transparent rounded-full animate-spin" style={{borderColor:`${cfg.colorHex} transparent transparent transparent`}}></div>
                        <span className="text-white/50 text-sm">Loading...</span>
                      </div>
                    ):(
                      <div className="grid grid-cols-3 gap-x-5 gap-y-3 text-center">
                        <div><div className="text-3xl">{'\u{1F531}'}</div><div className={`text-base font-bold ${theme.text}`}>{holderTiers?.Poseidon||0}</div></div>
                        <div><div className="text-3xl">{'\u{1F40B}'}</div><div className={`text-base font-bold ${theme.text}`}>{holderTiers?.Whale||0}</div></div>
                        <div><div className="text-3xl">{'\u{1F988}'}</div><div className={`text-base font-bold ${theme.text}`}>{holderTiers?.Shark||0}</div></div>
                        <div><div className="text-3xl">{'\u{1F42C}'}</div><div className={`text-base font-bold ${theme.text}`}>{holderTiers?.Dolphin||0}</div></div>
                        <div className="col-span-2"><div className="text-2xl">{'\u{1F991}'}<span className="text-white">{'\u2192'}</span>{'\u{1F41A}'}</div><div className={`text-base font-bold ${theme.text}`}>{fmtAbbr(holderTiers?.SquidAndBelow||0)}</div></div>
                      </div>
                    )}
                  </div>
                </div>
                {!cfg.hasDAO&&(
                  <div className="grid grid-cols-2 gap-4 mt-4 pt-3 border-t border-white/10">
                    <div className="text-center">
                      <div className="text-white/50 text-xs uppercase mb-1">Max Total Supply</div>
                      <div className={`text-lg font-bold ${theme.text}`}>{fmtAbbr(cfg.totalSupply)}</div>
                    </div>
                    <div className="text-center">
                      <div className="text-white/50 text-xs uppercase mb-1">Circulating Supply</div>
                      <div className={`text-lg font-bold ${theme.text}`}>{fmtAbbr(cfg.totalSupply-(burn?.total||0))}</div>
                    </div>
                  </div>
                )}
              </div>
              
              {cfg.hasDAO?(
                <div className={`bg-gradient-to-r from-blue-500/15 via-blue-600/10 to-blue-500/15 border border-blue-500/30 rounded-xl p-4`}>
                  <div className="flex justify-between items-center mb-5">
                    <div className={`text-lg font-bold ${theme.text} uppercase`}>{'\u{1F3DB}\u{FE0F}'} DAO Treasury</div>
                  </div>
                  {daoLoading?(
                    <div className="flex items-center justify-center py-4">
                      <div className="w-6 h-6 border-2 border-t-transparent rounded-full animate-spin" style={{borderColor:`${cfg.colorHex} transparent transparent transparent`}}></div>
                      <span className="text-white/50 ml-2">Loading DAO data...</span>
                    </div>
                  ):(
                    <div className="space-y-3">
                      <div className="grid grid-cols-2 gap-3">
                        <div className="bg-black/20 border border-blue-500/30 rounded-lg px-3 py-2">
                          <div className="text-white/60 text-sm uppercase flex items-center gap-1 mb-1">{'\u{1F4B0}'} Available for New Proposals</div>
                          <div className="text-xl font-bold text-green-400">{fmtUSD(daoData?.availableUSD||0)}</div>
                          <div className="text-white/50 text-sm">{fmtAbbr(daoData?.availablePLS||0)} PLS</div>
                        </div>
                        <div className="bg-black/20 border border-blue-500/30 rounded-lg px-3 py-2">
                          <div className="text-white/60 text-sm uppercase flex items-center gap-1 mb-1">{'\u{23F3}'} Pending in Live Proposals ({daoData?.pendingCount||0})</div>
                          <div className="text-xl font-bold text-green-400">{fmtUSD(daoData?.pendingUSD||0)}</div>
                          <div className="text-white/50 text-sm">{fmtAbbr(daoData?.pendingPLS||0)} PLS</div>
                        </div>
                      </div>
                      <div className="grid grid-cols-2 gap-3">
                        <div className="bg-black/20 border border-blue-500/30 rounded-lg px-3 py-2 relative">
                          <div className="text-white/60 text-sm uppercase flex items-center gap-1 mb-1">{'\u{1F3E6}'} DAO Funds Ready for Deployment</div>
                          <div className="flex items-center gap-2">
                            <span className={`text-2xl font-bold text-green-400`}>{fmtUSD(daoData?.managementValue||0)}</span>
                            <button onClick={()=>setShowMgmtTokens(!showMgmtTokens)} className="text-white/40 hover:text-white/70 transition-colors text-sm">
                              {'\u{24D8}'}
                            </button>
                          </div>
                          {showMgmtTokens&&daoData?.managementTokens&&(
                            <div className="absolute top-full left-0 mt-2 z-50 bg-[#1a1a1a] border border-white/20 rounded-lg p-3 shadow-xl min-w-[200px]">
                              <div className="flex justify-between items-center mb-2">
                                <span className="text-white/70 text-xs font-bold uppercase">Token Breakdown</span>
                                <button onClick={()=>setShowMgmtTokens(false)} className="text-white/40 hover:text-white text-sm">{'\u2715'}</button>
                              </div>
                              <div className="space-y-1 text-sm">
                                {daoData.managementTokens.filter(t=>t.usdValue>=5).map((t,i)=>(
                                  <div key={i} className="flex justify-between gap-4 text-white/60">
                                    <span>{t.symbol}</span>
                                    <span><span className="text-white/50">{fmtAbbr(t.balance)}</span> <span className="text-green-400">{fmtUSD(t.usdValue)}</span></span>
                                  </div>
                                ))}
                              </div>
                            </div>
                          )}
                        </div>
                        <div className="bg-black/20 border border-blue-500/30 rounded-lg px-3 py-2">
                          <div className="text-white/60 text-sm uppercase flex items-center gap-1 mb-1">{'\u{1F4CA}'} Total DAO Value</div>
                          <div className={`text-2xl font-bold text-green-400`}>{fmtUSD(daoData?.totalValue||0)}</div>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              ):(
                <div className={`bg-gradient-to-r from-blue-500/15 via-blue-600/10 to-blue-500/15 border border-blue-500/30 rounded-xl p-4`}>
                  <div className="flex justify-between mb-2"><div className={`text-lg font-bold text-blue-400 uppercase`}>{'\u{1F525}'} PTGC Burned by UFO</div><span className="text-blue-400/50 text-xs">LIFETIME</span></div>
                  {(()=>{
                    const ptgcByUFO=burnHistoryCache?.PTGCbyUFO;
                    const ptgcTotalSupply=TOKENS.PTGC.totalSupply;
                    const totalBurned=ptgcByUFO?.totalBurned||0;
                    const burnPct=ptgcTotalSupply>0?(totalBurned/ptgcTotalSupply)*100:0;
                    const periods=ptgcByUFO?.periods||{h24:{amount:0},d7:{amount:0},d30:{amount:0},d90:{amount:0}};
                    const whaleProgress=getWhaleProgress(burnPct);
                    const creatures=getBurnC(burnPct,'Squid');
                    
                    return(
                      <div className="space-y-2">
                        <div className="grid grid-cols-3 gap-2 text-center">
                          <div className="bg-black/20 border border-blue-500/30 rounded-lg px-2 py-2"><div className="text-blue-400/70 text-xs uppercase">Burned</div><div className="text-xl font-bold text-[#D9CA5D]">{fmtAbbr(totalBurned)}</div></div>
                          <div className="bg-black/20 border border-blue-500/30 rounded-lg px-2 py-2"><div className="text-blue-400/70 text-xs uppercase">USD Value</div><div className="text-xl font-bold text-green-400">{fmtUSD(totalBurned*ptgcPrice)}</div></div>
                          <div className="bg-black/20 border border-blue-500/30 rounded-lg px-2 py-2"><div className="text-blue-400/70 text-xs uppercase">% of PTGC</div><div className="text-xl font-bold text-white">{burnPct.toFixed(4)}%</div></div>
                        </div>
                        <div className="flex items-center gap-2">
                          <div className="flex-1 h-2 bg-black/50 rounded-full overflow-hidden"><div className="h-full bg-gradient-to-r from-blue-500 to-blue-400 rounded-full" style={{width:`${whaleProgress.progress}%`}}></div></div>
                          <span className="text-lg">{'\u{1F40B}'}</span>
                          <span className="text-blue-400/70 text-xs">{whaleProgress.progress.toFixed(1)}%</span>
                        </div>
                        <div className="flex items-center justify-center gap-2 flex-wrap">
                          <span className="text-2xl animate-fire">{'\u{1F525}'}</span>
                          {creatures.map((c,i)=><span key={i} className="flex items-center gap-1"><span className="text-2xl">{c.e}</span><span className="text-white/70 text-sm font-bold">x{c.cnt}</span></span>)}
                        </div>
                        <div className="grid grid-cols-4 gap-2">
                          {[{l:'24H',v:periods.h24?.amount},{l:'7D',v:periods.d7?.amount},{l:'30D',v:periods.d30?.amount},{l:'90D',v:periods.d90?.amount}].map(({l,v})=>(
                            <div key={l} className="bg-black/30 border border-blue-500/30 rounded-lg px-2 py-2 flex items-center justify-between">
                              <div className="text-white/60 text-base font-bold">{l}</div>
                              <div className="text-right">
                                <div className="text-blue-400 font-bold text-base">{fmtAbbr(v||0)}</div>
                                <div className="text-green-400 text-sm">{fmtUSD((v||0)*ptgcPrice)}</div>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    );
                  })()}
                </div>
              )}
            </div>
          </div>
          
          <div className="max-w-7xl mx-auto px-3 sm:px-6 py-4">
            <div className="hidden sm:grid grid-cols-12 gap-2 items-center mb-2 px-3 sm:px-4">
              <div className="col-span-1"></div>
              <div className="col-span-2">
                <h2 className="text-lg font-semibold text-white">LP Pairs <span className="text-gray-500 text-sm">({high.length})</span></h2>
              </div>
              <div className="col-span-2 text-right">
                <div className={`${theme.card} border ${theme.border} rounded-lg px-2 py-1 inline-block`}>
                  <span className={`font-bold ${theme.text} text-sm`}>{fmtUSD(data?.vol||0)}</span>
                </div>
              </div>
              <div className="col-span-2 text-right">
                <div className={`${theme.card} border ${theme.border} rounded-lg px-2 py-1 inline-block`}>
                  <span className={`font-bold ${theme.text} text-sm`}>{fmtUSD(data?.liq||0)}</span>
                </div>
              </div>
              <div className="col-span-5 flex justify-end">
                <div className={`${theme.card} border ${theme.border} rounded-lg px-3 py-1 flex items-center gap-2`}>
                  <span className="text-gray-400 text-xs">Sort:</span>
                  {['Ratio','Volume','Liquidity','24h %'].map((l,i)=>{const c=['ratio','volume','liquidity','change'][i];return<button key={c} onClick={()=>{sortBy===c?setSortDir(sortDir==='desc'?'asc':'desc'):(setSortBy(c),setSortDir('desc'))}} className={`px-2 py-1 rounded text-xs ${sortBy===c?`${theme.text} bg-white/10`:'text-gray-500'}`}>{l}{sortBy===c&&(sortDir==='desc'?'\u2193':'\u2191')}</button>})}
                </div>
              </div>
            </div>
            <div className="sm:hidden flex justify-between mb-3 flex-wrap gap-2 items-center">
              <h2 className="text-lg font-semibold text-white">LP Pairs <span className="text-gray-500 text-sm">({high.length})</span></h2>
              <div className={`${theme.card} border ${theme.border} rounded-lg px-3 py-2 flex items-center gap-2`}>
                <span className="text-gray-400 text-xs">Sort:</span>
                {['Ratio','Volume','Liquidity','24h %'].map((l,i)=>{const c=['ratio','volume','liquidity','change'][i];return<button key={c} onClick={()=>{sortBy===c?setSortDir(sortDir==='desc'?'asc':'desc'):(setSortBy(c),setSortDir('desc'))}} className={`px-2 py-1 rounded text-xs ${sortBy===c?`${theme.text} bg-white/10`:'text-gray-500'}`}>{l}{sortBy===c&&(sortDir==='desc'?'\u2193':'\u2191')}</button>})}
              </div>
            </div>
            <div className="space-y-2">{high.map((p,i)=><LPRow key={p.pairAddress||i} pair={p} theme={theme} mainAddr={cfg.address}/>)}</div>
            {low.length>0&&<div className="mt-3"><button onClick={()=>setShowLow(!showLow)} className={`w-full ${theme.card} border ${theme.border} rounded-lg p-2 flex justify-between text-sm`}><span className="text-gray-400">{showLow?'Hide':'Show'} {low.length} pairs &lt;$1K</span><span className={theme.text}>{showLow?'\u25B2':'\u25BC'}</span></button>{showLow&&<div className="mt-2 space-y-2">{low.map((p,i)=><LPRow key={p.pairAddress||i} pair={p} theme={theme} mainAddr={cfg.address}/>)}</div>}</div>}
          </div>
          
          {/* KPI Report Modal */}
          {showKPI&&(
            <div className="fixed inset-0 z-50 flex items-center justify-center p-4" onClick={()=>setShowKPI(false)}>
              <div className="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
              <div className="relative w-full max-w-md" onClick={e=>e.stopPropagation()}>
                {(()=>{
                  const isPTGC=token==='PTGC';
                  const priceChange=data?.change||0;
                  const priceUp=priceChange>=0;
                  const plsRatio=pls>0?(data?.price||0)/pls:0;
                  const liqChange=burnHistoryCache?.[token]?.changes?.liquidity;
                  const volChange=burnHistoryCache?.[token]?.changes?.volume24h;
                  const burn24hAmt=burnPeriods.h24||0;
                  const burn24hUSD=(burnPeriods.h24||0)*(data?.price||0);
                  const burnPctNum=burn.pct||0;
                  const creatures=getBurnC(burnPctNum,isPTGC?'Squid':'Shrimp');
                  const today=new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
                  const valueGen=(()=>{
                    const burnAmt=burnPeriods.h24||0;
                    const price=data?.price||0;
                    const burnPctRate=isPTGC?0.005:0.01;
                    const vol24h=burnAmt>0?(burnAmt*price)/burnPctRate:0;
                    if(isPTGC){
                      const daoFee=vol24h*0.02;
                      const lpFee=vol24h*0.005;
                      const buyBurn=vol24h*0.005;
                      const hsFee=vol24h*0.01;
                      return daoFee+lpFee+buyBurn+hsFee;
                    }else{
                      const holderFee=vol24h*0.005;
                      const lpFee=vol24h*0.015;
                      const burnFees=vol24h*0.02;
                      return holderFee+lpFee+burnFees;
                    }
                  })();
                  const valueGenChange=volChange||0;
                  
                  return(
                    <div className={`rounded-2xl overflow-hidden ${isPTGC?'bg-gradient-to-b from-[#1a1a0a] via-[#0d0d05] to-[#0a0a0a]':'bg-gradient-to-b from-[#0a1a0a] via-[#050d05] to-[#0a0a0a]'}`} style={{border:`2px solid ${isPTGC?'#D9CA5D33':'#22c55e33'}`}}>
                      {/* Close button */}
                      <button onClick={()=>setShowKPI(false)} className="absolute top-3 right-3 text-white/50 hover:text-white text-2xl z-10">&times;</button>
                      
                      {/* Header */}
                      <div className="text-center pt-6 pb-4">
                        <div className="flex justify-center mb-2">
                          <div className={`w-20 h-20 rounded-full flex items-center justify-center ${isPTGC?'bg-[#D9CA5D]/20':'bg-green-500/20'}`} style={{boxShadow:`0 0 40px ${isPTGC?'#D9CA5D66':'#22c55e66'}`}}>
                            <img src={cfg.logo} className="w-16 h-16 rounded-full" alt={token}/>
                          </div>
                        </div>
                        <div className={`text-2xl font-bold ${theme.text}`}>{token}</div>
                        <div className={`text-xs ${theme.text} opacity-70`}>KPI REPORT</div>
                        <div className="text-[10px] text-white/40 mt-1 font-mono">{cfg.address}</div>
                        <div className="flex justify-center items-center gap-2 mt-2">
                          <span className="text-white/50 text-xs">{today}</span>
                          <span className={`text-[10px] px-2 py-0.5 rounded ${isPTGC?'bg-[#D9CA5D] text-black':'bg-green-500 text-black'} font-bold`}>24H</span>
                        </div>
                      </div>
                      
                      {/* Price Section */}
                      <div className="mx-4 mb-4">
                        <div className={`rounded-xl p-4 ${isPTGC?'bg-[#1a1a0a] border border-[#D9CA5D]/30':'bg-[#0a1a0a] border border-green-500/30'}`}>
                          <div className="flex items-center justify-between">
                            <div>
                              <div className={`text-xs ${theme.text} opacity-70 flex items-center gap-1`}><span className="text-green-400">$</span> PRICE</div>
                              <div className={`text-3xl font-bold ${theme.text}`}>${data?.price?.toFixed(6)||'0.000000'}</div>
                            </div>
                            <div className="flex items-center gap-3">
                              <div className={`px-3 py-1 rounded-lg text-sm font-bold ${priceUp?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`}>
                                {priceUp?'\u25B2':'\u25BC'} {Math.abs(priceChange).toFixed(2)}%
                              </div>
                              <div className="text-center">
                                <div className="text-[10px] text-white/50">PLS RATIO</div>
                                <div className={`text-lg font-bold ${theme.text}`}>{plsRatio.toFixed(2)}</div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      
                      {/* Stats Grid */}
                      <div className="mx-4 mb-4 grid grid-cols-2 gap-3">
                        <div className={`rounded-xl p-3 ${isPTGC?'bg-[#1a1a0a] border border-[#D9CA5D]/20':'bg-[#0a1a0a] border border-green-500/20'}`}>
                          <div className="text-[10px] text-white/50 flex items-center gap-1"><span className={theme.text}></span> MARKET CAP</div>
                          <div className={`text-xl font-bold ${theme.text}`}>{fmtUSD(data?.mcap)}</div>
                        </div>
                        <div className={`rounded-xl p-3 ${isPTGC?'bg-[#1a1a0a] border border-[#D9CA5D]/20':'bg-[#0a1a0a] border border-green-500/20'}`}>
                          <div className="text-[10px] text-white/50 flex items-center gap-1"><span className="text-yellow-400"></span> LIQUIDITY {liqChange!==undefined&&<span className={`ml-auto ${liqChange>=0?'text-green-400':'text-red-400'}`}>{liqChange>=0?'\u25B2':'\u25BC'} {Math.abs(liqChange).toFixed(1)}%</span>}</div>
                          <div className={`text-xl font-bold ${theme.text}`}>{fmtUSD(data?.liq)}</div>
                        </div>
                        <div className={`rounded-xl p-3 ${isPTGC?'bg-[#1a1a0a] border border-[#D9CA5D]/20':'bg-[#0a1a0a] border border-green-500/20'}`}>
                          <div className="text-[10px] text-white/50 flex items-center gap-1"><span className="text-purple-400"></span> LIQ/MC RATIO</div>
                          <div className={`text-xl font-bold ${theme.text}`}>{liqMcapRatio}%</div>
                        </div>
                        <div className={`rounded-xl p-3 ${isPTGC?'bg-[#1a1a0a] border border-[#D9CA5D]/20':'bg-[#0a1a0a] border border-green-500/20'}`}>
                          <div className="text-[10px] text-white/50 flex items-center gap-1"><span className="text-blue-400"></span> VOLUME {volChange!==undefined&&<span className={`ml-auto ${volChange>=0?'text-green-400':'text-red-400'}`}>{volChange>=0?'\u25B2':'\u25BC'} {Math.abs(volChange).toFixed(1)}%</span>}</div>
                          <div className={`text-xl font-bold ${theme.text}`}>{fmtUSD(data?.vol)}</div>
                        </div>
                        <div className={`rounded-xl p-3 ${isPTGC?'bg-[#1a1a0a] border border-[#D9CA5D]/20':'bg-[#0a1a0a] border border-green-500/20'}`}>
                          <div className="text-[10px] text-white/50 flex items-center gap-1"><span className="text-cyan-400"></span> HOLDERS {holderChange!==null&&holderChange!==0&&<span className={`ml-auto ${holderChange>=0?'text-green-400':'text-red-400'}`}>{holderChange>=0?'\u25B2':'\u25BC'} {Math.abs(holderChange)}</span>}</div>
                          <div className={`text-xl font-bold ${theme.text}`}>{fmt(holders)}</div>
                        </div>
                        <div className={`rounded-xl p-3 ${isPTGC?'bg-[#1a1a0a] border border-[#D9CA5D]/20':'bg-[#0a1a0a] border border-green-500/20'}`}>
                          <div className="text-[10px] text-white/50 flex items-center gap-1"><span className="text-green-400"></span> VALUE GENERATED {valueGenChange!==0&&<span className={`ml-auto ${valueGenChange>=0?'text-green-400':'text-red-400'}`}>{valueGenChange>=0?'\u25B2':'\u25BC'} {Math.abs(valueGenChange).toFixed(1)}%</span>}</div>
                          <div className={`text-xl font-bold ${theme.text}`}>{fmtUSD(valueGen)}</div>
                        </div>
                      </div>
                      
                      {/* Total Burned Section */}
                      <div className={`mx-4 mb-4 rounded-xl p-4 ${isPTGC?'bg-gradient-to-r from-[#2a1a0a] to-[#1a1a0a] border border-orange-500/30':'bg-gradient-to-r from-[#0a2a1a] to-[#0a1a0a] border border-green-500/30'}`}>
                        <div className="flex justify-between items-start">
                          <div>
                            <div className="text-[10px] text-white/50 flex items-center gap-1"><span></span> TOTAL BURNED</div>
                            <div className={`text-xl font-bold ${theme.text}`}>{fmtAbbr(burn.total)} <span className="text-base text-white/50">{token}</span></div>
                            <div className="text-green-400 text-sm">{fmtUSD(burn.total*(data?.price||0))}</div>
                            <div className="text-white/50 text-xs">{burnPctNum.toFixed(2)}% of supply</div>
                            <div className="flex items-center gap-1 mt-2 flex-wrap">
                              {creatures.map((c,i)=><span key={i} className="flex items-center"><span className="text-lg">{c.e}</span><span className="text-white/50 text-xs">x{c.cnt}</span></span>)}
                            </div>
                          </div>
                          <div className="text-right">
                            <div className="text-[10px] text-white/50 flex items-center gap-1 justify-end"><span></span> 24H BURN</div>
                            <div className={`text-lg font-bold ${theme.text}`}>{fmtAbbr(burn24hAmt)} <span className="text-sm text-white/50">{token}</span></div>
                            <div className="text-green-400 text-sm">{fmtUSD(burn24hUSD)}</div>
                            <div className="mt-2">
                              {creatures.length>0&&<span className="text-2xl">{creatures[creatures.length-1]?.e||''}</span>}
                            </div>
                          </div>
                        </div>
                        <div className="mt-3 flex items-center gap-2">
                          <div className="flex-1 h-2 bg-black/50 rounded-full overflow-hidden">
                            <div className={`h-full rounded-full ${isPTGC?'bg-gradient-to-r from-orange-500 to-yellow-500':'bg-gradient-to-r from-green-500 to-emerald-400'}`} style={{width:`${Math.min(burnPctNum,100)}%`}}></div>
                          </div>
                          <span className="text-white/50 text-xs">{burnPctNum.toFixed(0)}%</span>
                          <span className="text-lg"></span>
                        </div>
                      </div>
                      
                      {/* Footer */}
                      <div className={`px-4 py-3 flex justify-between items-center border-t ${isPTGC?'border-[#D9CA5D]/20':'border-green-500/20'}`}>
                        <div className="flex items-center gap-2">
                          <div className="w-5 h-5 rounded-full bg-green-500 flex items-center justify-center text-[10px] font-bold text-black">P</div>
                          <span className="text-white/50 text-xs">PulseChain</span>
                        </div>
                        <div className={`text-xs ${theme.text}`}>{isPTGC?'www.GoPTGC.com':'www.UFOtoken.io'}</div>
                      </div>
                    </div>
                  );
                })()}
              </div>
            </div>
          )}
          
          <footer className="text-center py-4 border-t border-white/10 mt-8"><p className="text-white/30 text-xs">Not financial advice. DYOR.</p></footer>
          
        </div>
      );
    };
    
    const App=()=>{
      const[view,setView]=useState('home');
      const[token,setToken]=useState(null);
      if(view==='dashboard'&&token)return<Dashboard token={token} onBack={()=>{setView('home');setToken(null)}} onSwitch={(t)=>setToken(t)}/>;
      return<Home onSelect={t=>{setToken(t);setView('dashboard')}}/>;
    };
    
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
