<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PTGC UFO Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Rajdhani', sans-serif; background: #0a0a0a; min-height: 100vh; }
    .font-orbitron { font-family: 'Orbitron', monospace; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1a1a1a; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    @keyframes fire { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .animate-fire { animation: fire 0.5s ease-in-out infinite; }
    .animate-pulse-slow { animation: pulse 1.5s ease-in-out infinite; }
    .token-card { transition: all 0.3s ease; }
    .token-card:hover { transform: scale(1.02); }
    .token-card-gold:hover { box-shadow: 0 0 50px rgba(217, 202, 93, 0.5); }
    .token-card-green:hover { box-shadow: 0 0 50px rgba(124, 252, 0, 0.5); }
    .modal-overlay { backdrop-filter: blur(8px); }
    .clickable:hover { transform: scale(1.02); cursor: pointer; }
    .time-btn { transition: all 0.2s; }
    .time-btn:hover { background: rgba(255,255,255,0.1); }
    .time-btn.active { background: rgba(255,255,255,0.15); }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    
    const TOKENS = {
      PTGC: { 
        name: 'PTGC', 
        address: '0x94534EeEe131840b1c0F61847c572228bdfDDE93', 
        logo: '06_PTGC_V1_transparent_bg.png', 
        color: 'gold', 
        colorHex: '#D9CA5D', 
        decimals: 18, 
        mainPair: '0xf5A89A6487D62df5308CDDA89c566C5B5ef94C11', 
        pulseScanUrl: 'https://scan.pulsechain.com/token/0x94534EeEe131840b1c0F61847c572228bdfDDE93', 
        totalSupply: 333333333333,
        taxRate: 0.05,
        taxBreakdown: [
          { name: 'DAO', pct: 2, emoji: 'üèõÔ∏è' },
          { name: 'Stakers', pct: 1, emoji: 'üíé' },
          { name: 'Holders & Stakers', pct: 1, emoji: 'üíéüíé' },
          { name: 'Buy & Burn PTGC', pct: 0.5, emoji: 'üî•' },
          { name: 'Add LP (PTGC/PLS)', pct: 0.5, emoji: 'üíß' }
        ]
      },
      UFO: { 
        name: 'UFO', 
        address: '0x456548A9B56eFBbD89Ca0309edd17a9E20b04018', 
        logo: '07_Ufo_transparent.png', 
        color: 'green', 
        colorHex: '#7CFC00', 
        decimals: 18, 
        mainPair: '0xbeA0e55b82Eb975280041F3b49C4D0bD937b72d5', 
        pulseScanUrl: 'https://scan.pulsechain.com/token/0x456548A9B56eFBbD89Ca0309edd17a9E20b04018', 
        totalSupply: 999999999051,
        taxRate: 0.06,
        taxBreakdown: [
          { name: 'UFO LP Providers', pct: 3, emoji: 'üíß' },
          { name: 'UFO Holders', pct: 1, emoji: 'üíé' },
          { name: 'Buy & Burn UFO', pct: 1, emoji: 'üî•' },
          { name: 'Buy & Burn PTGC', pct: 1, emoji: 'üî•' }
        ]
      }
    };
    const COMBINED_LOGO = '07_Combined_PTGC_UFO_Transparent.png';
    const BURN_ADDRESS = '0x0000000000000000000000000000000000000369';
    const RPC = 'https://rpc.pulsechain.com';
    const MIN_LIQ = 1000;
    
    const BURN_C = [
      { n: 'Poseidon', e: 'üî±', p: 10 }, { n: 'Whale', e: 'üêã', p: 1 }, { n: 'Shark', e: 'ü¶à', p: 0.1 },
      { n: 'Dolphin', e: 'üê¨', p: 0.01 }, { n: 'Squid', e: 'ü¶ë', p: 0.001 }, { n: 'Turtle', e: 'üê¢', p: 0.0001 },
      { n: 'Shrimp', e: 'ü¶ê', p: 0.00001 }, { n: 'Shell', e: 'üêö', p: 0 }
    ];
    
    const fmt = n => n == null || isNaN(n) ? '‚Äî' : Math.floor(Number(n)).toLocaleString('en-US');
    const fmtUSD = n => n == null || isNaN(n) ? '‚Äî' : '$' + Math.floor(Number(n)).toLocaleString('en-US');
    // Abbreviated format for large numbers
    const fmtAbbr = n => {
      if (n == null || isNaN(n)) return '‚Äî';
      const num = Number(n);
      if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
      if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
      if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
      if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
      return Math.floor(num).toLocaleString('en-US');
    };
    const fmtPrice = p => {
      if (!p || isNaN(p) || p === 0) return '‚Äî';
      if (p >= 1) return '$' + p.toFixed(2);
      if (p >= 0.0001) return '$' + p.toFixed(6);
      const s = p.toExponential(4), [m, e] = s.split('e'), exp = Math.abs(parseInt(e));
      return { pre: '$0.0', z: exp - 1, d: parseFloat(m).toFixed(4).replace('.', '').slice(0, 4) };
    };
    const Price = ({ p, c = '' }) => {
      const f = fmtPrice(p);
      return typeof f === 'string' ? <span className={c}>{f}</span> : <span className={c}>{f.pre}<sub className="text-[0.6em] opacity-70">{f.z}</sub>{f.d}</span>;
    };
    const getLogo = a => a ? `https://dd.dexscreener.com/ds-data/tokens/pulsechain/${a.toLowerCase()}.png` : null;
    const getBurnC = (pct, min = 'Shell') => {
      const r = []; let rem = pct;
      const minI = BURN_C.findIndex(c => c.n === min);
      for (let i = 0; i < BURN_C.length; i++) {
        if (minI >= 0 && i > minI) continue;
        const c = BURN_C[i];
        if (c.p > 0 && rem >= c.p) { const cnt = Math.floor(rem / c.p); if (cnt > 0) { r.push({ ...c, cnt }); rem -= cnt * c.p; } }
      }
      return r;
    };
    const getSingleC = pct => { for (const c of BURN_C) if (pct >= c.p) return c; return BURN_C[BURN_C.length - 1]; };
    const getWhaleProgress = pct => {
      const whales = Math.floor(pct);
      const progress = (pct - whales) * 100;
      return { whales, progress };
    };
    
    const fetchDex = async (addr, mainPair) => {
      try {
        let mp = null;
        if (mainPair) { const r = await fetch(`https://api.dexscreener.com/latest/dex/pairs/pulsechain/${mainPair}`); const d = await r.json(); if (d.pair) mp = d.pair; }
        const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${addr}`);
        const data = await res.json();
        if (data.pairs?.length > 0) {
          const pairs = data.pairs.map(p => ({ ...p, liq: p.liquidity?.usd || 0, vol: p.volume?.h24 || 0 })).sort((a, b) => b.liq - a.liq);
          const pp = mp || pairs[0];
          let totalTokensInLP = 0;
          pairs.forEach(p => {
            const isBase = p.baseToken?.address?.toLowerCase() === addr.toLowerCase();
            if (isBase && p.liquidity?.base) totalTokensInLP += p.liquidity.base;
            else if (!isBase && p.liquidity?.quote) totalTokensInLP += p.liquidity.quote;
          });
          return { 
            price: parseFloat(pp.priceUsd) || 0, 
            change: pp.priceChange?.h24 || 0, 
            mcap: pp.marketCap || pp.fdv || 0, 
            liq: pairs.reduce((s, p) => s + p.liq, 0), 
            vol: pairs.reduce((s, p) => s + p.vol, 0), 
            buys: pairs.reduce((s, p) => s + (p.txns?.h24?.buys || 0), 0), 
            sells: pairs.reduce((s, p) => s + (p.txns?.h24?.sells || 0), 0), 
            tokensInLP: totalTokensInLP,
            pairs 
          };
        }
        return null;
      } catch { return null; }
    };
    const fetchHolders = async addr => { try { const r = await fetch(`https://api.scan.pulsechain.com/api/v2/tokens/${addr}/counters`); return parseInt((await r.json()).token_holders_count) || 0; } catch { return 0; } };
    const fetchBurn = async (addr, dec) => {
      try {
        const bRes = await fetch(RPC, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ jsonrpc: '2.0', method: 'eth_call', params: [{ to: addr, data: '0x70a08231000000000000000000000000' + BURN_ADDRESS.slice(2) }, 'latest'], id: 1 }) });
        const burned = Number(BigInt((await bRes.json()).result || '0x0')) / Math.pow(10, dec);
        const sRes = await fetch(RPC, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ jsonrpc: '2.0', method: 'eth_call', params: [{ to: addr, data: '0x18160ddd' }, 'latest'], id: 2 }) });
        const supply = Number(BigInt((await sRes.json()).result || '0x0')) / Math.pow(10, dec);
        return { total: burned, pct: supply > 0 ? (burned / supply) * 100 : 0, supply };
      } catch { return { total: 0, pct: 0, supply: 0 }; }
    };
    
    // Optimized burn history - only 4 periods now (12hr, 24hr, 7day, 30day)
    const fetchBurnHist = async (addr, dec, hrs) => {
      try {
        const blocksPerHour = 360;
        const totalBlocks = blocksPerHour * hrs;
        const bRes = await fetch(RPC, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ jsonrpc: '2.0', method: 'eth_blockNumber', params: [], id: 1 }) });
        const curBlock = parseInt((await bRes.json()).result, 16);
        
        // For 30 days, chunk into smaller requests
        if (hrs > 24 * 7) {
          let totalBurn = 0;
          const chunkHours = 24 * 5; // 5 day chunks
          const chunks = Math.ceil(hrs / chunkHours);
          for (let i = 0; i < chunks; i++) {
            const endBlock = curBlock - (i * blocksPerHour * chunkHours);
            const startBlock = Math.max(0, endBlock - (blocksPerHour * chunkHours));
            try {
              const lRes = await fetch(RPC, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ jsonrpc: '2.0', method: 'eth_getLogs', params: [{ address: addr, topics: ['0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef', null, '0x000000000000000000000000' + BURN_ADDRESS.slice(2)], fromBlock: '0x' + startBlock.toString(16), toBlock: '0x' + endBlock.toString(16) }], id: 1 }) });
              const logs = (await lRes.json()).result;
              if (Array.isArray(logs)) totalBurn += logs.reduce((s, l) => s + Number(BigInt(l.data)) / Math.pow(10, dec), 0);
            } catch (e) { console.error('Chunk error:', e); }
          }
          return totalBurn;
        }
        
        const fromBlock = '0x' + Math.max(0, curBlock - totalBlocks).toString(16);
        const lRes = await fetch(RPC, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ jsonrpc: '2.0', method: 'eth_getLogs', params: [{ address: addr, topics: ['0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef', null, '0x000000000000000000000000' + BURN_ADDRESS.slice(2)], fromBlock, toBlock: 'latest' }], id: 1 }) });
        const logs = (await lRes.json()).result;
        return Array.isArray(logs) ? logs.reduce((s, l) => s + Number(BigInt(l.data)) / Math.pow(10, dec), 0) : 0;
      } catch (e) { console.error('Burn history error:', e); return 0; }
    };
    
    const fetchPLS = async () => { try { const r = await fetch('https://api.dexscreener.com/latest/dex/pairs/pulsechain/0xe56043671df55de5cdf8459710433c10324de0ae'); return parseFloat((await r.json()).pair?.priceUsd) || 0.00005; } catch { return 0.00005; } };
    
    // Stat Modal - TODO: Need indexer API for real historical data
    const StatModal = ({ open, close, title, theme, currentVal }) => {
      const [loading, setLoading] = useState(true);
      const [data, setData] = useState({ d7: 0, d30: 0, d90: 0 });
      useEffect(() => {
        if (!open) return;
        setLoading(true);
        setTimeout(() => {
          const base = currentVal || 0;
          setData({ d7: base * 7, d30: base * 30, d90: base * 90 });
          setLoading(false);
        }, 300);
      }, [open, currentVal]);
      if (!open) return null;
      const isH = title === 'Holders';
      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay bg-black/70" onClick={close}>
          <div className={`bg-[#111] border ${theme.border} rounded-2xl max-w-md w-full`} onClick={e => e.stopPropagation()}>
            <div className="p-5">
              <div className="flex justify-between mb-4"><h2 className={`text-xl font-bold ${theme.text}`}>{title} Details</h2><button onClick={close} className="text-white/60 hover:text-white text-2xl">√ó</button></div>
              {loading ? (
                <div className="text-center py-8"><div className="text-2xl animate-pulse-slow">üìä</div><div className="text-white/50 mt-2">Loading data...</div></div>
              ) : (
                <div className="space-y-3">
                  <div className="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3 text-center text-yellow-400 text-sm">‚ö†Ô∏è Requires indexer API for accurate historical data</div>
                  <div className="text-white/50 text-xs text-center mb-2">* Estimated based on current 24h data</div>
                  {[{ l: '7 Day', v: data.d7, d: 7 }, { l: '30 Day', v: data.d30, d: 30 }, { l: '90 Day', v: data.d90, d: 90 }].map(({ l, v, d }) => (
                    <div key={l} className={`${theme.card} border ${theme.border} rounded-lg p-3 flex justify-between items-center`}>
                      <div><div className="text-white/60 text-xs uppercase">{l} Est.</div><div className={`text-2xl font-bold ${theme.text}`}>{isH ? fmt(v) : fmtUSD(v)}</div></div>
                      <div className="text-right"><div className="text-white/60 text-xs uppercase">Daily Avg</div><div className="text-white text-xl">{isH ? fmt(v / d) : fmtUSD(v / d)}</div></div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        </div>
      );
    };
    
    // Burn Modal - Only 4 time periods now
    const BurnModal = ({ open, close, token, burn, price, cfg }) => {
      const [hist, setHist] = useState({ h12: null, h24: null, d7: null, d30: null });
      const [loading, setLoading] = useState(true);
      useEffect(() => {
        if (!open) return;
        setLoading(true);
        setHist({ h12: null, h24: null, d7: null, d30: null });
        const fetchAll = async () => {
          const h12 = await fetchBurnHist(cfg.address, cfg.decimals, 12);
          setHist(prev => ({ ...prev, h12 }));
          const h24 = await fetchBurnHist(cfg.address, cfg.decimals, 24);
          setHist(prev => ({ ...prev, h24 }));
          const d7 = await fetchBurnHist(cfg.address, cfg.decimals, 24 * 7);
          setHist(prev => ({ ...prev, d7 }));
          const d30 = await fetchBurnHist(cfg.address, cfg.decimals, 24 * 30);
          setHist(prev => ({ ...prev, d30 }));
          setLoading(false);
        };
        fetchAll();
      }, [open, cfg]);
      if (!open) return null;
      const theme = { text: cfg.color === 'gold' ? 'text-[#D9CA5D]' : 'text-[#7CFC00]' };
      const creatures = getBurnC(burn?.pct || 0, 'Squid');
      const supply = burn?.supply || 1;
      const getPct = a => (a / supply) * 100;
      const whaleProgress = getWhaleProgress(burn?.pct || 0);
      const boxes = [
        { l: '12 Hours', v: hist.h12 }, { l: '24 Hours', v: hist.h24 },
        { l: '7 Days', v: hist.d7 }, { l: '30 Days', v: hist.d30 }
      ];
      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay bg-black/70" onClick={close}>
          <div className="bg-[#111] border border-orange-500/30 rounded-2xl max-w-2xl w-full" onClick={e => e.stopPropagation()}>
            <div className="p-5">
              <div className="flex justify-between mb-4">
                <div className="flex items-center gap-4"><img src={cfg.logo} alt={token} className="w-16 h-16 sm:w-20 sm:h-20"/><div><h2 className="text-2xl font-bold text-orange-400 font-orbitron">{token} Burn Stats</h2><div className="text-white/40 text-sm">üî• Total Supply Burned</div></div></div>
                <button onClick={close} className="text-white/60 hover:text-white text-2xl">√ó</button>
              </div>
              <div className="bg-gradient-to-r from-orange-500/15 to-orange-600/10 border border-orange-500/30 rounded-xl p-4 mb-4">
                <div className="grid grid-cols-3 gap-3 text-center mb-3">
                  <div><div className="text-orange-400/70 text-xs uppercase">Burned</div><div className={`text-2xl font-bold ${theme.text}`}>{fmt(burn?.total)}</div></div>
                  <div><div className="text-orange-400/70 text-xs uppercase">USD Value</div><div className="text-2xl font-bold text-green-400">{fmtUSD((burn?.total || 0) * price)}</div></div>
                  <div><div className="text-orange-400/70 text-xs uppercase">% Supply</div><div className="text-2xl font-bold text-white">{(burn?.pct || 0).toFixed(2)}%</div></div>
                </div>
                <div className="flex items-center gap-2 mb-3">
                  <div className="flex-1 h-3 bg-black/50 rounded-full overflow-hidden"><div className="h-full bg-gradient-to-r from-orange-500 to-orange-400 rounded-full transition-all" style={{ width: `${whaleProgress.progress}%` }}></div></div>
                  <span className="text-xl">üêã</span>
                  <span className="text-orange-400/70 text-sm">{whaleProgress.progress.toFixed(1)}%</span>
                </div>
                <div className="flex items-center justify-center gap-2 flex-wrap"><span className="text-3xl animate-fire">üî•</span>{creatures.map((c, i) => <span key={i} className="flex items-center gap-1"><span className="text-3xl">{c.e}</span><span className="text-white/80 text-lg font-bold">x{c.cnt}</span></span>)}</div>
              </div>
              <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
                {boxes.map(({ l, v }) => {
                  const isLoading = v === null;
                  const c = !isLoading ? getSingleC(getPct(v)) : { e: '‚è≥' };
                  return (
                    <div key={l} className="bg-[#1a1a1a] border border-orange-500/20 rounded-xl p-3">
                      <div className="flex justify-between mb-1"><span className="text-white/60 text-sm">{l}</span><span className="text-3xl">{c.e}</span></div>
                      {isLoading ? (
                        <div className="animate-pulse-slow"><div className="text-2xl font-bold text-orange-400/50">Loading...</div><div className="text-lg text-green-400/50">‚Äî</div></div>
                      ) : (
                        <><div className="text-2xl font-bold text-orange-400">{fmt(v)}</div><div className="text-lg text-green-400">{fmtUSD(v * price)}</div></>
                      )}
                    </div>
                  );
                })}
              </div>
              <div className="text-center text-white/30 text-xs mt-4">Burn: {BURN_ADDRESS}</div>
            </div>
          </div>
        </div>
      );
    };
    
    // LP Row
    const LPRow = ({ pair, theme, mainAddr }) => {
      const [logoErr, setLogoErr] = useState(false);
      const [det, setDet] = useState(false);
      const liq = pair.liq || 0, vol = pair.vol || 0;
      const ratio = liq > 0 ? (vol / liq).toFixed(3) : '0.000';
      const buys = pair.txns?.h24?.buys || 0, sells = pair.txns?.h24?.sells || 0;
      const chg = pair.priceChange?.h24 || 0, up = chg >= 0;
      const isBase = pair.baseToken?.address?.toLowerCase() === mainAddr?.toLowerCase();
      const other = isBase ? pair.quoteToken : pair.baseToken;
      const logo = getLogo(other?.address);
      const baseReserve = pair.liquidity?.base || 0;
      const quoteReserve = pair.liquidity?.quote || 0;
      return (
        <div className={`${theme.card} border ${theme.border} rounded-lg p-3 sm:p-4 hover:border-opacity-60`}>
          <div className="hidden sm:grid grid-cols-12 gap-2 items-center">
            <div className="col-span-1 flex justify-center">{!logoErr && logo ? <img src={logo} className="w-10 h-10 rounded-full bg-black/50" onError={() => setLogoErr(true)}/> : <div className="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center font-bold">{other?.symbol?.[0]}</div>}</div>
            <div className="col-span-2"><div className={`font-semibold ${theme.text}`}>{pair.baseToken?.symbol}/{pair.quoteToken?.symbol}</div><div className="text-gray-500 text-sm">PulseX V2</div></div>
            <div className="col-span-2 text-right"><div className="text-white text-xs">Volume</div><div className="text-white font-semibold">{fmtUSD(vol)}</div></div>
            <div className="col-span-2 text-right"><div className="text-white text-xs">Liquidity</div><div className="text-white">{fmtUSD(liq)}</div></div>
            <div className="col-span-1 text-center"><div className="text-white text-xs">24h</div><div className={up ? 'text-green-400' : 'text-red-400'}>{up ? '‚ñ≤' : '‚ñº'} {Math.abs(chg).toFixed(1)}%</div></div>
            <div className="col-span-1 text-center"><div className="text-white text-xs">Txns</div><div><span className="text-green-400">{buys}</span>/<span className="text-red-400">{sells}</span></div></div>
            <div className="col-span-1 text-right"><div className="text-white text-xs">Vol/Liq</div><div className="text-white">{ratio}</div></div>
            <div className="col-span-2 flex justify-end gap-2"><button onClick={() => setDet(!det)} className="text-lg hover:scale-110">‚ÑπÔ∏è</button><a href={`https://dexscreener.com/pulsechain/${pair.pairAddress}`} target="_blank" className="text-lg hover:scale-110">üìà</a><a href={`https://www.dextools.io/app/en/pulse/pair-explorer/${pair.pairAddress}`} target="_blank" className="text-lg hover:scale-110">üìä</a></div>
          </div>
          <div className="sm:hidden">
            <div className="flex items-center gap-3 mb-2">{!logoErr && logo ? <img src={logo} className="w-8 h-8 rounded-full bg-black/50" onError={() => setLogoErr(true)}/> : <div className="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-xs font-bold">{other?.symbol?.[0]}</div>}<div className="flex-1"><div className={`font-semibold ${theme.text} text-sm`}>{pair.baseToken?.symbol}/{pair.quoteToken?.symbol}</div></div><div className={`text-sm font-semibold ${up ? 'text-green-400' : 'text-red-400'}`}>{up ? '‚ñ≤' : '‚ñº'} {Math.abs(chg).toFixed(1)}%</div></div>
            <div className="grid grid-cols-4 gap-2 text-center text-xs"><div><div className="text-gray-400">Vol</div><div className="text-white">{fmtUSD(vol)}</div></div><div><div className="text-gray-400">Liq</div><div className="text-white">{fmtUSD(liq)}</div></div><div><div className="text-gray-400">Txns</div><div><span className="text-green-400">{buys}</span>/<span className="text-red-400">{sells}</span></div></div><div><div className="text-gray-400">V/L</div><div className="text-white">{ratio}</div></div></div>
          </div>
          {det && (
            <div className="mt-3 pt-3 border-t border-white/10 grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm">
              <div><span className="text-gray-400">Pair:</span> <span className="text-white font-mono text-xs">{pair.pairAddress?.slice(0, 10)}...</span></div>
              <div><span className="text-gray-400">Created:</span> <span className="text-white">{pair.pairCreatedAt ? new Date(pair.pairCreatedAt).toLocaleDateString() : '‚Äî'}</span></div>
              <div><span className="text-gray-400">Price:</span> <Price p={parseFloat(pair.priceUsd)} c="text-white"/></div>
              <div><span className="text-gray-400">FDV:</span> <span className="text-white">{fmtUSD(pair.fdv)}</span></div>
              <div><span className="text-gray-400">{pair.baseToken?.symbol}:</span> <span className={theme.text}>{fmt(baseReserve)}</span></div>
              <div><span className="text-gray-400">{pair.quoteToken?.symbol}:</span> <span className="text-white">{fmt(quoteReserve)}</span></div>
            </div>
          )}
        </div>
      );
    };
    
    // Home
    const Home = ({ onSelect }) => {
      const [data, setData] = useState({ PTGC: null, UFO: null });
      const [loading, setLoading] = useState(true);
      useEffect(() => { const load = async () => { const [p, u] = await Promise.all([fetchDex(TOKENS.PTGC.address, TOKENS.PTGC.mainPair), fetchDex(TOKENS.UFO.address, TOKENS.UFO.mainPair)]); setData({ PTGC: p, UFO: u }); setLoading(false); }; load(); const i = setInterval(load, 30000); return () => clearInterval(i); }, []);
      const Card = ({ token, d }) => {
        const cfg = TOKENS[token], isGold = cfg.color === 'gold';
        const border = isGold ? 'border-[#D9CA5D]/50' : 'border-[#7CFC00]/50', text = isGold ? 'text-[#D9CA5D]' : 'text-[#7CFC00]';
        const bg = isGold ? 'bg-gradient-to-r from-[#D9CA5D]/20 via-[#1a1a1a] to-[#1a1a1a]' : 'bg-gradient-to-r from-[#7CFC00]/20 via-[#1a1a1a] to-[#1a1a1a]';
        const hover = isGold ? 'token-card-gold' : 'token-card-green', up = (d?.change || 0) >= 0;
        return (
          <div onClick={() => onSelect(token)} className={`token-card ${hover} cursor-pointer rounded-2xl border-2 ${border} ${bg} p-4 sm:p-6 lg:p-8`}>
            <div className="flex flex-col sm:flex-row items-center gap-4 sm:gap-6">
              <img src={cfg.logo} alt={token} className="w-20 h-20 sm:w-24 sm:h-24 lg:w-32 lg:h-32 object-contain"/>
              <div className="text-center sm:text-left"><div className={`font-orbitron text-2xl sm:text-3xl lg:text-4xl font-bold ${text}`}>{token}</div><div className="text-white/40 text-xs font-mono mt-1">{cfg.address.slice(0, 6)}...{cfg.address.slice(-4)}</div></div>
              <div className="flex-1 text-center sm:text-right"><Price p={d?.price} c="text-white font-bold text-xl sm:text-2xl lg:text-3xl"/><div className="text-white/50 text-sm sm:text-lg mt-1">MCap: {fmtUSD(d?.mcap)}</div></div>
              <div className="flex items-center gap-2 sm:gap-4"><svg viewBox="0 0 100 24" className="w-16 sm:w-20 h-6"><polyline points={up ? "0,20 30,14 60,11 100,5" : "0,5 30,10 60,12 100,18"} fill="none" stroke={up ? '#22c55e' : '#ef4444'} strokeWidth="2"/></svg><div className={`px-2 sm:px-3 py-1 rounded-lg text-sm sm:text-lg font-bold ${up ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`}>{up ? '‚ñ≤' : '‚ñº'} {Math.abs(d?.change || 0).toFixed(2)}%</div></div>
            </div>
          </div>
        );
      };
      return (
        <div className="min-h-screen flex flex-col px-4">
          <header className="text-center pt-4"><img src={COMBINED_LOGO} alt="PTGC & UFO" className="h-48 sm:h-64 md:h-80 lg:h-96 mx-auto"/><h1 className="font-orbitron text-3xl sm:text-4xl lg:text-5xl font-bold mb-2 -mt-6 sm:-mt-10" style={{ background: 'linear-gradient(180deg, #FFF, #808080)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent' }}>DASHBOARD</h1><p className="text-white/50 text-sm sm:text-lg mb-6 sm:mb-10">A community tool built for The Grays Ecosystem</p></header>
          <div className="flex-1 flex justify-center pb-8"><div className="flex flex-col gap-4 sm:gap-6 max-w-4xl w-full">{loading ? <><div className="animate-pulse bg-white/10 rounded-2xl h-32"></div><div className="animate-pulse bg-white/10 rounded-2xl h-32"></div></> : <><Card token="PTGC" d={data.PTGC}/><Card token="UFO" d={data.UFO}/></>}</div></div>
          <footer className="text-center py-4 border-t border-white/10"><p className="text-white/30 text-xs">Not financial advice. DYOR.</p></footer>
        </div>
      );
    };
    
    // Dashboard
    const Dashboard = ({ token, onBack }) => {
      const cfg = TOKENS[token], isGold = cfg.color === 'gold';
      const theme = { text: isGold ? 'text-[#D9CA5D]' : 'text-[#7CFC00]', border: isGold ? 'border-[#D9CA5D]/30' : 'border-[#7CFC00]/30', bg: isGold ? 'bg-[#D9CA5D]' : 'bg-[#7CFC00]', card: 'bg-[#111]/80' };
      const [data, setData] = useState(null);
      const [burn, setBurn] = useState({ total: 0, pct: 0, supply: 0 });
      const [holders, setHolders] = useState(0);
      const [pls, setPls] = useState(0.00005);
      const [loading, setLoading] = useState(true);
      const [sortBy, setSortBy] = useState('volume');
      const [sortDir, setSortDir] = useState('desc');
      const [lastUpdate, setLastUpdate] = useState(new Date());
      const [showBurn, setShowBurn] = useState(false);
      const [statModal, setStatModal] = useState(null);
      const [valueGenPeriod, setValueGenPeriod] = useState('24h');
      
      useEffect(() => { const load = async () => { const [d, h, b, p] = await Promise.all([fetchDex(cfg.address, cfg.mainPair), fetchHolders(cfg.address), fetchBurn(cfg.address, cfg.decimals), fetchPLS()]); setData(d); setHolders(h); setBurn(b); setPls(p); setLastUpdate(new Date()); setLoading(false); }; load(); const i = setInterval(load, 60000); return () => clearInterval(i); }, [token]);
      
      const sorted = useMemo(() => {
        if (!data?.pairs) return [];
        return [...data.pairs].sort((a, b) => {
          let av, bv;
          switch (sortBy) {
            case 'ratio': av = a.liq > 0 ? a.vol / a.liq : 0; bv = b.liq > 0 ? b.vol / b.liq : 0; break;
            case 'volume': av = a.vol; bv = b.vol; break;
            case 'liquidity': av = a.liq; bv = b.liq; break;
            case 'change': av = a.priceChange?.h24 || 0; bv = b.priceChange?.h24 || 0; break;
            default: av = a.vol; bv = b.vol;
          }
          return sortDir === 'desc' ? bv - av : av - bv;
        });
      }, [data?.pairs, sortBy, sortDir]);
      
      const high = sorted.filter(p => p.liq >= MIN_LIQ), low = sorted.filter(p => p.liq < MIN_LIQ);
      const [showLow, setShowLow] = useState(false);
      const creatures = getBurnC(burn?.pct || 0, 'Squid');
      const plsRatio = data?.price && pls ? (data.price / pls).toFixed(2) : '‚Äî';
      const priceUp = (data?.change || 0) >= 0;
      const liqMcapRatio = data?.mcap > 0 ? ((data.liq / data.mcap) * 100).toFixed(2) : '‚Äî';
      const whaleProgress = getWhaleProgress(burn?.pct || 0);
      const tokensInLP = data?.tokensInLP || 0;
      const tokensInLPPct = cfg.totalSupply > 0 ? ((tokensInLP / cfg.totalSupply) * 100).toFixed(2) : '0';
      
      // Value Generation with time period multiplier
      const vol24h = data?.vol || 0;
      const periodMultipliers = { '24h': 1, '7d': 7, '30d': 30, '90d': 90 };
      const periodVolume = vol24h * periodMultipliers[valueGenPeriod];
      const valueGenTotal = periodVolume * cfg.taxRate;
      
      const getStatValue = (type) => {
        switch(type) {
          case 'volume': return data?.vol || 0;
          case 'liquidity': return data?.liq || 0;
          case 'holders': return holders;
          case 'txns': return (data?.buys || 0) + (data?.sells || 0);
          default: return 0;
        }
      };
      
      if (loading) return <div className="min-h-screen flex items-center justify-center"><div className="text-center"><div className={`w-16 h-16 mx-auto mb-4 rounded-full border-4 ${theme.border} border-t-transparent animate-spin`}></div><div className={`font-orbitron text-lg ${theme.text}`}>Loading {token}...</div></div></div>;
      
      return (
        <div className="min-h-screen">
          {/* Header */}
          <header className="sticky top-0 z-50 bg-[#0a0a0a]/95 backdrop-blur border-b border-white/10">
            <div className="max-w-7xl mx-auto px-3 sm:px-6 py-4 sm:py-5">
              <div className="flex items-center justify-between flex-wrap gap-3">
                <div className="flex items-center gap-4 sm:gap-6">
                  <button onClick={onBack} className="text-white/60 hover:text-white text-lg">‚Üê Home</button>
                  <img src={cfg.logo} alt={token} className="w-20 h-20 sm:w-24 sm:h-24"/>
                  <div className="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-5">
                    <span className={`font-orbitron text-3xl sm:text-4xl lg:text-5xl font-bold ${theme.text}`}>{token}</span>
                    <div className={`${theme.card} border ${theme.border} rounded-xl px-5 py-3 flex items-center gap-3`}>
                      <Price p={data?.price} c={`text-3xl sm:text-4xl font-bold ${theme.text}`}/>
                      <span className={`text-xl font-bold ${priceUp ? 'text-green-400' : 'text-red-400'}`}>{priceUp ? '‚ñ≤' : '‚ñº'}{Math.abs(data?.change || 0).toFixed(2)}%</span>
                    </div>
                    <div className={`${theme.card} border ${theme.border} rounded-xl px-5 py-3`}>
                      <span className="text-white/60 text-sm mr-2">PLS</span>
                      <span className={`text-3xl sm:text-4xl font-bold ${theme.text}`}>{plsRatio}</span>
                    </div>
                  </div>
                </div>
                <div className="flex items-center gap-2">
                  <span className="text-white/40 text-xs hidden md:block">{lastUpdate.toLocaleTimeString()}</span>
                  <a href={cfg.pulseScanUrl} target="_blank" className={`px-4 py-2 rounded-lg border ${theme.border} ${theme.text} font-medium hover:bg-white/5`}>Explorer</a>
                  <button className={`px-4 py-2 rounded-lg ${theme.bg} text-black font-bold`}>KPI Report</button>
                </div>
              </div>
            </div>
          </header>
          
          {/* Stats Row */}
          <div className="border-b border-white/10">
            <div className="max-w-7xl mx-auto px-3 sm:px-6 py-3">
              <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-7 gap-3">
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}>
                  <div className="text-white text-xs uppercase mb-1">Market Cap</div>
                  <div className={`text-2xl font-bold ${theme.text}`}>{fmtUSD(data?.mcap)}</div>
                  <div className={`text-sm ${priceUp ? 'text-green-400' : 'text-red-400'}`}>{priceUp ? '‚ñ≤' : '‚ñº'} {Math.abs(data?.change || 0).toFixed(2)}%</div>
                </div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3 clickable`} onClick={() => setStatModal('volume')}>
                  <div className="flex justify-between"><span className="text-white text-xs uppercase">Volume 24H</span><span className="text-white/40 text-xs">üìä</span></div>
                  <div className={`text-2xl font-bold ${theme.text}`}>{fmtUSD(data?.vol)}</div>
                </div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3 clickable`} onClick={() => setStatModal('liquidity')}>
                  <div className="flex justify-between"><span className="text-white text-xs uppercase">Liquidity</span><span className="text-white/40 text-xs">üìä</span></div>
                  <div className={`text-2xl font-bold ${theme.text}`}>{fmtUSD(data?.liq)}</div>
                </div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}>
                  <div className="text-white text-xs uppercase mb-1">Liq/MCap</div>
                  <div className={`text-2xl font-bold ${theme.text}`}>{liqMcapRatio}%</div>
                </div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3 clickable`} onClick={() => setStatModal('holders')}>
                  <div className="flex justify-between"><span className="text-white text-xs uppercase">Holders</span><span className="text-white/40 text-xs">üìä</span></div>
                  <div className={`text-2xl font-bold ${theme.text}`}>{fmt(holders)}</div>
                </div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}>
                  <div className="text-white text-xs uppercase mb-1">Tokens in LP</div>
                  <div className={`text-2xl font-bold ${theme.text}`}>{fmtAbbr(tokensInLP)}</div>
                  <div className="text-white/50 text-sm">{tokensInLPPct}% of supply</div>
                </div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3 clickable`} onClick={() => setStatModal('txns')}>
                  <div className="flex justify-between"><span className="text-white text-xs uppercase">Txns 24H</span><span className="text-white/40 text-xs">üìä</span></div>
                  <div className="text-2xl font-bold"><span className="text-green-400">{data?.buys || 0}</span><span className="text-white/50"> / </span><span className="text-red-400">{data?.sells || 0}</span></div>
                </div>
              </div>
            </div>
          </div>
          
          {/* Data Boxes */}
          <div className="max-w-7xl mx-auto px-3 sm:px-6 py-4">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
              {/* Burn Box */}
              <div className="bg-gradient-to-r from-orange-500/15 via-orange-600/10 to-orange-500/15 border border-orange-500/30 rounded-xl p-4 clickable" onClick={() => setShowBurn(true)}>
                <div className="flex justify-between mb-3"><div className="text-xs text-orange-400/90 uppercase font-semibold">üî• Total Supply Burned</div><span className="text-orange-400/60 text-xs">Click for details ‚Üí</span></div>
                <div className="flex items-center gap-3 mb-3 flex-wrap"><span className={`text-2xl font-bold ${theme.text}`}>{fmt(burn?.total)}</span><span className="text-lg font-bold text-green-400">{fmtUSD((burn?.total || 0) * (data?.price || 0))}</span><span className="text-white/50">{(burn?.pct || 0).toFixed(2)}%</span></div>
                <div className="flex items-center gap-2 mb-3">
                  <div className="flex-1 h-2 bg-black/50 rounded-full overflow-hidden"><div className="h-full bg-gradient-to-r from-orange-500 to-orange-400 rounded-full" style={{ width: `${whaleProgress.progress}%` }}></div></div>
                  <span className="text-xl">üêã</span>
                  <span className="text-orange-400/70 text-sm">{whaleProgress.progress.toFixed(1)}%</span>
                </div>
                <div className="flex items-center gap-2 flex-wrap"><span className="text-2xl animate-fire">üî•</span>{creatures.map((c, i) => <span key={i} className="flex items-center gap-1"><span className="text-2xl">{c.e}</span><span className="text-white/70 font-bold">x{c.cnt}</span></span>)}</div>
              </div>
              
              {/* Value Generation Box with Time Period Selector */}
              <div className={`bg-gradient-to-r ${isGold ? 'from-[#D9CA5D]/15 via-[#D9CA5D]/10 to-[#D9CA5D]/15' : 'from-[#7CFC00]/15 via-[#7CFC00]/10 to-[#7CFC00]/15'} border ${theme.border} rounded-xl p-4`}>
                <div className="flex justify-between items-center mb-3">
                  <div className={`text-xs ${theme.text} uppercase font-semibold`}>üí∞ Value Generation</div>
                  <div className="flex gap-1">
                    {['24h', '7d', '30d', '90d'].map(p => (
                      <button key={p} onClick={() => setValueGenPeriod(p)} className={`time-btn px-2 py-1 rounded text-xs font-medium ${valueGenPeriod === p ? `${theme.text} active` : 'text-white/50'}`}>{p}</button>
                    ))}
                  </div>
                </div>
                <div className="flex items-center gap-3 mb-4">
                  <span className="text-3xl font-bold text-green-400">{fmtUSD(valueGenTotal)}</span>
                  <span className={`text-sm ${theme.text} opacity-70`}>({(cfg.taxRate * 100).toFixed(0)}% of {fmtUSD(periodVolume)} vol)</span>
                </div>
                <div className="space-y-2">
                  {cfg.taxBreakdown.map((item, i) => {
                    const val = periodVolume * (item.pct / 100);
                    return (
                      <div key={i} className={`${theme.card} border ${theme.border} rounded-lg px-3 py-2 flex justify-between items-center`}>
                        <div className="flex items-center gap-2">
                          <span className="text-lg">{item.emoji}</span>
                          <span className="text-white/80 text-sm">{item.name}</span>
                        </div>
                        <span className={`text-lg font-bold ${theme.text}`}>{fmtUSD(val)}</span>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          </div>
          
          {/* LP Pairs */}
          <div className="max-w-7xl mx-auto px-3 sm:px-6 py-4">
            <div className="flex justify-between mb-3 flex-wrap gap-2">
              <h2 className="text-lg font-semibold text-white">LP Pairs <span className="text-gray-500 text-sm">({high.length} with $1K+ LP)</span></h2>
              <div className={`${theme.card} border ${theme.border} rounded-lg px-3 py-2 flex items-center gap-2`}>
                <span className="text-gray-400 text-xs">Sort:</span>
                {['Ratio', 'Volume', 'Liquidity', '24h %'].map((l, i) => { const c = ['ratio', 'volume', 'liquidity', 'change'][i]; return <button key={c} onClick={() => { sortBy === c ? setSortDir(sortDir === 'desc' ? 'asc' : 'desc') : (setSortBy(c), setSortDir('desc')); }} className={`px-2 py-1 rounded text-xs ${sortBy === c ? `${theme.text} bg-white/10` : 'text-gray-500'}`}>{l}{sortBy === c && (sortDir === 'desc' ? '‚Üì' : '‚Üë')}</button>; })}
              </div>
            </div>
            <div className="space-y-2">{high.map((p, i) => <LPRow key={p.pairAddress || i} pair={p} theme={theme} mainAddr={cfg.address}/>)}</div>
            {low.length > 0 && <div className="mt-3"><button onClick={() => setShowLow(!showLow)} className={`w-full ${theme.card} border ${theme.border} rounded-lg p-2 flex justify-between text-sm`}><span className="text-gray-400">{showLow ? 'Hide' : 'Show'} {low.length} pairs &lt;$1K</span><span className={theme.text}>{showLow ? '‚ñ≤' : '‚ñº'}</span></button>{showLow && <div className="mt-2 space-y-2">{low.map((p, i) => <LPRow key={p.pairAddress || i} pair={p} theme={theme} mainAddr={cfg.address}/>)}</div>}</div>}
          </div>
          
          <footer className="text-center py-4 border-t border-white/10 mt-8"><p className="text-white/30 text-xs">Not financial advice. DYOR.</p></footer>
          
          <BurnModal open={showBurn} close={() => setShowBurn(false)} token={token} burn={burn} price={data?.price || 0} cfg={cfg}/>
          <StatModal open={!!statModal} close={() => setStatModal(null)} title={statModal === 'volume' ? 'Volume' : statModal === 'liquidity' ? 'Liquidity' : statModal === 'holders' ? 'Holders' : 'Transactions'} theme={theme} currentVal={getStatValue(statModal)}/>
        </div>
      );
    };
    
    const App = () => {
      const [view, setView] = useState('home');
      const [token, setToken] = useState(null);
      if (view === 'dashboard' && token) return <Dashboard token={token} onBack={() => { setView('home'); setToken(null); }}/>;
      return <Home onSelect={t => { setToken(t); setView('dashboard'); }}/>;
    };
    
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
