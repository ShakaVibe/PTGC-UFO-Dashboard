<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PTGC UFO Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Rajdhani',sans-serif;background:#0a0a0a;min-height:100vh}
    .font-orbitron{font-family:'Orbitron',monospace}
    ::-webkit-scrollbar{width:8px}
    ::-webkit-scrollbar-track{background:#1a1a1a}
    ::-webkit-scrollbar-thumb{background:#333;border-radius:4px}
    @keyframes fire{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
    .animate-fire{animation:fire 0.5s ease-in-out infinite}
    .animate-pulse-slow{animation:pulse 1.5s ease-in-out infinite}
    .token-card{transition:all 0.3s ease}
    .token-card:hover{transform:scale(1.02)}
    .token-card-gold:hover{box-shadow:0 0 50px rgba(217,202,93,0.5)}
    .token-card-green:hover{box-shadow:0 0 50px rgba(124,252,0,0.5)}
    .modal-overlay{backdrop-filter:blur(8px)}
    .clickable:hover{transform:scale(1.02);cursor:pointer}
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const {useState,useEffect,useMemo}=React;
    
    const TOKENS={
      PTGC:{name:'PTGC',address:'0x94534EeEe131840b1c0F61847c572228bdfDDE93',logo:'06_PTGC_V1_transparent_bg.png',color:'gold',colorHex:'#D9CA5D',decimals:18,mainPair:'0xf5A89A6487D62df5308CDDA89c566C5B5ef94C11',pulseScanUrl:'https://scan.pulsechain.com/token/0x94534EeEe131840b1c0F61847c572228bdfDDE93',totalSupply:333333333333,taxRate:0.05,hasDAO:true,
        daoContract:'0x305ACfAb82103c2b82B19543919d1c93b44E55DB',
        daoTreasury:'0xeeac1da7f930078ab757ad8a64cf7c5e17b931e1',
        stakingContract:'0xC71f597a2AC39E47F07102E849d18489C96f39EF',
        taxBreakdown:[{name:'DAO',pct:2,emoji:'\u{1F3DB}\u{FE0F}'},{name:'Stakers',pct:1,emoji:'\u{1F48E}'},{name:'Holders+Stakers',pct:1,emoji:'\u{1F48E}\u{1F48E}'},{name:'Buy & Burn',pct:0.5,emoji:'\u{1F525}'},{name:'Add LP',pct:0.5,emoji:'\u{1F4A7}'}]
      },
      UFO:{name:'UFO',address:'0x456548A9B56eFBbD89Ca0309edd17a9E20b04018',logo:'07_Ufo_transparent.png',color:'green',colorHex:'#7CFC00',decimals:18,mainPair:'0xbeA0e55b82Eb975280041F3b49C4D0bD937b72d5',pulseScanUrl:'https://scan.pulsechain.com/token/0x456548A9B56eFBbD89Ca0309edd17a9E20b04018',totalSupply:999999999051,taxRate:0.06,hasDAO:false,
        taxBreakdown:[{name:'LP Providers',pct:3,emoji:'\u{1F4A7}'},{name:'Holders',pct:1,emoji:'\u{1F48E}'},{name:'Burn UFO',pct:1,emoji:'\u{1F525}'},{name:'Burn PTGC',pct:1,emoji:'\u{1F525}'}]
      }
    };
    
    const LP_ADDRESSES=['0xf5a89a6487d62df5308cdda89c566c5b5ef94c11','0xbea0e55b82eb975280041f3b49c4d0bd937b72d5'];
    const BURN_ADDRESS='0x0000000000000000000000000000000000000369';
    const COMBINED_LOGO='07_Combined_PTGC_UFO_Transparent.png';
    const RPC='https://rpc.pulsechain.com';
    const MIN_LIQ=1000;
    
    const HOLDER_TIERS_DISPLAY=[
      {n:'Poseidon',e:'\u{1F531}',p:10},
      {n:'Whale',e:'\u{1F40B}',p:1},
      {n:'Shark',e:'\u{1F988}',p:0.1},
      {n:'Dolphin',e:'\u{1F42C}',p:0.01},
      {n:'Squid',e:'\u{1F991}',p:0.001},
      {n:'Turtle & Below',e:'\u{1F422}',p:0}
    ];
    
    const HOLDER_TIERS=[
      {n:'Poseidon',p:10},{n:'Whale',p:1},{n:'Shark',p:0.1},{n:'Dolphin',p:0.01},{n:'Squid',p:0.001},{n:'Turtle',p:0.0001},{n:'Shrimp',p:0.00001},{n:'Shell',p:0}
    ];
    
    const BURN_C=[{n:'Poseidon',e:'\u{1F531}',p:10},{n:'Whale',e:'\u{1F40B}',p:1},{n:'Shark',e:'\u{1F988}',p:0.1},{n:'Dolphin',e:'\u{1F42C}',p:0.01},{n:'Squid',e:'\u{1F991}',p:0.001},{n:'Turtle',e:'\u{1F422}',p:0.0001},{n:'Shrimp',e:'\u{1F990}',p:0.00001},{n:'Shell',e:'\u{1F41A}',p:0}];
    
    const fmt=n=>n==null||isNaN(n)?'\u2014':Math.floor(Number(n)).toLocaleString('en-US');
    const fmtUSD=n=>n==null||isNaN(n)?'\u2014':'$'+Math.floor(Number(n)).toLocaleString('en-US');
    const fmtAbbr=n=>{if(n==null||isNaN(n))return'\u2014';const num=Number(n);if(num>=1e12)return(num/1e12).toFixed(2)+'T';if(num>=1e9)return(num/1e9).toFixed(2)+'B';if(num>=1e6)return(num/1e6).toFixed(2)+'M';if(num>=1e3)return(num/1e3).toFixed(2)+'K';return Math.floor(num).toLocaleString('en-US')};
    const fmtPrice=p=>{if(!p||isNaN(p)||p===0)return'\u2014';if(p>=1)return'$'+p.toFixed(2);if(p>=0.0001)return'$'+p.toFixed(6);const s=p.toExponential(4),[m,e]=s.split('e'),exp=Math.abs(parseInt(e));return{pre:'$0.0',z:exp-1,d:parseFloat(m).toFixed(4).replace('.','').slice(0,4)}};
    const Price=({p,c=''})=>{const f=fmtPrice(p);return typeof f==='string'?<span className={c}>{f}</span>:<span className={c}>{f.pre}<sub className="text-[0.6em] opacity-70">{f.z}</sub>{f.d}</span>};
    const getLogo=a=>a?`https://dd.dexscreener.com/ds-data/tokens/pulsechain/${a.toLowerCase()}.png`:null;
    const getBurnC=(pct,min='Shell')=>{const r=[];let rem=pct;const minI=BURN_C.findIndex(c=>c.n===min);for(let i=0;i<BURN_C.length;i++){if(minI>=0&&i>minI)continue;const c=BURN_C[i];if(c.p>0&&rem>=c.p){const cnt=Math.floor(rem/c.p);if(cnt>0){r.push({...c,cnt});rem-=cnt*c.p}}}return r};
    const getSingleC=pct=>{for(const c of BURN_C)if(pct>=c.p)return c;return BURN_C[BURN_C.length-1]};
    const getWhaleProgress=pct=>({whales:Math.floor(pct),progress:(pct-Math.floor(pct))*100});
    const getHolderTier=(holdingPct)=>{for(const tier of HOLDER_TIERS){if(holdingPct>=tier.p)return tier.n}return'Shell'};
    
    const fetchDex=async(addr,mainPair)=>{try{let mp=null;if(mainPair){const r=await fetch(`https://api.dexscreener.com/latest/dex/pairs/pulsechain/${mainPair}`);const d=await r.json();if(d.pair)mp=d.pair}const res=await fetch(`https://api.dexscreener.com/latest/dex/tokens/${addr}`);const data=await res.json();if(data.pairs&&data.pairs.length>0){const pairs=data.pairs.map(p=>({...p,liq:p.liquidity?.usd||0,vol:p.volume?.h24||0})).sort((a,b)=>b.liq-a.liq);const pp=mp||pairs[0];let totalTokensInLP=0;pairs.forEach(p=>{const isBase=p.baseToken?.address?.toLowerCase()===addr.toLowerCase();if(isBase&&p.liquidity?.base)totalTokensInLP+=p.liquidity.base;else if(!isBase&&p.liquidity?.quote)totalTokensInLP+=p.liquidity.quote});return{price:parseFloat(pp.priceUsd)||0,change:pp.priceChange?.h24||0,mcap:pp.marketCap||pp.fdv||0,liq:pairs.reduce((s,p)=>s+p.liq,0),vol:pairs.reduce((s,p)=>s+p.vol,0),buys:pairs.reduce((s,p)=>s+(p.txns?.h24?.buys||0),0),sells:pairs.reduce((s,p)=>s+(p.txns?.h24?.sells||0),0),tokensInLP:totalTokensInLP,pairs}}return null}catch(e){console.error(e);return null}};
    const fetchHolders=async addr=>{try{const r=await fetch(`https://api.scan.pulsechain.com/api/v2/tokens/${addr}/counters`);return parseInt((await r.json()).token_holders_count)||0}catch{return 0}};
    const fetchBurn=async(addr,dec)=>{try{const bRes=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_call',params:[{to:addr,data:'0x70a08231000000000000000000000000'+BURN_ADDRESS.slice(2)},'latest'],id:1})});const burned=Number(BigInt((await bRes.json()).result||'0x0'))/Math.pow(10,dec);const sRes=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_call',params:[{to:addr,data:'0x18160ddd'},'latest'],id:2})});const supply=Number(BigInt((await sRes.json()).result||'0x0'))/Math.pow(10,dec);return{total:burned,pct:supply>0?(burned/supply)*100:0,supply}}catch{return{total:0,pct:0,supply:0}}};
    const fetchBurnHist=async(addr,dec,hrs)=>{try{const blocksPerHour=360;const bRes=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_blockNumber',params:[],id:1})});const curBlock=parseInt((await bRes.json()).result,16);if(hrs>24*7){let totalBurn=0;const chunkHours=24*5;const chunks=Math.ceil(hrs/chunkHours);for(let i=0;i<chunks;i++){const endBlock=curBlock-(i*blocksPerHour*chunkHours);const startBlock=Math.max(0,endBlock-(blocksPerHour*chunkHours));try{const lRes=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_getLogs',params:[{address:addr,topics:['0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef',null,'0x000000000000000000000000'+BURN_ADDRESS.slice(2)],fromBlock:'0x'+startBlock.toString(16),toBlock:'0x'+endBlock.toString(16)}],id:1})});const logs=(await lRes.json()).result;if(Array.isArray(logs))totalBurn+=logs.reduce((s,l)=>s+Number(BigInt(l.data))/Math.pow(10,dec),0)}catch{}}return totalBurn}const fromBlock='0x'+Math.max(0,curBlock-(blocksPerHour*hrs)).toString(16);const lRes=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_getLogs',params:[{address:addr,topics:['0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef',null,'0x000000000000000000000000'+BURN_ADDRESS.slice(2)],fromBlock,toBlock:'latest'}],id:1})});const logs=(await lRes.json()).result;return Array.isArray(logs)?logs.reduce((s,l)=>s+Number(BigInt(l.data))/Math.pow(10,dec),0):0}catch{return 0}};
    const fetchPLS=async()=>{try{const r=await fetch('https://api.dexscreener.com/latest/dex/pairs/pulsechain/0xe56043671df55de5cdf8459710433c10324de0ae');return parseFloat((await r.json()).pair?.priceUsd)||0.00005}catch{return 0.00005}};
    
    const fetchPLSBalance=async(addr)=>{try{const r=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_getBalance',params:[addr,'latest'],id:1})});const result=(await r.json()).result;return Number(BigInt(result||'0x0'))/1e18}catch{return 0}};
    
    const fetchTokenBalance=async(tokenAddr,walletAddr,decimals)=>{
      try{
        const data='0x70a08231000000000000000000000000'+walletAddr.slice(2).toLowerCase();
        const r=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_call',params:[{to:tokenAddr,data},'latest'],id:1})});
        const result=(await r.json()).result;
        return Number(BigInt(result||'0x0'))/Math.pow(10,decimals);
      }catch{return 0}
    };
    
    // Fetch staking data - total staked and locked separately
    const fetchStakingData=async(stakingContract,tokenAddr,decimals,totalSupply)=>{
      try{
        // Total tokens in staking contract
        const totalInContract=await fetchTokenBalance(tokenAddr,stakingContract,decimals);
        
        // Try to get locked supply from contract
        // lockedSupply() = 0x3f3d5530
        let lockedTokens=0;
        try{
          const lRes=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_call',params:[{to:stakingContract,data:'0x3f3d5530'},'latest'],id:1})});
          const lResult=(await lRes.json()).result;
          if(lResult&&lResult!=='0x'&&lResult!=='0x0000000000000000000000000000000000000000000000000000000000000000'){
            lockedTokens=Number(BigInt(lResult))/Math.pow(10,decimals);
          }
        }catch{}
        
        // If lockedSupply didn't work, try totalLockedBalance()
        if(lockedTokens===0){
          try{
            const lRes=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_call',params:[{to:stakingContract,data:'0x7448fbae'},'latest'],id:1})});
            const lResult=(await lRes.json()).result;
            if(lResult&&lResult!=='0x'&&lResult!=='0x0000000000000000000000000000000000000000000000000000000000000000'){
              lockedTokens=Number(BigInt(lResult))/Math.pow(10,decimals);
            }
          }catch{}
        }
        
        // Staked (not locked) = total in contract - locked
        const stakedTokens=Math.max(0,totalInContract-lockedTokens);
        
        const stakedPct=totalSupply>0?(stakedTokens/totalSupply)*100:0;
        const lockedPct=totalSupply>0?(lockedTokens/totalSupply)*100:0;
        
        return{
          totalInContract,
          staked:stakedTokens,
          stakedPct,
          locked:lockedTokens,
          lockedPct
        };
      }catch(e){
        console.error('Error fetching staking data:',e);
        return{totalInContract:0,staked:0,stakedPct:0,locked:0,lockedPct:0};
      }
    };
    
    // Management wallet tokens with hardcoded prices (same as ProWeb)
    const MANAGEMENT_TOKENS = [
      { symbol: 'USDC', address: '0x15D38573d2feeb82e7ad5187aB8c1D52810B1f07', decimals: 6, price: 1 },
      { symbol: 'USDT', address: '0x0Cb6F5a34ad42ec934882A05265A7d5F59b51A2f', decimals: 6, price: 1 },
      { symbol: 'DAI', address: '0xefD766cCb38EaF1dfd701853BFCe31359239F305', decimals: 18, price: 1 },
      { symbol: 'PLSX', address: '0x95B303987A60C71504D99Aa1b13B4DA07b0790ab', decimals: 18, priceRatio: 0.00008 },
      { symbol: 'HEX', address: '0x2b591e99afE9f32eAA6214f7B7629768c40Eeb39', decimals: 8, price: 0.001 },
      { symbol: 'INC', address: '0x2fa878Ab3F87CC1C9737Fc071108F904c0B0C95d', decimals: 18, price: 0.20 },
      { symbol: 'WBTC', address: '0xb17D901469B9208B17d916112988A3FeD19b5cA1', decimals: 8, price: 97000 },
    ];
    
    // Fetch DAO data - matching ProWeb exactly
    const fetchDAOData=async(daoContract,managementWallet,plsPrice)=>{
      try{
        // 1. Get DAO contract PLS balance (eth_getBalance)
        const daoBalanceRes=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_getBalance',params:[daoContract,'latest'],id:1})});
        const daoBalanceResult=await daoBalanceRes.json();
        const daoBalanceWei=BigInt(daoBalanceResult.result||'0x0');
        const daoBalancePLS=Number(daoBalanceWei)/1e18;
        console.log('DAO contract total:',daoBalancePLS,'PLS');
        
        // 2. Get lockedAmount() from DAO contract - selector 0x9ae697bf
        let lockedAmountWei=0n;
        try{
          const lockRes=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_call',params:[{to:daoContract,data:'0x9ae697bf'},'latest'],id:2})});
          const lockResult=await lockRes.json();
          console.log('lockedAmount raw result:',lockResult.result);
          if(lockResult.result&&lockResult.result.length>2){
            lockedAmountWei=BigInt(lockResult.result);
          }
        }catch(e){console.error('lockedAmount error:',e)}
        const lockedAmountPLS=Number(lockedAmountWei)/1e18;
        console.log('Locked/pending amount:',lockedAmountPLS,'PLS');
        
        // 2b. Get proposal count and count active ones - proposalCount() selector 0xda35c664
        let pendingCount=0;
        try{
          const pcRes=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_call',params:[{to:daoContract,data:'0xda35c664'},'latest'],id:5})});
          const pcResult=await pcRes.json();
          if(pcResult.result&&pcResult.result!=='0x'){
            const proposalCount=parseInt(pcResult.result,16);
            // Check state of recent proposals - state() selector 0x3e4f49e6
            const startId=Math.max(1,proposalCount-15);
            for(let i=proposalCount;i>=startId;i--){
              try{
                const idHex=i.toString(16).padStart(64,'0');
                const stateRes=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_call',params:[{to:daoContract,data:'0x3e4f49e6'+idHex},'latest'],id:6})});
                const stateResult=await stateRes.json();
                if(stateResult.result){
                  const state=parseInt(stateResult.result,16);
                  // State 0=Pending, 1=Active
                  if(state===0||state===1)pendingCount++;
                }
              }catch{}
            }
          }
        }catch(e){console.error('proposalCount error:',e)}
        console.log('Active proposals:',pendingCount);
        
        // 3. Calculate available = total - locked (using BigInt for precision)
        const availableWei=daoBalanceWei>lockedAmountWei?daoBalanceWei-lockedAmountWei:0n;
        const availablePLS=Number(availableWei)/1e18;
        console.log('Available for new proposals:',availablePLS,'PLS');
        
        // 4. Get management wallet PLS balance
        const mgmtBalanceRes=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_getBalance',params:[managementWallet,'latest'],id:3})});
        const mgmtBalanceResult=await mgmtBalanceRes.json();
        const mgmtPLSWei=BigInt(mgmtBalanceResult.result||'0x0');
        const mgmtPLS=Number(mgmtPLSWei)/1e18;
        console.log('Management wallet PLS:',mgmtPLS);
        
        // 5. Get management wallet token balances (same tokens as ProWeb)
        let managementTotalUSD=mgmtPLS*plsPrice;
        
        for(const token of MANAGEMENT_TOKENS){
          try{
            const data='0x70a08231000000000000000000000000'+managementWallet.slice(2).toLowerCase();
            const tokenRes=await fetch(RPC,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({jsonrpc:'2.0',method:'eth_call',params:[{to:token.address,data},'latest'],id:4})});
            const tokenResult=await tokenRes.json();
            if(tokenResult.result&&tokenResult.result!=='0x'&&tokenResult.result!=='0x0'){
              const balanceWei=BigInt(tokenResult.result);
              const balance=Number(balanceWei)/Math.pow(10,token.decimals);
              if(balance>0.01){
                const price=token.price!==undefined?token.price:(token.priceRatio?plsPrice*token.priceRatio:0);
                const usdValue=balance*price;
                managementTotalUSD+=usdValue;
                console.log(`Management ${token.symbol}: ${balance.toLocaleString()} ($${usdValue.toLocaleString()})`);
              }
            }
          }catch(e){console.error(`Error fetching ${token.symbol}:`,e)}
        }
        console.log('Management wallet total USD:',managementTotalUSD);
        
        // 6. Calculate totals
        const availableUSD=availablePLS*plsPrice;
        const pendingUSD=lockedAmountPLS*plsPrice;
        const totalValue=availableUSD+pendingUSD+managementTotalUSD;
        
        console.log('Total DAO value:',totalValue);
        
        return{
          availablePLS,
          availableUSD,
          pendingPLS:lockedAmountPLS,
          pendingUSD,
          pendingCount,
          managementValue:managementTotalUSD,
          totalValue
        };
      }catch(e){
        console.error('Error fetching DAO data:',e);
        return null;
      }
    };
    
    // Fetch holders - stop after Squid tier, calculate rest
    const fetchHolderTiers=async(addr,cfg,totalHolderCount,onProgress)=>{
      const counts={Poseidon:0,Whale:0,Shark:0,Dolphin:0,Squid:0};
      let nextPageParams=null;
      let totalFetched=0;
      const maxPages=100;
      let page=0;
      let countedHolders=0; // holders we've classified (excluding LP addresses)
      
      // Squid threshold is 0.001% of supply
      const squidThreshold=cfg.totalSupply*0.00001; // 0.001% in tokens
      
      try{
        while(page<maxPages){
          const url=nextPageParams
            ?`https://api.scan.pulsechain.com/api/v2/tokens/${addr}/holders?${nextPageParams}`
            :`https://api.scan.pulsechain.com/api/v2/tokens/${addr}/holders?limit=50`;
          
          const r=await fetch(url);
          const data=await r.json();
          const items=data.items||[];
          
          if(items.length===0)break;
          
          let foundBelowSquid=false;
          
          for(const holder of items){
            const holderAddr=holder.address?.hash?.toLowerCase();
            // Skip LP addresses and staking contract only
            if(LP_ADDRESSES.includes(holderAddr))continue;
            if(cfg.stakingContract&&holderAddr===cfg.stakingContract.toLowerCase())continue;
            
            const tokens=parseFloat(holder.value||0)/Math.pow(10,cfg.decimals);
            const pctOfSupply=(tokens/cfg.totalSupply)*100;
            
            // Check if we've gone below squid threshold
            if(pctOfSupply<0.001){
              foundBelowSquid=true;
              break;
            }
            
            const tier=getHolderTier(pctOfSupply);
            if(counts.hasOwnProperty(tier)){
              counts[tier]++;
            }
            countedHolders++;
          }
          
          totalFetched+=items.length;
          if(onProgress)onProgress(totalFetched,counts,countedHolders);
          
          // Stop if we found holders below squid threshold
          if(foundBelowSquid)break;
          
          if(data.next_page_params){
            const params=new URLSearchParams();
            Object.entries(data.next_page_params).forEach(([k,v])=>params.set(k,v));
            nextPageParams=params.toString();
          }else{
            break;
          }
          page++;
        }
      }catch(e){
        console.error('Error fetching holders:',e);
      }
      
      // Calculate Turtle & Below = total holders - counted tiers - LP addresses (2) - staking contract (1)
      const excludedAddresses=LP_ADDRESSES.length+(cfg.stakingContract?1:0);
      const turtleAndBelow=Math.max(0,totalHolderCount-countedHolders-excludedAddresses);
      
      return{counts,countedHolders,turtleAndBelow,total:totalFetched};
    };
    
    const DonutChart=({data,colors,size=120})=>{
      const total=data.reduce((s,d)=>s+d.value,0);
      if(total===0)return<svg width={size} height={size}><circle cx={size/2} cy={size/2} r={size/2-10} fill="none" stroke="#333" strokeWidth={size*0.17}/></svg>;
      let cumulative=0;
      const r=size/2;
      const strokeWidth=r*0.35;
      const radius=r-strokeWidth/2;
      const circumference=2*Math.PI*radius;
      
      return(
        <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
          {data.map((d,i)=>{
            const pct=total>0?(d.value/total)*100:0;
            const offset=circumference*(1-cumulative/100);
            const length=circumference*(pct/100);
            cumulative+=pct;
            return<circle key={i} cx={r} cy={r} r={radius} fill="none" stroke={colors[i%colors.length]} strokeWidth={strokeWidth} strokeDasharray={`${length} ${circumference-length}`} strokeDashoffset={offset} transform={`rotate(-90 ${r} ${r})`}/>;
          })}
          <circle cx={r} cy={r} r={radius-strokeWidth/2} fill="#0a0a0a"/>
        </svg>
      );
    };
    
    const AllocationModal=({open,close,token,cfg,theme,burn,tokensInLP,totalSupply,stakingData,totalHolderCount})=>{
      const[tierCounts,setTierCounts]=useState({Poseidon:0,Whale:0,Shark:0,Dolphin:0,Squid:0});
      const[turtleAndBelow,setTurtleAndBelow]=useState(0);
      const[loading,setLoading]=useState(true);
      const[progress,setProgress]=useState(0);
      
      useEffect(()=>{
        if(!open)return;
        setLoading(true);
        setProgress(0);
        setTierCounts({Poseidon:0,Whale:0,Shark:0,Dolphin:0,Squid:0});
        setTurtleAndBelow(0);
        
        fetchHolderTiers(cfg.address,cfg,totalHolderCount,(fetched,counts,counted)=>{
          setProgress(fetched);
          setTierCounts({...counts});
        }).then(({counts,turtleAndBelow})=>{
          setTierCounts(counts);
          setTurtleAndBelow(turtleAndBelow);
          setLoading(false);
        });
      },[open,cfg,totalHolderCount]);
      
      if(!open)return null;
      
      const burnedPct=(burn?.pct||0);
      const lpPct=totalSupply>0?(tokensInLP/totalSupply)*100:0;
      const stakedPct=stakingData?.stakedPct||0;
      const lockedPct=stakingData?.lockedPct||0;
      // Held = everything else (not burned, not in LP, not staked, not locked)
      const heldPct=Math.max(0,100-burnedPct-lpPct-stakedPct-lockedPct);
      
      const isPTGC=token==='PTGC';
      const chartData=isPTGC?[
        {label:'Burned',value:burnedPct},
        {label:'In LP',value:lpPct},
        {label:'Staked',value:stakedPct},
        {label:'Staked/Locked',value:lockedPct},
        {label:'Held',value:heldPct}
      ]:[
        {label:'Burned',value:burnedPct},
        {label:'In LP',value:lpPct},
        {label:'Held',value:100-burnedPct-lpPct}
      ];
      
      const chartColors=isPTGC?['#f97316','#3b82f6','#a855f7','#ec4899',cfg.colorHex]:['#f97316','#3b82f6',cfg.colorHex];
      
      const displayCounts={
        Poseidon:tierCounts.Poseidon,
        Whale:tierCounts.Whale,
        Shark:tierCounts.Shark,
        Dolphin:tierCounts.Dolphin,
        Squid:tierCounts.Squid,
        'Turtle & Below':turtleAndBelow
      };
      const totalCountedHolders=Object.values(tierCounts).reduce((s,c)=>s+c,0)+turtleAndBelow;
      
      return(
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay bg-black/70" onClick={close}>
          <div className={`bg-[#111] border ${theme.border} rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto`} onClick={e=>e.stopPropagation()}>
            <div className="p-5">
              <div className="flex justify-between items-center mb-4">
                <h2 className={`text-xl font-bold ${theme.text}`}>{'\u{1F4CA}'} {token} Token Allocation</h2>
                <button onClick={close} className="text-white/60 hover:text-white text-2xl">{'\u00D7'}</button>
              </div>
              
              <div className="flex items-center justify-center gap-6 mb-4">
                <DonutChart data={chartData} colors={chartColors} size={140}/>
                <div className="space-y-1">
                  {chartData.map((d,i)=>(
                    <div key={i} className="flex items-center gap-2 text-sm">
                      <div className="w-3 h-3 rounded-full" style={{background:chartColors[i]}}></div>
                      <span className="text-white/70">{d.label}:</span>
                      <span className={`font-bold ${theme.text}`}>{d.value.toFixed(2)}%</span>
                    </div>
                  ))}
                </div>
              </div>
              
              <div className={`${theme.card} border ${theme.border} rounded-xl p-4`}>
                <div className="flex justify-between items-center mb-3">
                  <div className="text-white/60 text-xs uppercase">Holder Distribution by % of Supply</div>
                  {loading&&<div className="text-white/40 text-xs">Scanning...</div>}
                </div>
                
                <div className="grid grid-cols-3 gap-3">
                  {HOLDER_TIERS_DISPLAY.map(tier=>(
                    <div key={tier.n} className="text-center">
                      <div className="text-2xl mb-1">{tier.e}</div>
                      <div className={`text-lg font-bold ${theme.text}`}>{displayCounts[tier.n]||0}</div>
                      <div className="text-white/50 text-xs">{tier.n}</div>
                    </div>
                  ))}
                </div>
                
                {loading?(
                  <div className="flex items-center justify-center gap-2 mt-3">
                    <div className="w-4 h-4 border-2 border-t-transparent rounded-full animate-spin" style={{borderColor:`${cfg.colorHex} transparent transparent transparent`}}></div>
                    <span className="text-white/50 text-sm">Loading holders...</span>
                  </div>
                ):(
                  <div className="text-center text-white/40 text-xs mt-3">Total: {fmt(totalCountedHolders)} holders (excludes LPs & staking)</div>
                )}
                
                <div className="text-white/40 text-xs mt-3 pt-3 border-t border-white/10">
                  {'\u{1F531}'} 10%+ {'\u2022'} {'\u{1F40B}'} 1%+ {'\u2022'} {'\u{1F988}'} 0.1%+ {'\u2022'} {'\u{1F42C}'} 0.01%+ {'\u2022'} {'\u{1F991}'} 0.001%+ {'\u2022'} {'\u{1F422}'} Below
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    const ValueGenModal=({open,close,token,vol,cfg,theme})=>{
      const[period,setPeriod]=useState('24h');
      if(!open)return null;
      
      const multipliers={'24h':1,'7d':7,'30d':30,'90d':90};
      const periodVol=vol*multipliers[period];
      const total=periodVol*cfg.taxRate;
      
      return(
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay bg-black/70" onClick={close}>
          <div className={`bg-[#111] border ${theme.border} rounded-2xl max-w-md w-full`} onClick={e=>e.stopPropagation()}>
            <div className="p-4">
              <div className="flex justify-between items-center mb-3">
                <h2 className={`text-lg font-bold ${theme.text}`}>{'\u{1F4B0}'} {token} Value Generation</h2>
                <button onClick={close} className="text-white/60 hover:text-white text-xl">{'\u00D7'}</button>
              </div>
              
              <div className="flex gap-1 mb-4 bg-black/30 rounded-lg p-1">
                {['24h','7d','30d','90d'].map(p=>(
                  <button key={p} onClick={()=>setPeriod(p)} className={`flex-1 py-2 rounded-md text-sm font-medium transition ${period===p?`${theme.bg} text-black`:'text-white/60 hover:text-white'}`}>{p.toUpperCase()}</button>
                ))}
              </div>
              
              <div className="text-center mb-4">
                <div className="text-white/50 text-sm">Est. Volume ({period.toUpperCase()}): {fmtUSD(periodVol)}</div>
                <div className="text-4xl font-bold text-green-400 my-2">{fmtUSD(total)}</div>
                <div className="text-white/50 text-sm">{(cfg.taxRate*100)}% Tax Generated</div>
                {period!=='24h'&&<div className="text-white/40 text-xs mt-1">* Estimated based on current 24h volume</div>}
              </div>
              
              <div className="space-y-2">
                {cfg.taxBreakdown.map((item,i)=>(
                  <div key={i} className={`${theme.card} border ${theme.border} rounded-lg px-3 py-2 flex justify-between items-center`}>
                    <span className="text-white/70 text-sm"><span className="mr-2">{item.emoji}</span>{item.name}</span>
                    <span className={`font-bold ${theme.text}`}>{fmtUSD(periodVol*(item.pct/100))}</span>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    const BurnModal=({open,close,token,burn,price,cfg})=>{
      const[hist,setHist]=useState({h12:null,h24:null,d7:null,d30:null});
      useEffect(()=>{if(!open)return;setHist({h12:null,h24:null,d7:null,d30:null});const fetchAll=async()=>{const h12=await fetchBurnHist(cfg.address,cfg.decimals,12);setHist(p=>({...p,h12}));const h24=await fetchBurnHist(cfg.address,cfg.decimals,24);setHist(p=>({...p,h24}));const d7=await fetchBurnHist(cfg.address,cfg.decimals,24*7);setHist(p=>({...p,d7}));const d30=await fetchBurnHist(cfg.address,cfg.decimals,24*30);setHist(p=>({...p,d30}))};fetchAll()},[open,cfg]);
      if(!open)return null;
      const theme={text:cfg.color==='gold'?'text-[#D9CA5D]':'text-[#7CFC00]'};
      const creatures=getBurnC(burn?.pct||0,'Squid');
      const supply=burn?.supply||1;
      const getPct=a=>(a/supply)*100;
      const whaleProgress=getWhaleProgress(burn?.pct||0);
      const boxes=[{l:'12H',v:hist.h12},{l:'24H',v:hist.h24},{l:'7D',v:hist.d7},{l:'30D',v:hist.d30}];
      return(
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay bg-black/70" onClick={close}>
          <div className="bg-[#111] border border-orange-500/30 rounded-2xl max-w-2xl w-full" onClick={e=>e.stopPropagation()}>
            <div className="p-5">
              <div className="flex justify-between mb-4">
                <div className="flex items-center gap-4"><img src={cfg.logo} alt={token} className="w-16 h-16 sm:w-20 sm:h-20"/><div><h2 className="text-2xl font-bold text-orange-400 font-orbitron">{token} Burn Stats</h2><div className="text-white/40 text-sm">{'\u{1F525}'} Total Supply Burned</div></div></div>
                <button onClick={close} className="text-white/60 hover:text-white text-2xl">{'\u00D7'}</button>
              </div>
              <div className="bg-gradient-to-r from-orange-500/15 to-orange-600/10 border border-orange-500/30 rounded-xl p-4 mb-4">
                <div className="grid grid-cols-3 gap-3 text-center mb-3">
                  <div><div className="text-orange-400/70 text-xs uppercase">Burned</div><div className={`text-2xl font-bold ${theme.text}`}>{fmt(burn?.total)}</div></div>
                  <div><div className="text-orange-400/70 text-xs uppercase">USD Value</div><div className="text-2xl font-bold text-green-400">{fmtUSD((burn?.total||0)*price)}</div></div>
                  <div><div className="text-orange-400/70 text-xs uppercase">% Supply</div><div className="text-2xl font-bold text-white">{(burn?.pct||0).toFixed(2)}%</div></div>
                </div>
                <div className="flex items-center gap-2 mb-3">
                  <div className="flex-1 h-3 bg-black/50 rounded-full overflow-hidden"><div className="h-full bg-gradient-to-r from-orange-500 to-orange-400 rounded-full" style={{width:`${whaleProgress.progress}%`}}></div></div>
                  <span className="text-xl">{'\u{1F40B}'}</span>
                  <span className="text-orange-400/70 text-sm">{whaleProgress.progress.toFixed(1)}%</span>
                </div>
                <div className="flex items-center justify-center gap-2 flex-wrap"><span className="text-3xl animate-fire">{'\u{1F525}'}</span>{creatures.map((c,i)=><span key={i} className="flex items-center gap-1"><span className="text-3xl">{c.e}</span><span className="text-white/80 text-lg font-bold">x{c.cnt}</span></span>)}</div>
              </div>
              <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
                {boxes.map(({l,v})=>{const isLoading=v===null;const c=!isLoading?getSingleC(getPct(v)):{e:'\u{23F3}'};return(
                  <div key={l} className="bg-[#1a1a1a] border border-orange-500/20 rounded-xl p-3">
                    <div className="flex justify-between mb-1"><span className="text-white/60 text-sm">{l}</span><span className="text-2xl">{c.e}</span></div>
                    {isLoading?<div className="animate-pulse-slow text-orange-400/50">Loading...</div>:<><div className="text-xl font-bold text-orange-400">{fmt(v)}</div><div className="text-sm text-green-400">{fmtUSD(v*price)}</div></>}
                  </div>
                )})}
              </div>
              <div className="text-center text-white/30 text-xs mt-4">Burn: {BURN_ADDRESS}</div>
            </div>
          </div>
        </div>
      );
    };
    
    const LPRow=({pair,theme,mainAddr})=>{
      const[logoErr,setLogoErr]=useState(false);
      const[det,setDet]=useState(false);
      const liq=pair.liq||0,vol=pair.vol||0;
      const ratio=liq>0?(vol/liq).toFixed(3):'0.000';
      const buys=pair.txns?.h24?.buys||0,sells=pair.txns?.h24?.sells||0;
      const chg=pair.priceChange?.h24||0,up=chg>=0;
      const isBase=pair.baseToken?.address?.toLowerCase()===mainAddr?.toLowerCase();
      const other=isBase?pair.quoteToken:pair.baseToken;
      const logo=getLogo(other?.address);
      const baseReserve=pair.liquidity?.base||0,quoteReserve=pair.liquidity?.quote||0;
      return(
        <div className={`${theme.card} border ${theme.border} rounded-lg p-3 sm:p-4 hover:border-opacity-60`}>
          <div className="hidden sm:grid grid-cols-12 gap-2 items-center">
            <div className="col-span-1 flex justify-center">{!logoErr&&logo?<img src={logo} className="w-10 h-10 rounded-full bg-black/50" onError={()=>setLogoErr(true)}/>:<div className="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center font-bold">{other?.symbol?.[0]}</div>}</div>
            <div className="col-span-2"><div className={`font-semibold ${theme.text}`}>{pair.baseToken?.symbol}/{pair.quoteToken?.symbol}</div><div className="text-gray-500 text-sm">PulseX V2</div></div>
            <div className="col-span-2 text-right"><div className="text-white text-xs">Volume</div><div className="text-white font-semibold">{fmtUSD(vol)}</div></div>
            <div className="col-span-2 text-right"><div className="text-white text-xs">Liquidity</div><div className="text-white">{fmtUSD(liq)}</div></div>
            <div className="col-span-1 text-center"><div className="text-white text-xs">24h</div><div className={up?'text-green-400':'text-red-400'}>{up?'\u25B2':'\u25BC'} {Math.abs(chg).toFixed(1)}%</div></div>
            <div className="col-span-1 text-center"><div className="text-white text-xs">Txns</div><div><span className="text-green-400">{buys}</span>/<span className="text-red-400">{sells}</span></div></div>
            <div className="col-span-1 text-right"><div className="text-white text-xs">Vol/Liq</div><div className="text-white">{ratio}</div></div>
            <div className="col-span-2 flex justify-end gap-2"><button onClick={()=>setDet(!det)} className="text-lg hover:scale-110">{'\u2139\uFE0F'}</button><a href={`https://dexscreener.com/pulsechain/${pair.pairAddress}`} target="_blank" className="text-lg hover:scale-110">{'\u{1F4C8}'}</a><a href={`https://www.dextools.io/app/en/pulse/pair-explorer/${pair.pairAddress}`} target="_blank" className="text-lg hover:scale-110">{'\u{1F4CA}'}</a></div>
          </div>
          <div className="sm:hidden">
            <div className="flex items-center gap-3 mb-2">{!logoErr&&logo?<img src={logo} className="w-8 h-8 rounded-full bg-black/50" onError={()=>setLogoErr(true)}/>:<div className="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-xs font-bold">{other?.symbol?.[0]}</div>}<div className="flex-1"><div className={`font-semibold ${theme.text} text-sm`}>{pair.baseToken?.symbol}/{pair.quoteToken?.symbol}</div></div><div className={`text-sm font-semibold ${up?'text-green-400':'text-red-400'}`}>{up?'\u25B2':'\u25BC'} {Math.abs(chg).toFixed(1)}%</div></div>
            <div className="grid grid-cols-4 gap-2 text-center text-xs"><div><div className="text-gray-400">Vol</div><div className="text-white">{fmtUSD(vol)}</div></div><div><div className="text-gray-400">Liq</div><div className="text-white">{fmtUSD(liq)}</div></div><div><div className="text-gray-400">Txns</div><div><span className="text-green-400">{buys}</span>/<span className="text-red-400">{sells}</span></div></div><div><div className="text-gray-400">V/L</div><div className="text-white">{ratio}</div></div></div>
          </div>
          {det&&(
            <div className="mt-3 pt-3 border-t border-white/10 grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm">
              <div><span className="text-gray-400">Pair:</span> <span className="text-white font-mono text-xs">{pair.pairAddress?.slice(0,10)}...</span></div>
              <div><span className="text-gray-400">Created:</span> <span className="text-white">{pair.pairCreatedAt?new Date(pair.pairCreatedAt).toLocaleDateString():'\u2014'}</span></div>
              <div><span className="text-gray-400">Price:</span> <Price p={parseFloat(pair.priceUsd)} c="text-white"/></div>
              <div><span className="text-gray-400">FDV:</span> <span className="text-white">{fmtUSD(pair.fdv)}</span></div>
              <div><span className="text-gray-400">{pair.baseToken?.symbol}:</span> <span className={theme.text}>{fmt(baseReserve)}</span></div>
              <div><span className="text-gray-400">{pair.quoteToken?.symbol}:</span> <span className="text-white">{fmt(quoteReserve)}</span></div>
            </div>
          )}
        </div>
      );
    };
    
    const Home=({onSelect})=>{
      const[data,setData]=useState({PTGC:null,UFO:null});
      const[loading,setLoading]=useState(true);
      useEffect(()=>{const load=async()=>{const[p,u]=await Promise.all([fetchDex(TOKENS.PTGC.address,TOKENS.PTGC.mainPair),fetchDex(TOKENS.UFO.address,TOKENS.UFO.mainPair)]);setData({PTGC:p,UFO:u});setLoading(false)};load()},[]);
      const Card=({token,d})=>{
        const cfg=TOKENS[token],isGold=cfg.color==='gold';
        const border=isGold?'border-[#D9CA5D]/50':'border-[#7CFC00]/50',text=isGold?'text-[#D9CA5D]':'text-[#7CFC00]';
        const bg=isGold?'bg-gradient-to-r from-[#D9CA5D]/20 via-[#1a1a1a] to-[#1a1a1a]':'bg-gradient-to-r from-[#7CFC00]/20 via-[#1a1a1a] to-[#1a1a1a]';
        const hover=isGold?'token-card-gold':'token-card-green',up=(d?.change||0)>=0;
        return(
          <div onClick={()=>onSelect(token)} className={`token-card ${hover} cursor-pointer rounded-2xl border-2 ${border} ${bg} p-4 sm:p-6 lg:p-8`}>
            <div className="flex flex-col sm:flex-row items-center gap-4 sm:gap-6">
              <img src={cfg.logo} alt={token} className="w-20 h-20 sm:w-24 sm:h-24 lg:w-32 lg:h-32 object-contain"/>
              <div className="text-center sm:text-left"><div className={`font-orbitron text-2xl sm:text-3xl lg:text-4xl font-bold ${text}`}>{token}</div><div className="text-white/40 text-xs font-mono mt-1">{cfg.address.slice(0,6)}...{cfg.address.slice(-4)}</div></div>
              <div className="flex-1 text-center sm:text-right"><Price p={d?.price} c="text-white font-bold text-xl sm:text-2xl lg:text-3xl"/><div className="text-white/50 text-sm sm:text-lg mt-1">MCap: {fmtUSD(d?.mcap)}</div></div>
              <div className="flex items-center gap-2 sm:gap-4"><svg viewBox="0 0 100 24" className="w-16 sm:w-20 h-6"><polyline points={up?"0,20 30,14 60,11 100,5":"0,5 30,10 60,12 100,18"} fill="none" stroke={up?'#22c55e':'#ef4444'} strokeWidth="2"/></svg><div className={`px-2 sm:px-3 py-1 rounded-lg text-sm sm:text-lg font-bold ${up?'bg-green-500/20 text-green-400':'bg-red-500/20 text-red-400'}`}>{up?'\u25B2':'\u25BC'} {Math.abs(d?.change||0).toFixed(2)}%</div></div>
            </div>
          </div>
        );
      };
      return(
        <div className="min-h-screen flex flex-col px-4">
          <header className="text-center pt-4"><img src={COMBINED_LOGO} alt="PTGC & UFO" className="h-48 sm:h-64 md:h-80 lg:h-96 mx-auto"/><h1 className="font-orbitron text-3xl sm:text-4xl lg:text-5xl font-bold mb-2 -mt-6 sm:-mt-10" style={{background:'linear-gradient(180deg,#FFF,#808080)',WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent'}}>DASHBOARD</h1><p className="text-white/50 text-sm sm:text-lg mb-6 sm:mb-10">A community tool built for The Grays Ecosystem</p></header>
          <div className="flex-1 flex justify-center pb-8"><div className="flex flex-col gap-4 sm:gap-6 max-w-4xl w-full">{loading?<><div className="animate-pulse bg-white/10 rounded-2xl h-32"></div><div className="animate-pulse bg-white/10 rounded-2xl h-32"></div></>:<><Card token="PTGC" d={data.PTGC}/><Card token="UFO" d={data.UFO}/></>}</div></div>
          <footer className="text-center py-4 border-t border-white/10"><p className="text-white/30 text-xs">Not financial advice. DYOR.</p></footer>
        </div>
      );
    };
    
    const Dashboard=({token,onBack})=>{
      const cfg=TOKENS[token],isGold=cfg.color==='gold';
      const theme={text:isGold?'text-[#D9CA5D]':'text-[#7CFC00]',border:isGold?'border-[#D9CA5D]/30':'border-[#7CFC00]/30',bg:isGold?'bg-[#D9CA5D]':'bg-[#7CFC00]',card:'bg-[#111]/80'};
      const[data,setData]=useState(null);
      const[burn,setBurn]=useState({total:0,pct:0,supply:0});
      const[holders,setHolders]=useState(0);
      const[pls,setPls]=useState(0.00005);
      const[loading,setLoading]=useState(true);
      const[sortBy,setSortBy]=useState('volume');
      const[sortDir,setSortDir]=useState('desc');
      const[lastUpdate,setLastUpdate]=useState(new Date());
      const[showBurn,setShowBurn]=useState(false);
      const[showValueGen,setShowValueGen]=useState(false);
      const[showAlloc,setShowAlloc]=useState(false);
      const[daoData,setDaoData]=useState(null);
      const[daoLoading,setDaoLoading]=useState(true);
      const[stakingData,setStakingData]=useState({totalInContract:0,staked:0,stakedPct:0,locked:0,lockedPct:0});
      
      useEffect(()=>{
        const load=async()=>{
          const[d,h,b,p]=await Promise.all([fetchDex(cfg.address,cfg.mainPair),fetchHolders(cfg.address),fetchBurn(cfg.address,cfg.decimals),fetchPLS()]);
          setData(d);setHolders(h);setBurn(b);setPls(p);setLastUpdate(new Date());setLoading(false);
          
          if(cfg.stakingContract){
            const staking=await fetchStakingData(cfg.stakingContract,cfg.address,cfg.decimals,cfg.totalSupply);
            setStakingData(staking);
          }
          
          if(cfg.hasDAO&&cfg.daoContract){
            setDaoLoading(true);
            const dao=await fetchDAOData(cfg.daoContract,cfg.daoTreasury,p);
            setDaoData(dao);
            setDaoLoading(false);
          }
        };
        load();
      },[token]);
      
      const sorted=useMemo(()=>{if(!data?.pairs)return[];return[...data.pairs].sort((a,b)=>{let av,bv;switch(sortBy){case'ratio':av=a.liq>0?a.vol/a.liq:0;bv=b.liq>0?b.vol/b.liq:0;break;case'volume':av=a.vol;bv=b.vol;break;case'liquidity':av=a.liq;bv=b.liq;break;case'change':av=a.priceChange?.h24||0;bv=b.priceChange?.h24||0;break;default:av=a.vol;bv=b.vol}return sortDir==='desc'?bv-av:av-bv})},[data?.pairs,sortBy,sortDir]);
      
      const high=sorted.filter(p=>p.liq>=MIN_LIQ),low=sorted.filter(p=>p.liq<MIN_LIQ);
      const[showLow,setShowLow]=useState(false);
      const creatures=getBurnC(burn?.pct||0,'Squid');
      const plsRatio=data?.price&&pls?(data.price/pls).toFixed(2):'\u2014';
      const priceUp=(data?.change||0)>=0;
      const liqMcapRatio=data?.mcap>0?((data.liq/data.mcap)*100).toFixed(2):'\u2014';
      const whaleProgress=getWhaleProgress(burn?.pct||0);
      const tokensInLP=data?.tokensInLP||0;
      const tokensInLPPct=cfg.totalSupply>0?((tokensInLP/cfg.totalSupply)*100).toFixed(2):'0';
      const valueGen24h=(data?.vol||0)*cfg.taxRate;
      
      const burnedPct=burn?.pct||0;
      const lpPct=cfg.totalSupply>0?(tokensInLP/cfg.totalSupply)*100:0;
      const stakedPct=stakingData?.stakedPct||0;
      const lockedPct=stakingData?.lockedPct||0;
      const heldPct=Math.max(0,100-burnedPct-lpPct-stakedPct-lockedPct);
      
      const chartColors=cfg.stakingContract?['#f97316','#3b82f6','#a855f7','#ec4899',cfg.colorHex]:['#f97316','#3b82f6',cfg.colorHex];
      const chartData=cfg.stakingContract?[
        {label:'Burned',value:burnedPct},
        {label:'In LP',value:lpPct},
        {label:'Staked',value:stakedPct},
        {label:'Locked',value:lockedPct},
        {label:'Held',value:heldPct}
      ]:[
        {label:'Burned',value:burnedPct},
        {label:'In LP',value:lpPct},
        {label:'Held',value:100-burnedPct-lpPct}
      ];
      
      if(loading)return<div className="min-h-screen flex items-center justify-center"><div className="text-center"><div className={`w-16 h-16 mx-auto mb-4 rounded-full border-4 ${theme.border} border-t-transparent animate-spin`}></div><div className={`font-orbitron text-lg ${theme.text}`}>Loading {token}...</div></div></div>;
      
      return(
        <div className="min-h-screen">
          <header className="sticky top-0 z-50 bg-[#0a0a0a]/95 backdrop-blur border-b border-white/10">
            <div className="max-w-7xl mx-auto px-3 sm:px-6 py-4 sm:py-5">
              <div className="flex items-center justify-between flex-wrap gap-3">
                <div className="flex items-center gap-4 sm:gap-6">
                  <button onClick={onBack} className="text-white/60 hover:text-white text-lg">{'\u2190'} Home</button>
                  <img src={cfg.logo} alt={token} className="w-20 h-20 sm:w-24 sm:h-24"/>
                  <div className="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-5">
                    <span className={`font-orbitron text-3xl sm:text-4xl lg:text-5xl font-bold ${theme.text}`}>{token}</span>
                    <div className={`${theme.card} border ${theme.border} rounded-xl px-5 py-3 flex items-center gap-3`}>
                      <Price p={data?.price} c={`text-3xl sm:text-4xl font-bold ${theme.text}`}/>
                      <span className={`text-xl font-bold ${priceUp?'text-green-400':'text-red-400'}`}>{priceUp?'\u25B2':'\u25BC'}{Math.abs(data?.change||0).toFixed(2)}%</span>
                    </div>
                    <div className={`${theme.card} border ${theme.border} rounded-xl px-5 py-3`}>
                      <span className="text-white/60 text-sm mr-2">PLS</span>
                      <span className={`text-3xl sm:text-4xl font-bold ${theme.text}`}>{plsRatio}</span>
                    </div>
                  </div>
                </div>
                <div className="flex items-center gap-2">
                  <span className="text-white/40 text-xs hidden md:block">{lastUpdate.toLocaleTimeString()}</span>
                  <a href={cfg.pulseScanUrl} target="_blank" className={`px-4 py-2 rounded-lg border ${theme.border} ${theme.text} font-medium hover:bg-white/5`}>Explorer</a>
                  <button className={`px-4 py-2 rounded-lg ${theme.bg} text-black font-bold`}>KPI Report</button>
                </div>
              </div>
            </div>
          </header>
          
          <div className="border-b border-white/10">
            <div className="max-w-7xl mx-auto px-3 sm:px-6 py-3">
              <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-7 gap-3">
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">Market Cap</div><div className={`text-2xl font-bold ${theme.text}`}>{fmtUSD(data?.mcap)}</div><div className={`text-sm ${priceUp?'text-green-400':'text-red-400'}`}>{priceUp?'\u25B2':'\u25BC'} {Math.abs(data?.change||0).toFixed(2)}%</div></div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">Volume 24H</div><div className={`text-2xl font-bold ${theme.text}`}>{fmtUSD(data?.vol)}</div></div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">Liquidity</div><div className={`text-2xl font-bold ${theme.text}`}>{fmtUSD(data?.liq)}</div></div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">Liq/MCap</div><div className={`text-2xl font-bold ${theme.text}`}>{liqMcapRatio}%</div></div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">Holders</div><div className={`text-2xl font-bold ${theme.text}`}>{fmt(holders)}</div></div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">Tokens in LP</div><div className={`text-2xl font-bold ${theme.text}`}>{fmtAbbr(tokensInLP)}</div><div className="text-white/50 text-sm">{tokensInLPPct}%</div></div>
                <div className={`${theme.card} border ${theme.border} rounded-lg p-3`}><div className="text-white text-xs uppercase mb-1">Txns 24H</div><div className="text-2xl font-bold"><span className="text-green-400">{data?.buys||0}</span><span className="text-white/50">/</span><span className="text-red-400">{data?.sells||0}</span></div></div>
              </div>
            </div>
          </div>
          
          <div className="max-w-7xl mx-auto px-3 sm:px-6 py-4">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
              <div className="bg-gradient-to-r from-orange-500/15 via-orange-600/10 to-orange-500/15 border border-orange-500/30 rounded-xl p-4 clickable" onClick={()=>setShowBurn(true)}>
                <div className="flex justify-between mb-2"><div className="text-xs text-orange-400/90 uppercase font-semibold">{'\u{1F525}'} Total Supply Burned</div><span className="text-orange-400/60 text-xs">Details {'\u2192'}</span></div>
                <div className="flex items-center gap-3 mb-2 flex-wrap"><span className={`text-2xl font-bold ${theme.text}`}>{fmt(burn?.total)}</span><span className="text-lg font-bold text-green-400">{fmtUSD((burn?.total||0)*(data?.price||0))}</span><span className="text-white/50">{(burn?.pct||0).toFixed(2)}%</span></div>
                <div className="flex items-center gap-2 mb-2"><div className="flex-1 h-2 bg-black/50 rounded-full overflow-hidden"><div className="h-full bg-gradient-to-r from-orange-500 to-orange-400 rounded-full" style={{width:`${whaleProgress.progress}%`}}></div></div><span className="text-lg">{'\u{1F40B}'}</span><span className="text-orange-400/70 text-xs">{whaleProgress.progress.toFixed(1)}%</span></div>
                <div className="flex items-center gap-1 flex-wrap"><span className="text-xl animate-fire">{'\u{1F525}'}</span>{creatures.map((c,i)=><span key={i} className="flex items-center"><span className="text-xl">{c.e}</span><span className="text-white/70 text-sm font-bold">x{c.cnt}</span></span>)}</div>
              </div>
              
              <div className={`bg-gradient-to-r ${isGold?'from-[#D9CA5D]/15 via-[#D9CA5D]/10 to-[#D9CA5D]/15':'from-[#7CFC00]/15 via-[#7CFC00]/10 to-[#7CFC00]/15'} border ${theme.border} rounded-xl p-4 clickable`} onClick={()=>setShowValueGen(true)}>
                <div className="flex justify-between mb-2"><div className={`text-xs ${theme.text} uppercase font-semibold`}>{'\u{1F4B0}'} Value Generated (24H)</div><span className={`${theme.text} opacity-60 text-xs`}>Details {'\u2192'}</span></div>
                <div className="flex items-baseline gap-2 mb-3"><span className="text-3xl font-bold text-green-400">{fmtUSD(valueGen24h)}</span><span className="text-white/50 text-sm">from {fmtUSD(data?.vol)} vol</span></div>
                <div className="flex flex-wrap gap-x-4 gap-y-1 text-sm">{cfg.taxBreakdown.map((item,i)=><div key={i} className="flex items-center gap-1"><span>{item.emoji}</span><span className="text-white/60">{item.name}:</span><span className={`font-semibold ${theme.text}`}>{fmtUSD((data?.vol||0)*(item.pct/100))}</span></div>)}</div>
              </div>
              
              <div className={`${theme.card} border ${theme.border} rounded-xl p-4 clickable`} onClick={()=>setShowAlloc(true)}>
                <div className="flex justify-between mb-3"><div className={`text-xs ${theme.text} uppercase font-semibold`}>{'\u{1F4CA}'} Token Allocation</div><span className={`${theme.text} opacity-60 text-xs`}>Details {'\u2192'}</span></div>
                <div className="flex items-center gap-4">
                  <DonutChart data={chartData} colors={chartColors} size={80}/>
                  <div className="flex-1 space-y-1">
                    {chartData.map((d,i)=>(
                      <div key={i} className="flex items-center gap-2 text-sm">
                        <div className="w-2 h-2 rounded-full" style={{background:chartColors[i]}}></div>
                        <span className="text-white/60">{d.label}:</span>
                        <span className={`font-bold ${theme.text}`}>{d.value.toFixed(2)}%</span>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
              
              {cfg.hasDAO?(
                <div className={`${theme.card} border ${theme.border} rounded-xl p-4`}>
                  <div className="flex justify-between mb-3"><div className={`text-xs ${theme.text} uppercase font-semibold`}>{'\u{1F3DB}\u{FE0F}'} DAO Treasury</div></div>
                  {daoLoading?(
                    <div className="flex items-center justify-center py-4">
                      <div className="w-6 h-6 border-2 border-t-transparent rounded-full animate-spin" style={{borderColor:`${cfg.colorHex} transparent transparent transparent`}}></div>
                      <span className="text-white/50 ml-2">Loading DAO data...</span>
                    </div>
                  ):(
                    <div className="space-y-3">
                      <div className="grid grid-cols-2 gap-3">
                        <div>
                          <div className="text-white/50 text-xs uppercase flex items-center gap-1">{'\u{1F4B0}'} Available for New Proposals</div>
                          <div className="text-lg font-bold text-white">{fmtAbbr(daoData?.availablePLS||0)} PLS</div>
                          <div className="text-green-400 text-sm font-bold">{fmtUSD(daoData?.availableUSD||0)}</div>
                        </div>
                        <div>
                          <div className="text-white/50 text-xs uppercase flex items-center gap-1">{'\u{23F3}'} Pending in Live Proposals</div>
                          <div className="text-lg font-bold text-white">{fmtAbbr(daoData?.pendingPLS||0)} PLS</div>
                          <div className="text-green-400 text-sm font-bold">{fmtUSD(daoData?.pendingUSD||0)}</div>
                          <div className="text-white/40 text-xs mt-1">{daoData?.pendingCount||0} active proposals</div>
                        </div>
                      </div>
                      <div className="grid grid-cols-2 gap-3">
                        <div>
                          <div className="text-white/50 text-xs uppercase flex items-center gap-1">{'\u{1F3E6}'} DAO Funds Ready for Deployment</div>
                          <div className={`text-xl font-bold text-green-400`}>{fmtUSD(daoData?.managementValue||0)}</div>
                        </div>
                        <div className={`bg-gradient-to-br from-[${cfg.colorHex}]/20 to-black/40 border border-[${cfg.colorHex}]/30 rounded-lg p-3 -m-1`}>
                          <div className="text-white/50 text-xs uppercase flex items-center gap-1">{'\u{1F4CA}'} Total DAO Value</div>
                          <div className={`text-2xl font-bold text-green-400`}>{fmtUSD(daoData?.totalValue||0)}</div>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              ):(
                <div className={`${theme.card} border ${theme.border} rounded-xl p-4 opacity-50`}>
                  <div className="text-white/30 text-center py-6">No DAO for {token}</div>
                </div>
              )}
            </div>
          </div>
          
          <div className="max-w-7xl mx-auto px-3 sm:px-6 py-4">
            <div className="flex justify-between mb-3 flex-wrap gap-2">
              <h2 className="text-lg font-semibold text-white">LP Pairs <span className="text-gray-500 text-sm">({high.length} with $1K+ LP)</span></h2>
              <div className={`${theme.card} border ${theme.border} rounded-lg px-3 py-2 flex items-center gap-2`}>
                <span className="text-gray-400 text-xs">Sort:</span>
                {['Ratio','Volume','Liquidity','24h %'].map((l,i)=>{const c=['ratio','volume','liquidity','change'][i];return<button key={c} onClick={()=>{sortBy===c?setSortDir(sortDir==='desc'?'asc':'desc'):(setSortBy(c),setSortDir('desc'))}} className={`px-2 py-1 rounded text-xs ${sortBy===c?`${theme.text} bg-white/10`:'text-gray-500'}`}>{l}{sortBy===c&&(sortDir==='desc'?'\u2193':'\u2191')}</button>})}
              </div>
            </div>
            <div className="space-y-2">{high.map((p,i)=><LPRow key={p.pairAddress||i} pair={p} theme={theme} mainAddr={cfg.address}/>)}</div>
            {low.length>0&&<div className="mt-3"><button onClick={()=>setShowLow(!showLow)} className={`w-full ${theme.card} border ${theme.border} rounded-lg p-2 flex justify-between text-sm`}><span className="text-gray-400">{showLow?'Hide':'Show'} {low.length} pairs &lt;$1K</span><span className={theme.text}>{showLow?'\u25B2':'\u25BC'}</span></button>{showLow&&<div className="mt-2 space-y-2">{low.map((p,i)=><LPRow key={p.pairAddress||i} pair={p} theme={theme} mainAddr={cfg.address}/>)}</div>}</div>}
          </div>
          
          <footer className="text-center py-4 border-t border-white/10 mt-8"><p className="text-white/30 text-xs">Not financial advice. DYOR.</p></footer>
          
          <BurnModal open={showBurn} close={()=>setShowBurn(false)} token={token} burn={burn} price={data?.price||0} cfg={cfg}/>
          <ValueGenModal open={showValueGen} close={()=>setShowValueGen(false)} token={token} vol={data?.vol||0} cfg={cfg} theme={theme}/>
          <AllocationModal open={showAlloc} close={()=>setShowAlloc(false)} token={token} cfg={cfg} theme={theme} burn={burn} tokensInLP={tokensInLP} totalSupply={cfg.totalSupply} stakingData={stakingData} totalHolderCount={holders}/>
        </div>
      );
    };
    
    const App=()=>{
      const[view,setView]=useState('home');
      const[token,setToken]=useState(null);
      if(view==='dashboard'&&token)return<Dashboard token={token} onBack={()=>{setView('home');setToken(null)}}/>;
      return<Home onSelect={t=>{setToken(t);setView('dashboard')}}/>;
    };
    
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
